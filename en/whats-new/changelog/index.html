<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-en/whats-new/changelog/index">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KF1LLRTQ5Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KF1LLRTQ5Q",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="ClickHouse Docs" href="/docs/opensearch.xml">
<script src="https://docs-content.clickhouse.tech/docs/js/analytics.js"></script><title data-rh="true">2022 Changelog | ClickHouse Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://clickhouse.com/docs/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://clickhouse.com/docs/img/logo.png"><meta data-rh="true" property="og:url" content="https://clickhouse.com/docs/en/whats-new/changelog/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="2022 Changelog | ClickHouse Docs"><meta data-rh="true" name="description" content="ClickHouse release v22.4, 2022-040-20"><meta data-rh="true" property="og:description" content="ClickHouse release v22.4, 2022-040-20"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://clickhouse.com/docs/en/whats-new/changelog/"><link data-rh="true" rel="alternate" href="https://clickhouse.com/docs/en/whats-new/changelog/" hreflang="en"><link data-rh="true" rel="alternate" href="https://clickhouse.com/docs/en/whats-new/changelog/" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.762d4b44.css">
<link rel="preload" href="/docs/assets/js/runtime~main.832195c1.js" as="script">
<link rel="preload" href="/docs/assets/js/main.0e6c66ce.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docs/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">ClickHouse</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/en/intro">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Language</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/en/intro">English</a></li><li><a class="dropdown__link" href="/docs/ru">Russian</a></li><li><a class="dropdown__link" href="/docs/zh">Chinese</a></li></ul></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD sidebarWithHideableNavbar_d0QC"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_YUvz"><img src="/docs/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docs/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--dark_oUvU"><b>ClickHouse</b></a><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/en/intro">What is ClickHouse?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/en/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/en/tutorial">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/en/getting-started/example-datasets">Example Datasets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Example Datasets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/en/integrations">Integrations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/en/connect-a-ui">Connect a UI</a><button aria-label="Toggle the collapsible sidebar category &#x27;Connect a UI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/en/guides">User Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/reference">Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/en/faq">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/en/whats-new">What&#x27;s New</a><button aria-label="Toggle the collapsible sidebar category &#x27;What&#x27;s New&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/docs/en/whats-new/changelog/">2022 Changelog</a><button aria-label="Toggle the collapsible sidebar category &#x27;2022 Changelog&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/changelog/2021">2021</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/changelog/2020">2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/changelog/2019">2019</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/changelog/2018">2018</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/changelog/2017">2017</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/security-changelog">Security Changelog</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/en/about-us">About Us</a><button aria-label="Toggle the collapsible sidebar category &#x27;About Us&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/en/whats-new"><span itemprop="name">What&#x27;s New</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">2022 Changelog</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>2022 Changelog</h1><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v224-2022-040-20">ClickHouse release v22.4, 2022-040-20<a class="hash-link" href="#clickhouse-release-v224-2022-040-20" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change" title="Direct link to heading">​</a></h4><ul><li>Do not allow SETTINGS after FORMAT for INSERT queries (there is compatibility setting <code>parser_settings_after_format_compact</code> to accept such queries, but it is turned OFF by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/35883" target="_blank" rel="noopener noreferrer">#35883</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Function <code>yandexConsistentHash</code> (consistent hashing algorithm by Konstantin &quot;kostik&quot; Oblakov) is renamed to <code>kostikConsistentHash</code>. The old name is left as an alias for compatibility. Although this change is backward compatible, we may remove the alias in subsequent releases, that&#x27;s why it&#x27;s recommended to update the usages of this function in your apps. <a href="https://github.com/ClickHouse/ClickHouse/pull/35553" target="_blank" rel="noopener noreferrer">#35553</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature">New Feature<a class="hash-link" href="#new-feature" title="Direct link to heading">​</a></h4><ul><li>Added INTERPOLATE extension to the ORDER BY ... WITH FILL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34903" target="_blank" rel="noopener noreferrer">#34903</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35349" target="_blank" rel="noopener noreferrer">#35349</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Profiling on Processors level (under <code>log_processors_profiles</code> setting, ClickHouse will write time that processor spent during execution/waiting for data to <code>system.processors_profile_log</code> table). <a href="https://github.com/ClickHouse/ClickHouse/pull/34355" target="_blank" rel="noopener noreferrer">#34355</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added functions makeDate(year, month, day), makeDate32(year, month, day). <a href="https://github.com/ClickHouse/ClickHouse/pull/35628" target="_blank" rel="noopener noreferrer">#35628</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>). Implementation of makeDateTime() and makeDateTIme64(). <a href="https://github.com/ClickHouse/ClickHouse/pull/35934" target="_blank" rel="noopener noreferrer">#35934</a> (<a href="https://github.com/davenger" target="_blank" rel="noopener noreferrer">Alexander Gololobov</a>).</li><li>Support new type of quota <code>WRITTEN BYTES</code> to limit amount of written bytes during insert queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/35736" target="_blank" rel="noopener noreferrer">#35736</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added function <code>flattenTuple</code>. It receives nested named <code>Tuple</code> as an argument and returns a flatten <code>Tuple</code> which elements are the paths from the original <code>Tuple</code>. E.g.: <code>Tuple(a Int, Tuple(b Int, c Int)) -&gt; Tuple(a Int, b Int, c Int)</code>. <code>flattenTuple</code> can be used to select all paths from type <code>Object</code> as separate columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/35690" target="_blank" rel="noopener noreferrer">#35690</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added functions <code>arrayFirstOrNull</code>, <code>arrayLastOrNull</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35238" target="_blank" rel="noopener noreferrer">#35238</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35414" target="_blank" rel="noopener noreferrer">#35414</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added functions <code>minSampleSizeContinous</code> and <code>minSampleSizeConversion</code>. Author <a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35360" target="_blank" rel="noopener noreferrer">#35360</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>New functions minSampleSizeContinous and minSampleSizeConversion. <a href="https://github.com/ClickHouse/ClickHouse/pull/34354" target="_blank" rel="noopener noreferrer">#34354</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Introduce format <code>ProtobufList</code> (all records as repeated messages in out Protobuf). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16436" target="_blank" rel="noopener noreferrer">#16436</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35152" target="_blank" rel="noopener noreferrer">#35152</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Add <code>h3PointDistM</code>, <code>h3PointDistKm</code>, <code>h3PointDistRads</code>, <code>h3GetRes0Indexes</code>, <code>h3GetPentagonIndexes</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/34568" target="_blank" rel="noopener noreferrer">#34568</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>toLastDayOfMonth</code> function which rounds up a date or date with time to the last day of the month. <a href="https://github.com/ClickHouse/ClickHouse/issues/33501" target="_blank" rel="noopener noreferrer">#33501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34394" target="_blank" rel="noopener noreferrer">#34394</a> (<a href="https://github.com/holadepo" target="_blank" rel="noopener noreferrer">Habibullah Oladepo</a>).</li><li>New aggregation function groupSortedArray to obtain an array of first N values. <a href="https://github.com/ClickHouse/ClickHouse/pull/34055" target="_blank" rel="noopener noreferrer">#34055</a> (<a href="https://github.com/palegre-tiny" target="_blank" rel="noopener noreferrer">palegre-tiny</a>).</li><li>Added load balancing setting for <!-- -->[<!-- -->Zoo<!-- -->]<!-- -->Keeper client. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29617" target="_blank" rel="noopener noreferrer">#29617</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30325" target="_blank" rel="noopener noreferrer">#30325</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Add a new kind of row policies named <code>simple</code>. Before this PR we had two kinds or row policies: <code>permissive</code> and <code>restrictive</code>. A <code>simple</code> row policy adds a new filter on a table without any side-effects like it was for permissive and restrictive policies. <a href="https://github.com/ClickHouse/ClickHouse/pull/35345" target="_blank" rel="noopener noreferrer">#35345</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Added an ability to specify cluster secret in replicated database. <a href="https://github.com/ClickHouse/ClickHouse/pull/35333" target="_blank" rel="noopener noreferrer">#35333</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added sanity checks on server startup (available memory and disk space, max thread count, etc). <a href="https://github.com/ClickHouse/ClickHouse/pull/34566" target="_blank" rel="noopener noreferrer">#34566</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>INTERVAL improvement - can be used with <code>[MILLI|MICRO|NANO]SECOND</code>. Added <code>toStartOf[Milli|Micro|Nano]second()</code> functions. Added <code>[add|subtract][Milli|Micro|Nano]seconds()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34353" target="_blank" rel="noopener noreferrer">#34353</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature">Experimental Feature<a class="hash-link" href="#experimental-feature" title="Direct link to heading">​</a></h4><ul><li>Added support for transactions for simple <code>MergeTree</code> tables. This feature is highly experimental and not recommended for production. Part of <a href="https://github.com/ClickHouse/ClickHouse/issues/22086" target="_blank" rel="noopener noreferrer">#22086</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24258" target="_blank" rel="noopener noreferrer">#24258</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Support schema inference for type <code>Object</code> in format <code>JSONEachRow</code>. Allow to convert columns of type <code>Map</code> to columns of type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35629" target="_blank" rel="noopener noreferrer">#35629</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Allow to write remote FS cache on all write operations. Add <code>system.remote_filesystem_cache</code> table. Add <code>drop remote filesystem cache</code> query. Add introspection for s3 metadata with <code>system.remote_data_paths</code> table. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34021" target="_blank" rel="noopener noreferrer">#34021</a>. Add cache option for merges by adding mode <code>read_from_filesystem_cache_if_exists_otherwise_bypass_cache</code> (turned on by default for merges and can also be turned on by query setting with the same name). Rename cache related settings (<code>remote_fs_enable_cache -&gt; enable_filesystem_cache</code>, etc). <a href="https://github.com/ClickHouse/ClickHouse/pull/35475" target="_blank" rel="noopener noreferrer">#35475</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>An option to store parts metadata in RocksDB. Speed up parts loading process of MergeTree to accelerate starting up of clickhouse-server. With this improvement, clickhouse-server was able to decrease starting up time from 75 minutes to 20 seconds, with 700k mergetree parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/32928" target="_blank" rel="noopener noreferrer">#32928</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement">Performance Improvement<a class="hash-link" href="#performance-improvement" title="Direct link to heading">​</a></h4><ul><li>A new query plan optimization. Evaluate functions after <code>ORDER BY</code> when possible. As an example, for a query <code>SELECT sipHash64(number) FROM numbers(1e8) ORDER BY number LIMIT 5</code>, function <code>sipHash64</code> would be evaluated after <code>ORDER BY</code> and <code>LIMIT</code>, which gives ~20x speed up. <a href="https://github.com/ClickHouse/ClickHouse/pull/35623" target="_blank" rel="noopener noreferrer">#35623</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Sizes of hash tables used during aggregation now collected and used in later queries to avoid hash tables resizes. <a href="https://github.com/ClickHouse/ClickHouse/pull/33439" target="_blank" rel="noopener noreferrer">#33439</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Improvement for hasAll function using SIMD instructions (SSE and AVX2). <a href="https://github.com/ClickHouse/ClickHouse/pull/27653" target="_blank" rel="noopener noreferrer">#27653</a> (<a href="https://github.com/youennL-cs" target="_blank" rel="noopener noreferrer">youennL-cs</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/35723" target="_blank" rel="noopener noreferrer">#35723</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Multiple changes to improve ASOF JOIN performance (1.2 - 1.6x as fast). It also adds support to use big integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/34733" target="_blank" rel="noopener noreferrer">#34733</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Improve performance of ASOF JOIN if key is native integer. <a href="https://github.com/ClickHouse/ClickHouse/pull/35525" target="_blank" rel="noopener noreferrer">#35525</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Parallelization of multipart upload into S3 storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/35343" target="_blank" rel="noopener noreferrer">#35343</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>URL storage engine now downloads multiple chunks in parallel if the endpoint supports HTTP Range. Two additional settings were added, <code>max_download_threads</code> and <code>max_download_buffer_size</code>, which control maximum number of threads a single query can use to download the file and the maximum number of bytes each thread can process. <a href="https://github.com/ClickHouse/ClickHouse/pull/35150" target="_blank" rel="noopener noreferrer">#35150</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Use multiple threads to download objects from S3. Downloading is controllable using <code>max_download_threads</code> and <code>max_download_buffer_size</code> settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/35571" target="_blank" rel="noopener noreferrer">#35571</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Narrow mutex scope when interacting with HDFS. Related to <a href="https://github.com/ClickHouse/ClickHouse/issues/35292" target="_blank" rel="noopener noreferrer">#35292</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35646" target="_blank" rel="noopener noreferrer">#35646</a> (<a href="https://github.com/shuchaome" target="_blank" rel="noopener noreferrer">shuchaome</a>).</li><li>Require mutations for per-table TTL only when it had been changed. <a href="https://github.com/ClickHouse/ClickHouse/pull/35953" target="_blank" rel="noopener noreferrer">#35953</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement">Improvement<a class="hash-link" href="#improvement" title="Direct link to heading">​</a></h4><ul><li>Multiple improvements for schema inference. Use some tweaks and heuristics to determine numbers, strings, arrays, tuples and maps in CSV, TSV and TSVRaw data formats. Add setting <code>input_format_csv_use_best_effort_in_schema_inference</code> for CSV format that enables/disables using these heuristics, if it&#x27;s disabled, we treat everything as string. Add similar setting <code>input_format_tsv_use_best_effort_in_schema_inference</code> for TSV/TSVRaw format. These settings are enabled by default. - Add Maps support for schema inference in Values format. - Fix possible segfault in schema inference in Values format. - Allow to skip columns with unsupported types in Arrow/ORC/Parquet formats. Add corresponding settings for it: <code>input_format_{parquet|orc|arrow}_skip_columns_with_unsupported_types_in_schema_inference</code>. These settings are disabled by default. - Allow to convert a column with type Null to a Nullable column with all NULL values in Arrow/Parquet formats. - Allow to specify column names in schema inference via setting <code>column_names_for_schema_inference</code> for formats that don&#x27;t contain column names (like CSV, TSV, JSONCompactEachRow, etc) - Fix schema inference in ORC/Arrow/Parquet formats in terms of working with Nullable columns. Previously all inferred types were not Nullable and it blocked reading Nullable columns from data, now it&#x27;s fixed and all inferred types are always Nullable (because we cannot understand that column is Nullable or not by reading the schema). - Fix schema inference in Template format with CSV escaping rules. <a href="https://github.com/ClickHouse/ClickHouse/pull/35582" target="_blank" rel="noopener noreferrer">#35582</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add parallel parsing and schema inference for format <code>JSONAsObject</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35592" target="_blank" rel="noopener noreferrer">#35592</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added a support for automatic schema inference to <code>s3Cluster</code> table function. Synced the signatures of <code>s3 </code> and <code>s3Cluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35544" target="_blank" rel="noopener noreferrer">#35544</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added support for schema inference for <code>hdfsCluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35602" target="_blank" rel="noopener noreferrer">#35602</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add new setting <code>input_format_json_read_bools_as_numbers</code> that allows to infer and parse bools as numbers in JSON input formats. It&#x27;s enabled by default. Suggested by @alexey-milovidov. <a href="https://github.com/ClickHouse/ClickHouse/pull/35735" target="_blank" rel="noopener noreferrer">#35735</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Improve columns ordering in schema inference for formats TSKV and JSONEachRow, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35640" target="_blank" rel="noopener noreferrer">#35640</a>. Don&#x27;t stop schema inference when reading empty row in schema inference for formats TSKV and JSONEachRow. <a href="https://github.com/ClickHouse/ClickHouse/pull/35724" target="_blank" rel="noopener noreferrer">#35724</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add settings <code>input_format_orc_case_insensitive_column_matching</code>, <code>input_format_arrow_case_insensitive_column_matching</code>, and <code>input_format_parquet_case_insensitive_column_matching</code> which allows ClickHouse to use case insensitive matching of columns while reading data from ORC, Arrow or Parquet files. <a href="https://github.com/ClickHouse/ClickHouse/pull/35459" target="_blank" rel="noopener noreferrer">#35459</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Added <code>is_secure</code> column to <code>system.query_log</code> which denotes if the client is using a secure connection over TCP or HTTP. <a href="https://github.com/ClickHouse/ClickHouse/pull/35705" target="_blank" rel="noopener noreferrer">#35705</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Now <code>kafka_num_consumers</code> can be bigger than amount of physical cores in case of low resource machine (less than 16 cores). <a href="https://github.com/ClickHouse/ClickHouse/pull/35926" target="_blank" rel="noopener noreferrer">#35926</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add some basic metrics to monitor engine=Kafka tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/35916" target="_blank" rel="noopener noreferrer">#35916</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Now it&#x27;s not allowed to <code>ALTER TABLE ... RESET SETTING</code> for non-existing settings for MergeTree engines family. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35816" target="_blank" rel="noopener noreferrer">#35816</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35884" target="_blank" rel="noopener noreferrer">#35884</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now some <code>ALTER MODIFY COLUMN</code> queries for <code>Arrays</code> and <code>Nullable</code> types can be done at metadata level without mutations. For example, alter from <code>Array(Enum8(&#x27;Option1&#x27;=1))</code> to <code>Array(Enum8(&#x27;Option1&#x27;=1, &#x27;Option2&#x27;=2))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35882" target="_blank" rel="noopener noreferrer">#35882</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Added an animation to the hourglass icon to indicate to the user that a query is running. <a href="https://github.com/ClickHouse/ClickHouse/pull/35860" target="_blank" rel="noopener noreferrer">#35860</a> (<a href="https://github.com/peledni" target="_blank" rel="noopener noreferrer">peledni</a>).</li><li>support ALTER TABLE t DETACH PARTITION (ALL). <a href="https://github.com/ClickHouse/ClickHouse/pull/35794" target="_blank" rel="noopener noreferrer">#35794</a> (<a href="https://github.com/awakeljw" target="_blank" rel="noopener noreferrer">awakeljw</a>).</li><li>Improve projection analysis to optimize trivial queries such as <code>count()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35788" target="_blank" rel="noopener noreferrer">#35788</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support schema inference for insert select with using <code>input</code> table function. Get schema from insertion table instead of inferring it from the data in case of insert select from table functions that support schema inference. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35639" target="_blank" rel="noopener noreferrer">#35639</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35760" target="_blank" rel="noopener noreferrer">#35760</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Respect <code>remote_url_allow_hosts</code> for Hive tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/35743" target="_blank" rel="noopener noreferrer">#35743</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Implement <code>send_logs_level</code> for clickhouse-local. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35653" target="_blank" rel="noopener noreferrer">#35653</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35716" target="_blank" rel="noopener noreferrer">#35716</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35641" target="_blank" rel="noopener noreferrer">#35641</a> Allow <code>EPHEMERAL</code> columns without explicit default expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/35706" target="_blank" rel="noopener noreferrer">#35706</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">Yakov Olkhovskiy</a>).</li><li>Add profile event counter <code>AsyncInsertBytes</code> about size of async INSERTs. <a href="https://github.com/ClickHouse/ClickHouse/pull/35644" target="_blank" rel="noopener noreferrer">#35644</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Improve the pipeline description for JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/35612" target="_blank" rel="noopener noreferrer">#35612</a> (<a href="https://github.com/helifu" target="_blank" rel="noopener noreferrer">何李夫</a>).</li><li>Deduce absolute hdfs config path. <a href="https://github.com/ClickHouse/ClickHouse/pull/35572" target="_blank" rel="noopener noreferrer">#35572</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Improve pasting performance and compatibility of clickhouse-client. This helps <a href="https://github.com/ClickHouse/ClickHouse/issues/35501" target="_blank" rel="noopener noreferrer">#35501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35541" target="_blank" rel="noopener noreferrer">#35541</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>It was possible to get stack overflow in distributed queries if one of the settings <code>async_socket_for_remote</code> and <code>use_hedged_requests</code> is enabled while parsing very deeply nested data type (at least in debug build). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35509" target="_blank" rel="noopener noreferrer">#35509</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35524" target="_blank" rel="noopener noreferrer">#35524</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add sizes of subcolumns to <code>system.parts_columns</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/35488" target="_blank" rel="noopener noreferrer">#35488</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add explicit table info to the scan node of query plan and pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/35460" target="_blank" rel="noopener noreferrer">#35460</a> (<a href="https://github.com/helifu" target="_blank" rel="noopener noreferrer">何李夫</a>).</li><li>Allow server to bind to low-numbered ports (e.g. 443). ClickHouse installation script will set <code>cap_net_bind_service</code> to the binary file. <a href="https://github.com/ClickHouse/ClickHouse/pull/35451" target="_blank" rel="noopener noreferrer">#35451</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Fix INSERT INTO table FROM INFILE: it did not display the progress bar. <a href="https://github.com/ClickHouse/ClickHouse/pull/35429" target="_blank" rel="noopener noreferrer">#35429</a> (<a href="https://github.com/xiedeyantu" target="_blank" rel="noopener noreferrer">xiedeyantu</a>).</li><li>Add arguments <code>--user</code>, <code>--password</code>, <code>--host</code>, <code>--port</code> for <code>clickhouse-diagnostics</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/35422" target="_blank" rel="noopener noreferrer">#35422</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Support uuid for Postgres engines. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35384" target="_blank" rel="noopener noreferrer">#35384</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35403" target="_blank" rel="noopener noreferrer">#35403</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>For table function <code>s3cluster</code> or <code>HDFSCluster</code> or <code>hive</code>, we can&#x27;t get right <code>AccessType</code> by <code>StorageFactory::instance().getSourceAccessType(getStorageTypeName())</code>. This pr fix it. <a href="https://github.com/ClickHouse/ClickHouse/pull/35365" target="_blank" rel="noopener noreferrer">#35365</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Remove <code>--testmode</code> option for clickhouse-client, enable it unconditionally. <a href="https://github.com/ClickHouse/ClickHouse/pull/35354" target="_blank" rel="noopener noreferrer">#35354</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Don&#x27;t allow <code>wchc</code> operation (four letter command) for clickhouse-keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/35320" target="_blank" rel="noopener noreferrer">#35320</a> (<a href="https://github.com/zhangyuli1" target="_blank" rel="noopener noreferrer">zhangyuli1</a>).</li><li>Add function <code>getTypeSerializationStreams</code>. For a specified type (which is detected from column), it returns an array with all the serialization substream paths. This function is useful mainly for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/35290" target="_blank" rel="noopener noreferrer">#35290</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>If <code>port</code> is not specified in cluster configuration, default server port will be used. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34769" target="_blank" rel="noopener noreferrer">#34769</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34772" target="_blank" rel="noopener noreferrer">#34772</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Use <code>minmax</code> index for orc/parquet file in Hive Engine. Related PR: <a href="https://github.com/ClickHouse/arrow/pull/10" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/arrow/pull/10</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34631" target="_blank" rel="noopener noreferrer">#34631</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>System log tables now allow to specify COMMENT in ENGINE declaration. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33768" target="_blank" rel="noopener noreferrer">#33768</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34536" target="_blank" rel="noopener noreferrer">#34536</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Proper support of setting <code>max_rows_to_read</code> in case of reading in order of sorting key and specified limit. Previously the exception <code>Limit for rows or bytes to read exceeded</code> could be thrown even if query actually requires to read less amount of rows. <a href="https://github.com/ClickHouse/ClickHouse/pull/33230" target="_blank" rel="noopener noreferrer">#33230</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Respect only quota &amp; period from cgroups, ignore shares (which are not really limit the number of the cores which can be used). <a href="https://github.com/ClickHouse/ClickHouse/pull/35815" target="_blank" rel="noopener noreferrer">#35815</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement" title="Direct link to heading">​</a></h4><ul><li>Add next batch of randomization settings in functional tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/35047" target="_blank" rel="noopener noreferrer">#35047</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add backward compatibility check in stress test. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25088" target="_blank" rel="noopener noreferrer">#25088</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27928" target="_blank" rel="noopener noreferrer">#27928</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Migrate package building to <code>nfpm</code> - Deprecate <code>release</code> script in favor of <code>packages/build</code> - Build everything in clickhouse/binary-builder image (cleanup: clickhouse/deb-builder) - Add symbol stripping to cmake (todo: use $prefix/lib/$bin_dir/clickhouse/$binary.debug) - Fix issue with DWARF symbols - Add Alpine APK packages - Rename <code>alien</code> to <code>additional_pkgs</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33664" target="_blank" rel="noopener noreferrer">#33664</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Add a night scan and upload for Coverity. <a href="https://github.com/ClickHouse/ClickHouse/pull/34895" target="_blank" rel="noopener noreferrer">#34895</a> (<a href="https://github.com/bkuschel" target="_blank" rel="noopener noreferrer">Boris Kuschel</a>).</li><li>A dedicated small package for <code>clickhouse-keeper</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35308" target="_blank" rel="noopener noreferrer">#35308</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Running with podman was failing: it complains about specifying the same volume twice. <a href="https://github.com/ClickHouse/ClickHouse/pull/35978" target="_blank" rel="noopener noreferrer">#35978</a> (<a href="https://github.com/nic11" target="_blank" rel="noopener noreferrer">Roman Nikonov</a>).</li><li>Minor improvement in contrib/krb5 build configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/35832" target="_blank" rel="noopener noreferrer">#35832</a> (<a href="https://github.com/tonickkozlov" target="_blank" rel="noopener noreferrer">Anton Kozlov</a>).</li><li>Add a label to recognize a building task for every image. <a href="https://github.com/ClickHouse/ClickHouse/pull/35583" target="_blank" rel="noopener noreferrer">#35583</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Apply <code>black</code> formatter to python code and add a per-commit check. <a href="https://github.com/ClickHouse/ClickHouse/pull/35466" target="_blank" rel="noopener noreferrer">#35466</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Redo alpine image to use clean Dockerfile. Create a script in tests/ci to build both ubuntu and alpine images. Add clickhouse-keeper image (cc @nikitamikhaylov). Add build check to PullRequestCI. Add a job to a ReleaseCI. Add a job to MasterCI to build and push <code>clickhouse/clickhouse-server:head</code> and <code>clickhouse/clickhouse-keeper:head</code> images for each merged PR. <a href="https://github.com/ClickHouse/ClickHouse/pull/35211" target="_blank" rel="noopener noreferrer">#35211</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Fix stress-test report in CI, now we upload the runlog with information about started stress tests only once. <a href="https://github.com/ClickHouse/ClickHouse/pull/35093" target="_blank" rel="noopener noreferrer">#35093</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Switch to libcxx / libcxxabi from LLVM 14. <a href="https://github.com/ClickHouse/ClickHouse/pull/34906" target="_blank" rel="noopener noreferrer">#34906</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Update unixodbc to mitigate CVE-2018-7485. Note: this CVE is not relevant for ClickHouse as it implements its own isolation layer for ODBC. <a href="https://github.com/ClickHouse/ClickHouse/pull/35943" target="_blank" rel="noopener noreferrer">#35943</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix">Bug Fix<a class="hash-link" href="#bug-fix" title="Direct link to heading">​</a></h4><ul><li>Added settings <code>input_format_ipv4_default_on_conversion_error</code>, <code>input_format_ipv6_default_on_conversion_error</code> to allow insert of invalid ip address values as default into tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35726" target="_blank" rel="noopener noreferrer">#35726</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35733" target="_blank" rel="noopener noreferrer">#35733</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Avoid erasing columns from a block if it doesn&#x27;t exist while reading data from Hive. <a href="https://github.com/ClickHouse/ClickHouse/pull/35393" target="_blank" rel="noopener noreferrer">#35393</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Add type checking when creating materialized view. Close: <a href="https://github.com/ClickHouse/ClickHouse/issues/23684" target="_blank" rel="noopener noreferrer">#23684</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24896" target="_blank" rel="noopener noreferrer">#24896</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix formatting of INSERT INFILE queries (missing quotes). <a href="https://github.com/ClickHouse/ClickHouse/pull/35886" target="_blank" rel="noopener noreferrer">#35886</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Disable <code>session_log</code> because memory safety issue has been found by fuzzing. See <a href="https://github.com/ClickHouse/ClickHouse/issues/35714" target="_blank" rel="noopener noreferrer">#35714</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35873" target="_blank" rel="noopener noreferrer">#35873</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Avoid processing per-column TTL multiple times. <a href="https://github.com/ClickHouse/ClickHouse/pull/35820" target="_blank" rel="noopener noreferrer">#35820</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix inserts to columns of type <code>Object</code> in case when there is data related to several partitions in insert query. <a href="https://github.com/ClickHouse/ClickHouse/pull/35806" target="_blank" rel="noopener noreferrer">#35806</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix bug in indexes of not presented columns in -WithNames formats that led to error <code>INCORRECT_NUMBER_OF_COLUMNS </code> when the number of columns is more than 256. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35793" target="_blank" rel="noopener noreferrer">#35793</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35803" target="_blank" rel="noopener noreferrer">#35803</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35751" target="_blank" rel="noopener noreferrer">#35751</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35799" target="_blank" rel="noopener noreferrer">#35799</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix for reading from HDFS in Snappy format. <a href="https://github.com/ClickHouse/ClickHouse/pull/35771" target="_blank" rel="noopener noreferrer">#35771</a> (<a href="https://github.com/shuchaome" target="_blank" rel="noopener noreferrer">shuchaome</a>).</li><li>Fix bug in conversion from custom types to string that could lead to segfault or unexpected error messages. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35752" target="_blank" rel="noopener noreferrer">#35752</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35755" target="_blank" rel="noopener noreferrer">#35755</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix any/all (subquery) implementation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35489" target="_blank" rel="noopener noreferrer">#35489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35727" target="_blank" rel="noopener noreferrer">#35727</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix dropping non-empty database in clickhouse-local. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35692" target="_blank" rel="noopener noreferrer">#35692</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35711" target="_blank" rel="noopener noreferrer">#35711</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix bug in creating materialized view with subquery after server restart. Materialized view was not getting updated after inserts into underlying table after server restart. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35511" target="_blank" rel="noopener noreferrer">#35511</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35691" target="_blank" rel="noopener noreferrer">#35691</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible <code>Can&#x27;t adjust last granule</code> exception while reading subcolumns of experimental type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35687" target="_blank" rel="noopener noreferrer">#35687</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Enable build with JIT compilation by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/35683" target="_blank" rel="noopener noreferrer">#35683</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix possible loss of subcolumns in experimental type <code>Object</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35682" target="_blank" rel="noopener noreferrer">#35682</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix check ASOF JOIN key nullability, close <a href="https://github.com/ClickHouse/ClickHouse/issues/35565" target="_blank" rel="noopener noreferrer">#35565</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35674" target="_blank" rel="noopener noreferrer">#35674</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix part checking logic for parts with projections. Error happened when projection and main part had different types. This is similar to <a href="https://github.com/ClickHouse/ClickHouse/pull/33774" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/33774</a> . The bug is addressed by @caoyang10. <a href="https://github.com/ClickHouse/ClickHouse/pull/35667" target="_blank" rel="noopener noreferrer">#35667</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix server crash when large number of arguments are passed into <code>format</code> function. Please refer to the test file and see how to reproduce the crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/35651" target="_blank" rel="noopener noreferrer">#35651</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix usage of quotas with asynchronous inserts. <a href="https://github.com/ClickHouse/ClickHouse/pull/35645" target="_blank" rel="noopener noreferrer">#35645</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix positional arguments with aliases. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35600" target="_blank" rel="noopener noreferrer">#35600</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35620" target="_blank" rel="noopener noreferrer">#35620</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Check <code>remote_url_allow_hosts</code> before schema inference in URL engine Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35064" target="_blank" rel="noopener noreferrer">#35064</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35619" target="_blank" rel="noopener noreferrer">#35619</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>HashJoin</code> when columns with <code>LowCardinality</code> type are used. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35548" target="_blank" rel="noopener noreferrer">#35548</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35616" target="_blank" rel="noopener noreferrer">#35616</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix possible segfault in MaterializedPostgreSQL which happened if exception occurred when data, collected in memory, was synced into underlying tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35611" target="_blank" rel="noopener noreferrer">#35611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35614" target="_blank" rel="noopener noreferrer">#35614</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Setting <code>database_atomic_wait_for_drop_and_detach_synchronously</code> worked incorrectly for <code>ATTACH TABLE</code> query when previously detached table is still in use, It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/35594" target="_blank" rel="noopener noreferrer">#35594</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix HTTP headers with named collections, add compression_method. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35273" target="_blank" rel="noopener noreferrer">#35273</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35269" target="_blank" rel="noopener noreferrer">#35269</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35593" target="_blank" rel="noopener noreferrer">#35593</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix s3 engine getting virtual columns. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35411" target="_blank" rel="noopener noreferrer">#35411</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35586" target="_blank" rel="noopener noreferrer">#35586</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed return type deduction for <code>caseWithExpression</code>. The type of the ELSE branch is now correctly taken into account. <a href="https://github.com/ClickHouse/ClickHouse/pull/35576" target="_blank" rel="noopener noreferrer">#35576</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Fix parsing of IPv6 addresses longer than 39 characters. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34022" target="_blank" rel="noopener noreferrer">#34022</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35539" target="_blank" rel="noopener noreferrer">#35539</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix cast into IPv4, IPv6 address in IN section. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35528" target="_blank" rel="noopener noreferrer">#35528</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35534" target="_blank" rel="noopener noreferrer">#35534</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash during short circuit function evaluation when one of arguments is nullable constant. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35497" target="_blank" rel="noopener noreferrer">#35497</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35496" target="_blank" rel="noopener noreferrer">#35496</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35502" target="_blank" rel="noopener noreferrer">#35502</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash for function <code>throwIf</code> with constant arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/35500" target="_blank" rel="noopener noreferrer">#35500</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix bug in Keeper which can lead to unstable client connections. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/35031" target="_blank" rel="noopener noreferrer">#35031</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35498" target="_blank" rel="noopener noreferrer">#35498</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug in function <code>if</code> when resulting column type differs with resulting data type that led to logical errors like <code>Logical error: &#x27;Bad cast from type DB::ColumnVector&lt;int&gt; to DB::ColumnVector&lt;long&gt;&#x27;.</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35367" target="_blank" rel="noopener noreferrer">#35367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35476" target="_blank" rel="noopener noreferrer">#35476</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix excessive logging when using S3 as backend for MergeTree or as separate table engine/function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30559" target="_blank" rel="noopener noreferrer">#30559</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35434" target="_blank" rel="noopener noreferrer">#35434</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now merges executed with zero copy replication (experimental) will not spam logs with message <code>Found parts with the same min block and with the same max block as the missing part _ on replica _. Hoping that it will eventually appear as a result of a merge.</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35430" target="_blank" rel="noopener noreferrer">#35430</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Skip possible exception if empty chunks appear in GroupingAggregatedTransform. <a href="https://github.com/ClickHouse/ClickHouse/pull/35417" target="_blank" rel="noopener noreferrer">#35417</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nikita Taranov</a>).</li><li>Fix working with columns that are not needed in query in Arrow/Parquet/ORC formats, it prevents possible errors like <code>Unsupported &lt;format&gt; type &lt;type&gt; of an input column &lt;column_name&gt;</code> when file contains column with unsupported type and we don&#x27;t use it in query. <a href="https://github.com/ClickHouse/ClickHouse/pull/35406" target="_blank" rel="noopener noreferrer">#35406</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix for local cache for remote filesystem (experimental feature) for high concurrency on corner cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/35381" target="_blank" rel="noopener noreferrer">#35381</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Fix possible deadlock in cache. <a href="https://github.com/ClickHouse/ClickHouse/pull/35378" target="_blank" rel="noopener noreferrer">#35378</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix partition pruning in case of comparison with constant in <code>WHERE</code>. If column and constant had different types, overflow was possible. Query could return an incorrect empty result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35304" target="_blank" rel="noopener noreferrer">#35304</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35334" target="_blank" rel="noopener noreferrer">#35334</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix schema inference for TSKV format while using small max_read_buffer_size. <a href="https://github.com/ClickHouse/ClickHouse/pull/35332" target="_blank" rel="noopener noreferrer">#35332</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix mutations in tables with enabled sparse columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/35284" target="_blank" rel="noopener noreferrer">#35284</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Do not delay final part writing by default (fixes possible <code>Memory limit exceeded</code> during <code>INSERT</code> by adding <code>max_insert_delayed_streams_for_parallel_write</code> with default to 1000 for writes to s3 and disabled as before otherwise). <a href="https://github.com/ClickHouse/ClickHouse/pull/34780" target="_blank" rel="noopener noreferrer">#34780</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v223-lts-2022-03-17">ClickHouse release v22.3-lts, 2022-03-17<a class="hash-link" href="#clickhouse-release-v223-lts-2022-03-17" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-1">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-1" title="Direct link to heading">​</a></h4><ul><li>Make <code>arrayCompact</code> function behave as other higher-order functions: perform compaction not of lambda function results but on the original array. If you&#x27;re using nontrivial lambda functions in arrayCompact you may restore old behaviour by wrapping <code>arrayCompact</code> arguments into <code>arrayMap</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34010" target="_blank" rel="noopener noreferrer">#34010</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/18535" target="_blank" rel="noopener noreferrer">#18535</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/14778" target="_blank" rel="noopener noreferrer">#14778</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34795" target="_blank" rel="noopener noreferrer">#34795</a> (<a href="https://github.com/snar" target="_blank" rel="noopener noreferrer">Alexandre Snarskii</a>).</li><li>Change implementation specific behavior on overflow of function <code>toDatetime</code>. It will be saturated to the nearest min/max supported instant of datetime instead of wraparound. This change is highlighted as &quot;backward incompatible&quot; because someone may unintentionally rely on the old behavior. <a href="https://github.com/ClickHouse/ClickHouse/pull/32898" target="_blank" rel="noopener noreferrer">#32898</a> (<a href="https://github.com/marising" target="_blank" rel="noopener noreferrer">HaiBo Li</a>).</li><li>Make function <code>cast(value, &#x27;IPv4&#x27;)</code>, <code>cast(value, &#x27;IPv6&#x27;)</code> behave same as <code>toIPv4</code>, <code>toIPv6</code> functions. Changed behavior of incorrect IP address passed into functions <code>toIPv4</code>,<code> toIPv6</code>,  now if invalid IP address passes into this functions exception will be raised, before this function return default value. Added functions <code>IPv4StringToNumOrDefault</code>, <code>IPv4StringToNumOrNull</code>, <code>IPv6StringToNumOrDefault</code>, <code>IPv6StringOrNull</code> <code>toIPv4OrDefault</code>, <code>toIPv4OrNull</code>, <code>toIPv6OrDefault</code>, <code>toIPv6OrNull</code>. Functions <code>IPv4StringToNumOrDefault </code>, <code>toIPv4OrDefault </code>, <code>toIPv6OrDefault </code> should be used if previous logic relied on <code>IPv4StringToNum</code>, <code>toIPv4</code>, <code>toIPv6</code> returning default value for invalid address. Added setting <code>cast_ipv4_ipv6_default_on_conversion_error</code>, if this setting enabled, then IP address conversion functions will behave as before. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22825" target="_blank" rel="noopener noreferrer">#22825</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5799" target="_blank" rel="noopener noreferrer">#5799</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35156" target="_blank" rel="noopener noreferrer">#35156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35240" target="_blank" rel="noopener noreferrer">#35240</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-1">New Feature<a class="hash-link" href="#new-feature-1" title="Direct link to heading">​</a></h4><ul><li>Support for caching data locally for remote filesystems. It can be enabled for <code>s3</code> disks. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28961" target="_blank" rel="noopener noreferrer">#28961</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33717" target="_blank" rel="noopener noreferrer">#33717</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). In the meantime, we enabled the test suite on s3 filesystem and no more known issues exist, so it is started to be production ready.</li><li>Add new table function <code>hive</code>. It can be used as follows <code>hive(&#x27;&lt;hive metastore url&gt;&#x27;, &#x27;&lt;hive database&gt;&#x27;, &#x27;&lt;hive table name&gt;&#x27;, &#x27;&lt;columns definition&gt;&#x27;, &#x27;&lt;partition columns&gt;&#x27;)</code> for example <code>SELECT * FROM hive(&#x27;thrift://hivetest:9083&#x27;, &#x27;test&#x27;, &#x27;demo&#x27;, &#x27;id Nullable(String), score Nullable(Int32), day Nullable(String)&#x27;, &#x27;day&#x27;)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34946" target="_blank" rel="noopener noreferrer">#34946</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Support authentication of users connected via SSL by their X.509 certificate. <a href="https://github.com/ClickHouse/ClickHouse/pull/31484" target="_blank" rel="noopener noreferrer">#31484</a> (<a href="https://github.com/eungenue" target="_blank" rel="noopener noreferrer">eungenue</a>).</li><li>Support schema inference for inserting into table functions <code>file</code>/<code>hdfs</code>/<code>s3</code>/<code>url</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34732" target="_blank" rel="noopener noreferrer">#34732</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Now you can read <code>system.zookeeper</code> table without restrictions on path or using <code>like</code> expression. This reads can generate quite heavy load for zookeeper so to enable this ability you have to enable setting <code>allow_unrestricted_reads_from_keeper</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34609" target="_blank" rel="noopener noreferrer">#34609</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Display CPU and memory metrics in clickhouse-local. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/34545" target="_blank" rel="noopener noreferrer">#34545</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34605" target="_blank" rel="noopener noreferrer">#34605</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Implement <code>startsWith</code> and <code>endsWith</code> function for arrays, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33982" target="_blank" rel="noopener noreferrer">#33982</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34368" target="_blank" rel="noopener noreferrer">#34368</a> (<a href="https://github.com/usurai" target="_blank" rel="noopener noreferrer">usurai</a>).</li><li>Add three functions for Map data type: 1. <code>mapReplace(map1, map2)</code> - replaces values for keys in map1 with the values of the corresponding keys in map2; adds keys from map2 that don&#x27;t exist in map1. 2. <code>mapFilter</code> 3. <code>mapMap</code>. mapFilter and mapMap are higher order functions, accepting two arguments, the first argument is a lambda function with k, v pair as arguments, the second argument is a column of type Map. <a href="https://github.com/ClickHouse/ClickHouse/pull/33698" target="_blank" rel="noopener noreferrer">#33698</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Allow getting default user and password for clickhouse-client from the <code>CLICKHOUSE_USER</code> and <code>CLICKHOUSE_PASSWORD</code> environment variables. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/34538" target="_blank" rel="noopener noreferrer">#34538</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34947" target="_blank" rel="noopener noreferrer">#34947</a> (<a href="https://github.com/freedomDR" target="_blank" rel="noopener noreferrer">DR</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-1">Experimental Feature<a class="hash-link" href="#experimental-feature-1" title="Direct link to heading">​</a></h4><ul><li>New data type <code>Object(&lt;schema_format&gt;)</code>, which supports storing of semi-structured data (for now JSON only). Data is written to such types as string. Then all paths are extracted according to format of semi-structured data and written as separate columns in most optimal types, that can store all their values. Those columns can be queried by names that match paths in source data. E.g <code>data.key1.key2</code> or with cast operator <code>data.key1.key2::Int64</code>.</li><li>Add <code>database_replicated_allow_only_replicated_engine</code> setting. When enabled, it only allowed to only create <code>Replicated</code> tables or tables with stateless engines in <code>Replicated</code> databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/35214" target="_blank" rel="noopener noreferrer">#35214</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>). Note that <code>Replicated</code> database is still an experimental feature.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-1">Performance Improvement<a class="hash-link" href="#performance-improvement-1" title="Direct link to heading">​</a></h4><ul><li>Improve performance of insertion into <code>MergeTree</code> tables by optimizing sorting. Up to 2x improvement is observed on realistic benchmarks. <a href="https://github.com/ClickHouse/ClickHouse/pull/34750" target="_blank" rel="noopener noreferrer">#34750</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Columns pruning when reading Parquet, ORC and Arrow files from URL and S3. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34163" target="_blank" rel="noopener noreferrer">#34163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34849" target="_blank" rel="noopener noreferrer">#34849</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Columns pruning when reading Parquet, ORC and Arrow files from Hive. <a href="https://github.com/ClickHouse/ClickHouse/pull/34954" target="_blank" rel="noopener noreferrer">#34954</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>A bunch of performance optimizations from a performance superhero. Improve performance of processing queries with large <code>IN</code> section. Improve performance of <code>direct</code> dictionary if its source is <code>ClickHouse</code>. Improve performance of <code>detectCharset </code>, <code>detectLanguageUnknown </code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/34888" target="_blank" rel="noopener noreferrer">#34888</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of <code>any</code> aggregate function by using more batching. <a href="https://github.com/ClickHouse/ClickHouse/pull/34760" target="_blank" rel="noopener noreferrer">#34760</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Multiple improvements for performance of <code>clickhouse-keeper</code>: less locking <a href="https://github.com/ClickHouse/ClickHouse/pull/35010" target="_blank" rel="noopener noreferrer">#35010</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>), lower memory usage by streaming reading and writing of snapshot instead of full copy. <a href="https://github.com/ClickHouse/ClickHouse/pull/34584" target="_blank" rel="noopener noreferrer">#34584</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>), optimizing compaction of log store in the RAFT implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/34534" target="_blank" rel="noopener noreferrer">#34534</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>), versioning of the internal data structure <a href="https://github.com/ClickHouse/ClickHouse/pull/34486" target="_blank" rel="noopener noreferrer">#34486</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-1">Improvement<a class="hash-link" href="#improvement-1" title="Direct link to heading">​</a></h4><ul><li>Allow asynchronous inserts to table functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34864" target="_blank" rel="noopener noreferrer">#34864</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34866" target="_blank" rel="noopener noreferrer">#34866</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Implicit type casting of the key argument for functions <code>dictGetHierarchy</code>, <code>dictIsIn</code>, <code>dictGetChildren</code>, <code>dictGetDescendants</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34970" target="_blank" rel="noopener noreferrer">#34970</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35027" target="_blank" rel="noopener noreferrer">#35027</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>EXPLAIN AST</code> query can output AST in form of a graph in Graphviz format: <code>EXPLAIN AST graph = 1 SELECT * FROM system.parts</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35173" target="_blank" rel="noopener noreferrer">#35173</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>When large files were written with <code>s3</code> table function or table engine, the content type on the files was mistakenly set to <code>application/xml</code> due to a bug in the AWS SDK. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33964" target="_blank" rel="noopener noreferrer">#33964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34433" target="_blank" rel="noopener noreferrer">#34433</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Change restrictive row policies a bit to make them an easier alternative to permissive policies in easy cases. If for a particular table only restrictive policies exist (without permissive policies) users will be able to see some rows. Also <code>SHOW CREATE ROW POLICY</code> will always show <code>AS permissive</code> or <code>AS restrictive</code> in row policy&#x27;s definition. <a href="https://github.com/ClickHouse/ClickHouse/pull/34596" target="_blank" rel="noopener noreferrer">#34596</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Improve schema inference with globs in File/S3/HDFS/URL engines. Try to use the next path for schema inference in case of error. <a href="https://github.com/ClickHouse/ClickHouse/pull/34465" target="_blank" rel="noopener noreferrer">#34465</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Play UI now correctly detects the preferred light/dark theme from the OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/35068" target="_blank" rel="noopener noreferrer">#35068</a> (<a href="https://github.com/peledni" target="_blank" rel="noopener noreferrer">peledni</a>).</li><li>Added <code>date_time_input_format = &#x27;best_effort_us&#x27;</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34799" target="_blank" rel="noopener noreferrer">#34799</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34982" target="_blank" rel="noopener noreferrer">#34982</a> (<a href="https://github.com/Cai-Yao" target="_blank" rel="noopener noreferrer">WenYao</a>).</li><li>A new settings called <code>allow_plaintext_password</code> and <code>allow_no_password</code> are added in server configuration which turn on/off authentication types that can be potentially insecure in some environments. They are allowed by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/34738" target="_blank" rel="noopener noreferrer">#34738</a> (<a href="https://github.com/HeenaBansal2009" target="_blank" rel="noopener noreferrer">Heena Bansal</a>).</li><li>Support for <code>DateTime64</code> data type in <code>Arrow</code> format, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8280" target="_blank" rel="noopener noreferrer">#8280</a> and closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28574" target="_blank" rel="noopener noreferrer">#28574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34561" target="_blank" rel="noopener noreferrer">#34561</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Reload <code>remote_url_allow_hosts</code> (filtering of outgoing connections) on config update. <a href="https://github.com/ClickHouse/ClickHouse/pull/35294" target="_blank" rel="noopener noreferrer">#35294</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Support <code>--testmode</code> parameter for <code>clickhouse-local</code>. This parameter enables interpretation of test hints that we use in functional tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/35264" target="_blank" rel="noopener noreferrer">#35264</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add <code>distributed_depth</code> to query log. It is like a more detailed variant of <code>is_initial_query</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/35207" target="_blank" rel="noopener noreferrer">#35207</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Respect <code>remote_url_allow_hosts</code> for <code>MySQL</code> and <code>PostgreSQL</code> table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/35191" target="_blank" rel="noopener noreferrer">#35191</a> (<a href="https://github.com/HeenaBansal2009" target="_blank" rel="noopener noreferrer">Heena Bansal</a>).</li><li>Added <code>disk_name</code> field to <code>system.part_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35178" target="_blank" rel="noopener noreferrer">#35178</a> (<a href="https://github.com/Varinara" target="_blank" rel="noopener noreferrer">Artyom Yurkov</a>).</li><li>Do not retry non-rertiable errors when querying remote URLs. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35161" target="_blank" rel="noopener noreferrer">#35161</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35172" target="_blank" rel="noopener noreferrer">#35172</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support distributed INSERT SELECT queries (the setting <code>parallel_distributed_insert_select</code>) table function <code>view()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35132" target="_blank" rel="noopener noreferrer">#35132</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>More precise memory tracking during <code>INSERT</code> into <code>Buffer</code> with <code>AggregateFunction</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35072" target="_blank" rel="noopener noreferrer">#35072</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Avoid division by zero in Query Profiler if Linux kernel has a bug. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34787" target="_blank" rel="noopener noreferrer">#34787</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35032" target="_blank" rel="noopener noreferrer">#35032</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Add more sanity checks for keeper configuration: now mixing of localhost and non-local servers is not allowed, also add checks for same value of internal raft port and keeper client port. <a href="https://github.com/ClickHouse/ClickHouse/pull/35004" target="_blank" rel="noopener noreferrer">#35004</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Currently, if the user changes the settings of the system tables there will be tons of logs and ClickHouse will rename the tables every minute. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34929" target="_blank" rel="noopener noreferrer">#34929</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34949" target="_blank" rel="noopener noreferrer">#34949</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Use connection pool for Hive metastore client. <a href="https://github.com/ClickHouse/ClickHouse/pull/34940" target="_blank" rel="noopener noreferrer">#34940</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Ignore per-column <code>TTL</code> in <code>CREATE TABLE AS</code> if new table engine does not support it (i.e. if the engine is not of <code>MergeTree</code> family). <a href="https://github.com/ClickHouse/ClickHouse/pull/34938" target="_blank" rel="noopener noreferrer">#34938</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow <code>LowCardinality</code> strings for <code>ngrambf_v1</code>/<code>tokenbf_v1</code> indexes. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21865" target="_blank" rel="noopener noreferrer">#21865</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34911" target="_blank" rel="noopener noreferrer">#34911</a> (<a href="https://github.com/larspars" target="_blank" rel="noopener noreferrer">Lars Hiller Eidnes</a>).</li><li>Allow opening empty sqlite db if the file doesn&#x27;t exist. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33367" target="_blank" rel="noopener noreferrer">#33367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34907" target="_blank" rel="noopener noreferrer">#34907</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Implement memory statistics for FreeBSD - this is required for <code>max_server_memory_usage</code> to work correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/34902" target="_blank" rel="noopener noreferrer">#34902</a> (<a href="https://github.com/snar" target="_blank" rel="noopener noreferrer">Alexandre Snarskii</a>).</li><li>In previous versions the progress bar in clickhouse-client can jump forward near 50% for no reason. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34324" target="_blank" rel="noopener noreferrer">#34324</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34801" target="_blank" rel="noopener noreferrer">#34801</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Now <code>ALTER TABLE DROP COLUMN columnX</code> queries for <code>MergeTree</code> table engines will work instantly when <code>columnX</code> is an <code>ALIAS</code> column. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34660" target="_blank" rel="noopener noreferrer">#34660</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34786" target="_blank" rel="noopener noreferrer">#34786</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Show hints when user mistyped the name of a data skipping index. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29698" target="_blank" rel="noopener noreferrer">#29698</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34764" target="_blank" rel="noopener noreferrer">#34764</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support <code>remote()</code>/<code>cluster()</code> table functions for <code>parallel_distributed_insert_select</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34728" target="_blank" rel="noopener noreferrer">#34728</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not reset logging that configured via <code>--log-file</code>/<code>--errorlog-file</code> command line options in case of empty configuration in the config file. <a href="https://github.com/ClickHouse/ClickHouse/pull/34718" target="_blank" rel="noopener noreferrer">#34718</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Extract schema only once on table creation and prevent reading from local files/external sources to extract schema on each server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/34684" target="_blank" rel="noopener noreferrer">#34684</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allow specifying argument names for executable UDFs. This is necessary for formats where argument name is part of serialization, like <code>Native</code>, <code>JSONEachRow</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34604" target="_blank" rel="noopener noreferrer">#34604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34653" target="_blank" rel="noopener noreferrer">#34653</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>MaterializedMySQL</code> (experimental feature) now supports <code>materialized_mysql_tables_list</code> (a comma-separated list of MySQL database tables, which will be replicated by the MaterializedMySQL database engine. Default value: empty list — means all the tables will be replicated), mentioned at <a href="https://github.com/ClickHouse/ClickHouse/issues/32977" target="_blank" rel="noopener noreferrer">#32977</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34487" target="_blank" rel="noopener noreferrer">#34487</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Improve OpenTelemetry span logs for INSERT operation on distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/34480" target="_blank" rel="noopener noreferrer">#34480</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Make the znode <code>ctime</code> and <code>mtime</code> consistent between servers in ClickHouse Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/33441" target="_blank" rel="noopener noreferrer">#33441</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-1">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-1" title="Direct link to heading">​</a></h4><ul><li>Package repository is migrated to JFrog Artifactory (<strong>Mikhail f. Shiryaev</strong>).</li><li>Randomize some settings in functional tests, so more possible combinations of settings will be tested. This is yet another fuzzing method to ensure better test coverage. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32268" target="_blank" rel="noopener noreferrer">#32268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34092" target="_blank" rel="noopener noreferrer">#34092</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Drop PVS-Studio from our CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/34680" target="_blank" rel="noopener noreferrer">#34680</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Add an ability to build stripped binaries with CMake. In previous versions it was performed by dh-tools. <a href="https://github.com/ClickHouse/ClickHouse/pull/35196" target="_blank" rel="noopener noreferrer">#35196</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Smaller &quot;fat-free&quot; <code>clickhouse-keeper</code> build. <a href="https://github.com/ClickHouse/ClickHouse/pull/35031" target="_blank" rel="noopener noreferrer">#35031</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Use @robot-clickhouse as an author and committer for PRs like <a href="https://github.com/ClickHouse/ClickHouse/pull/34685" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/34685</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34793" target="_blank" rel="noopener noreferrer">#34793</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Limit DWARF version for debug info by 4 max, because our internal stack symbolizer cannot parse DWARF version 5. This makes sense if you compile ClickHouse with clang-15. <a href="https://github.com/ClickHouse/ClickHouse/pull/34777" target="_blank" rel="noopener noreferrer">#34777</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">Alexey Milovidov</a>).</li><li>Remove <code>clickhouse-test</code> debian package as unneeded complication. CI use tests from repository and standalone testing via deb package is no longer supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/34606" target="_blank" rel="noopener noreferrer">#34606</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release">Bug Fix (user-visible misbehaviour in official stable or prestable release)<a class="hash-link" href="#bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release" title="Direct link to heading">​</a></h4><ul><li>A fix for HDFS integration: When the inner buffer size is too small, NEED_MORE_INPUT in <code>HadoopSnappyDecoder</code> will run multi times (&gt;=3) for one compressed block. This makes the input data be copied into the wrong place in <code>HadoopSnappyDecoder::buffer</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35116" target="_blank" rel="noopener noreferrer">#35116</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Ignore obsolete grants in ATTACH GRANT statements. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34815" target="_blank" rel="noopener noreferrer">#34815</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34855" target="_blank" rel="noopener noreferrer">#34855</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix segfault in Postgres database when getting create table query if database was created using named collections. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35312" target="_blank" rel="noopener noreferrer">#35312</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35313" target="_blank" rel="noopener noreferrer">#35313</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix partial merge join duplicate rows bug, close <a href="https://github.com/ClickHouse/ClickHouse/issues/31009" target="_blank" rel="noopener noreferrer">#31009</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35311" target="_blank" rel="noopener noreferrer">#35311</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix possible <code>Assertion &#x27;position() != working_buffer.end()&#x27; failed</code> while using bzip2 compression with small <code>max_read_buffer_size</code> setting value. The bug was found in <a href="https://github.com/ClickHouse/ClickHouse/pull/35047" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/35047</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35300" target="_blank" rel="noopener noreferrer">#35300</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). While using lz4 compression with a small max_read_buffer_size setting value. <a href="https://github.com/ClickHouse/ClickHouse/pull/35296" target="_blank" rel="noopener noreferrer">#35296</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). While using lzma compression with small <code>max_read_buffer_size</code> setting value. <a href="https://github.com/ClickHouse/ClickHouse/pull/35295" target="_blank" rel="noopener noreferrer">#35295</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). While using <code>brotli</code> compression with a small <code>max_read_buffer_size</code> setting value. The bug was found in <a href="https://github.com/ClickHouse/ClickHouse/pull/35047" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/35047</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35281" target="_blank" rel="noopener noreferrer">#35281</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible segfault in <code>JSONEachRow</code> schema inference. <a href="https://github.com/ClickHouse/ClickHouse/pull/35291" target="_blank" rel="noopener noreferrer">#35291</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>CHECK TABLE</code> query in case when sparse columns are enabled in table. <a href="https://github.com/ClickHouse/ClickHouse/pull/35274" target="_blank" rel="noopener noreferrer">#35274</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Avoid std::terminate in case of exception in reading from remote VFS. <a href="https://github.com/ClickHouse/ClickHouse/pull/35257" target="_blank" rel="noopener noreferrer">#35257</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix reading port from config, close <a href="https://github.com/ClickHouse/ClickHouse/issues/34776" target="_blank" rel="noopener noreferrer">#34776</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35193" target="_blank" rel="noopener noreferrer">#35193</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix error in query with <code>WITH TOTALS</code> in case if <code>HAVING</code> returned empty result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33711" target="_blank" rel="noopener noreferrer">#33711</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35186" target="_blank" rel="noopener noreferrer">#35186</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix a corner case of <code>replaceRegexpAll</code>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/35117" target="_blank" rel="noopener noreferrer">#35117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35182" target="_blank" rel="noopener noreferrer">#35182</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Schema inference didn&#x27;t work properly on case of <code>INSERT INTO FUNCTION s3(...) FROM ...</code>, it tried to read schema from s3 file instead of from select query. <a href="https://github.com/ClickHouse/ClickHouse/pull/35176" target="_blank" rel="noopener noreferrer">#35176</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix MaterializedPostgreSQL (experimental feature) <code>table overrides</code> for partition by, etc. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/35048" target="_blank" rel="noopener noreferrer">#35048</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35162" target="_blank" rel="noopener noreferrer">#35162</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix MaterializedPostgreSQL (experimental feature) adding new table to replication (ATTACH TABLE) after manually removing (DETACH TABLE). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33800" target="_blank" rel="noopener noreferrer">#33800</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34922" target="_blank" rel="noopener noreferrer">#34922</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34315" target="_blank" rel="noopener noreferrer">#34315</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35158" target="_blank" rel="noopener noreferrer">#35158</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix partition pruning error when non-monotonic function is used with IN operator. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/35136" target="_blank" rel="noopener noreferrer">#35136</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35146" target="_blank" rel="noopener noreferrer">#35146</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed slightly incorrect translation of YAML configs to XML. <a href="https://github.com/ClickHouse/ClickHouse/pull/35135" target="_blank" rel="noopener noreferrer">#35135</a> (<a href="https://github.com/mdonkers" target="_blank" rel="noopener noreferrer">Miel Donkers</a>).</li><li>Fix <code>optimize_skip_unused_shards_rewrite_in</code> for signed columns and negative values. <a href="https://github.com/ClickHouse/ClickHouse/pull/35134" target="_blank" rel="noopener noreferrer">#35134</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>The <code>update_lag</code> external dictionary configuration option was unusable showing the error message <code>Unexpected key `update_lag` in dictionary source configuration</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35089" target="_blank" rel="noopener noreferrer">#35089</a> (<a href="https://github.com/1lann" target="_blank" rel="noopener noreferrer">Jason Chu</a>).</li><li>Avoid possible deadlock on server shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/35081" target="_blank" rel="noopener noreferrer">#35081</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix missing alias after function is optimized to a subcolumn when setting <code>optimize_functions_to_subcolumns</code> is enabled. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33798" target="_blank" rel="noopener noreferrer">#33798</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35079" target="_blank" rel="noopener noreferrer">#35079</a> (<a href="https://github.com/qieqieplus" target="_blank" rel="noopener noreferrer">qieqieplus</a>).</li><li>Fix reading from <code>system.asynchronous_inserts</code> table if there exists asynchronous insert into table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/35050" target="_blank" rel="noopener noreferrer">#35050</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible exception <code>Reading for MergeTree family tables must be done with last position boundary</code> (relevant to operation on remote VFS). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34979" target="_blank" rel="noopener noreferrer">#34979</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/35001" target="_blank" rel="noopener noreferrer">#35001</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix unexpected result when use -State type aggregate function in window frame. <a href="https://github.com/ClickHouse/ClickHouse/pull/34999" target="_blank" rel="noopener noreferrer">#34999</a> (<a href="https://github.com/metahys" target="_blank" rel="noopener noreferrer">metahys</a>).</li><li>Fix possible segfault in FileLog (experimental feature). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30749" target="_blank" rel="noopener noreferrer">#30749</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34996" target="_blank" rel="noopener noreferrer">#34996</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible rare error <code>Cannot push block to port which already has data</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34993" target="_blank" rel="noopener noreferrer">#34993</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix wrong schema inference for unquoted dates in CSV. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34768" target="_blank" rel="noopener noreferrer">#34768</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34961" target="_blank" rel="noopener noreferrer">#34961</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Integration with Hive: Fix unexpected result when use <code>in</code> in <code>where</code> in hive query. <a href="https://github.com/ClickHouse/ClickHouse/pull/34945" target="_blank" rel="noopener noreferrer">#34945</a> (<a href="https://github.com/lgbo-ustc" target="_blank" rel="noopener noreferrer">lgbo</a>).</li><li>Avoid busy polling in ClickHouse Keeper while searching for changelog files to delete. <a href="https://github.com/ClickHouse/ClickHouse/pull/34931" target="_blank" rel="noopener noreferrer">#34931</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix DateTime64 conversion from PostgreSQL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33364" target="_blank" rel="noopener noreferrer">#33364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34910" target="_blank" rel="noopener noreferrer">#34910</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible &quot;Part directory doesn&#x27;t exist&quot; during <code>INSERT</code> into MergeTree table backed by VFS over s3. <a href="https://github.com/ClickHouse/ClickHouse/pull/34876" target="_blank" rel="noopener noreferrer">#34876</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support DDLs like CREATE USER to be executed on cross replicated cluster. <a href="https://github.com/ClickHouse/ClickHouse/pull/34860" target="_blank" rel="noopener noreferrer">#34860</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Fix bugs for multiple columns group by in <code>WindowView</code> (experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/34859" target="_blank" rel="noopener noreferrer">#34859</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix possible failures in S2 functions when queries contain const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/34745" target="_blank" rel="noopener noreferrer">#34745</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix bug for H3 funcs containing const columns which cause queries to fail. <a href="https://github.com/ClickHouse/ClickHouse/pull/34743" target="_blank" rel="noopener noreferrer">#34743</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix <code>No such file or directory</code> with enabled <code>fsync_part_directory</code> and vertical merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/34739" target="_blank" rel="noopener noreferrer">#34739</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix serialization/printing for system queries <code>RELOAD MODEL</code>, <code>RELOAD FUNCTION</code>, <code>RESTART DISK</code> when used <code>ON CLUSTER</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34514" target="_blank" rel="noopener noreferrer">#34514</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34696" target="_blank" rel="noopener noreferrer">#34696</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix <code>allow_experimental_projection_optimization</code> with <code>enable_global_with_statement</code> (before it may lead to <code>Stack size too large</code> error in case of multiple expressions in <code>WITH</code> clause, and also it executes scalar subqueries again and again, so not it will be more optimal). <a href="https://github.com/ClickHouse/ClickHouse/pull/34650" target="_blank" rel="noopener noreferrer">#34650</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Stop to select part for mutate when the other replica has already updated the transaction log for <code>ReplatedMergeTree</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/34633" target="_blank" rel="noopener noreferrer">#34633</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Fix incorrect result of trivial count query when part movement feature is used <a href="https://github.com/ClickHouse/ClickHouse/issues/34089" target="_blank" rel="noopener noreferrer">#34089</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34385" target="_blank" rel="noopener noreferrer">#34385</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Fix inconsistency of <code>max_query_size</code> limitation in distributed subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/34078" target="_blank" rel="noopener noreferrer">#34078</a> (<a href="https://github.com/godliness" target="_blank" rel="noopener noreferrer">Chao Ma</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v222-2022-02-17">ClickHouse release v22.2, 2022-02-17<a class="hash-link" href="#clickhouse-release-v222-2022-02-17" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="upgrade-notes">Upgrade Notes<a class="hash-link" href="#upgrade-notes" title="Direct link to heading">​</a></h4><ul><li>Applying data skipping indexes for queries with FINAL may produce incorrect result. In this release we disabled data skipping indexes by default for queries with FINAL (a new setting <code>use_skip_indexes_if_final</code> is introduced and disabled by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/34243" target="_blank" rel="noopener noreferrer">#34243</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-2">New Feature<a class="hash-link" href="#new-feature-2" title="Direct link to heading">​</a></h4><ul><li>Projections are production ready. Set <code>allow_experimental_projection_optimization</code> by default and deprecate this setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/34456" target="_blank" rel="noopener noreferrer">#34456</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>An option to create a new files on insert for <code>File</code>/<code>S3</code>/<code>HDFS</code> engines. Allow to overwrite a file in <code>HDFS</code>. Throw an exception in attempt to overwrite a file in <code>S3</code> by default. Throw an exception in attempt to append data to file in formats that have a suffix (and thus don&#x27;t support appends, like <code>Parquet</code>, <code>ORC</code>). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31640" target="_blank" rel="noopener noreferrer">#31640</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31622" target="_blank" rel="noopener noreferrer">#31622</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23862" target="_blank" rel="noopener noreferrer">#23862</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15022" target="_blank" rel="noopener noreferrer">#15022</a> Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16674" target="_blank" rel="noopener noreferrer">#16674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33302" target="_blank" rel="noopener noreferrer">#33302</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add a setting that allows a user to provide own deduplication semantic in <code>MergeTree</code>/<code>ReplicatedMergeTree</code> If provided, it&#x27;s used instead of data digest to generate block ID. So, for example, by providing a unique value for the setting in each INSERT statement, the user can avoid the same inserted data being deduplicated. This closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/7461" target="_blank" rel="noopener noreferrer">#7461</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32304" target="_blank" rel="noopener noreferrer">#32304</a> (<a href="https://github.com/devcrafter" target="_blank" rel="noopener noreferrer">Igor Nikonov</a>).</li><li>Add support of <code>DEFAULT</code> keyword for INSERT statements. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6331" target="_blank" rel="noopener noreferrer">#6331</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33141" target="_blank" rel="noopener noreferrer">#33141</a> (<a href="https://github.com/1over" target="_blank" rel="noopener noreferrer">Andrii Buriachevskyi</a>).</li><li><code>EPHEMERAL</code> column specifier is added to <code>CREATE TABLE</code> query. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9436" target="_blank" rel="noopener noreferrer">#9436</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34424" target="_blank" rel="noopener noreferrer">#34424</a> (<a href="https://github.com/yakov-olkhovskiy" target="_blank" rel="noopener noreferrer">yakov-olkhovskiy</a>).</li><li>Support <code>IF EXISTS</code> clause for <code>TTL expr TO [DISK|VOLUME] [IF EXISTS] &#x27;xxx&#x27;</code> feature. Parts will be moved to disk or volume only if it exists on replica, so <code>MOVE TTL</code> rules will be able to behave differently on replicas according to the existing storage policies. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/34455" target="_blank" rel="noopener noreferrer">#34455</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34504" target="_blank" rel="noopener noreferrer">#34504</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Allow set default table engine and to create tables without specifying ENGINE. <a href="https://github.com/ClickHouse/ClickHouse/pull/34187" target="_blank" rel="noopener noreferrer">#34187</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Add table function <code>format(format_name, data)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34125" target="_blank" rel="noopener noreferrer">#34125</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Detect format in <code>clickhouse-local</code> by file name even in the case when it is passed to stdin. <a href="https://github.com/ClickHouse/ClickHouse/pull/33829" target="_blank" rel="noopener noreferrer">#33829</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add schema inference for <code>values</code> table function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33811" target="_blank" rel="noopener noreferrer">#33811</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34017" target="_blank" rel="noopener noreferrer">#34017</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Dynamic reload of server TLS certificates on config reload. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15764" target="_blank" rel="noopener noreferrer">#15764</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15765" target="_blank" rel="noopener noreferrer">#15765</a> (<a href="https://github.com/johnskopis" target="_blank" rel="noopener noreferrer">johnskopis</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/31257" target="_blank" rel="noopener noreferrer">#31257</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Now ReplicatedMergeTree can recover data when some of its disks are broken. <a href="https://github.com/ClickHouse/ClickHouse/pull/13544" target="_blank" rel="noopener noreferrer">#13544</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fault-tolerant connections in clickhouse-client: <code>clickhouse-client ... --host host1 --host host2 --port port2 --host host3 --port port --host host4</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34490" target="_blank" rel="noopener noreferrer">#34490</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33824" target="_blank" rel="noopener noreferrer">#33824</a> (<a href="https://github.com/DF5HSE" target="_blank" rel="noopener noreferrer">Filippov Denis</a>).</li><li>Add <code>DEGREES</code> and <code>RADIANS</code> functions for MySQL compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/33769" target="_blank" rel="noopener noreferrer">#33769</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>h3ToCenterChild</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33313" target="_blank" rel="noopener noreferrer">#33313</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>). Add new h3 miscellaneous functions: <code>edgeLengthKm</code>,<code>exactEdgeLengthKm</code>,<code>exactEdgeLengthM</code>,<code>exactEdgeLengthRads</code>,<code>numHexagons</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33621" target="_blank" rel="noopener noreferrer">#33621</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add function <code>bitSlice</code> to extract bit subsequences from String/FixedString. <a href="https://github.com/ClickHouse/ClickHouse/pull/33360" target="_blank" rel="noopener noreferrer">#33360</a> (<a href="https://github.com/RogerYK" target="_blank" rel="noopener noreferrer">RogerYK</a>).</li><li>Implemented <code>meanZTest</code> aggregate function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33354" target="_blank" rel="noopener noreferrer">#33354</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Add confidence intervals to T-tests aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/33260" target="_blank" rel="noopener noreferrer">#33260</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Add function <code>addressToLineWithInlines</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/26211" target="_blank" rel="noopener noreferrer">#26211</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33467" target="_blank" rel="noopener noreferrer">#33467</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Added <code>#!</code> and <code># </code> as a recognised start of a single line comment. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34138" target="_blank" rel="noopener noreferrer">#34138</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34230" target="_blank" rel="noopener noreferrer">#34230</a> (<a href="https://github.com/aaronstephenkatz" target="_blank" rel="noopener noreferrer">Aaron Katz</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-2">Experimental Feature<a class="hash-link" href="#experimental-feature-2" title="Direct link to heading">​</a></h4><ul><li>Functions for text classification: language and charset detection. See <a href="https://github.com/ClickHouse/ClickHouse/issues/23271" target="_blank" rel="noopener noreferrer">#23271</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33314" target="_blank" rel="noopener noreferrer">#33314</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Add memory overcommit to <code>MemoryTracker</code>. Added <code>guaranteed</code> settings for memory limits which represent soft memory limits. In case when hard memory limit is reached, <code>MemoryTracker</code> tries to cancel the most overcommited query. New setting <code>memory_usage_overcommit_max_wait_microseconds</code> specifies how long queries may wait another query to stop. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28375" target="_blank" rel="noopener noreferrer">#28375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31182" target="_blank" rel="noopener noreferrer">#31182</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Enable stream to table join in WindowView. <a href="https://github.com/ClickHouse/ClickHouse/pull/33729" target="_blank" rel="noopener noreferrer">#33729</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Support <code>SET</code>, <code>YEAR</code>, <code>TIME</code> and <code>GEOMETRY</code> data types in <code>MaterializedMySQL</code> (experimental feature). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18091" target="_blank" rel="noopener noreferrer">#18091</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/21536" target="_blank" rel="noopener noreferrer">#21536</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/26361" target="_blank" rel="noopener noreferrer">#26361</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33429" target="_blank" rel="noopener noreferrer">#33429</a> (<a href="https://github.com/zzsmdfj" target="_blank" rel="noopener noreferrer">zzsmdfj</a>).</li><li>Fix various issues when projection is enabled by default. Each issue is described in separate commit. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/33678" target="_blank" rel="noopener noreferrer">#33678</a> . This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34273" target="_blank" rel="noopener noreferrer">#34273</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34305" target="_blank" rel="noopener noreferrer">#34305</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-2">Performance Improvement<a class="hash-link" href="#performance-improvement-2" title="Direct link to heading">​</a></h4><ul><li>Support <code>optimize_read_in_order</code> if prefix of sorting key is already sorted. E.g. if we have sorting key <code>ORDER BY (a, b)</code> in table and query with <code>WHERE a = const ORDER BY b</code> clauses, now it will be applied reading in order of sorting key instead of full sort. <a href="https://github.com/ClickHouse/ClickHouse/pull/32748" target="_blank" rel="noopener noreferrer">#32748</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Improve performance of partitioned insert into table functions <code>URL</code>, <code>S3</code>, <code>File</code>, <code>HDFS</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34348" target="_blank" rel="noopener noreferrer">#34348</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34510" target="_blank" rel="noopener noreferrer">#34510</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Multiple performance improvements of clickhouse-keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/34484" target="_blank" rel="noopener noreferrer">#34484</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/34587" target="_blank" rel="noopener noreferrer">#34587</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li><code>FlatDictionary</code> improve performance of dictionary data load. <a href="https://github.com/ClickHouse/ClickHouse/pull/33871" target="_blank" rel="noopener noreferrer">#33871</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance of <code>mapPopulateSeries</code> function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33944" target="_blank" rel="noopener noreferrer">#33944</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34318" target="_blank" rel="noopener noreferrer">#34318</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>_file</code> and <code>_path</code> virtual columns (in file-like table engines) are made <code>LowCardinality</code> - it will make queries for multiple files faster. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34300" target="_blank" rel="noopener noreferrer">#34300</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34317" target="_blank" rel="noopener noreferrer">#34317</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Speed up loading of data parts. It was not parallelized before: the setting <code>part_loading_threads</code> did not have effect. See <a href="https://github.com/ClickHouse/ClickHouse/issues/4699" target="_blank" rel="noopener noreferrer">#4699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34310" target="_blank" rel="noopener noreferrer">#34310</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of <code>LineAsString</code> format. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34303" target="_blank" rel="noopener noreferrer">#34303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34306" target="_blank" rel="noopener noreferrer">#34306</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Optimize <code>quantilesExact{Low,High}</code> to use <code>nth_element</code> instead of <code>sort</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34287" target="_blank" rel="noopener noreferrer">#34287</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Danila Kutenin</a>).</li><li>Slightly improve performance of <code>Regexp</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34202" target="_blank" rel="noopener noreferrer">#34202</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Minor improvement for analysis of scalar subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/34128" target="_blank" rel="noopener noreferrer">#34128</a> (<a href="https://github.com/fedrod" target="_blank" rel="noopener noreferrer">Federico Rodriguez</a>).</li><li>Make ORDER BY tuple almost as fast as ORDER BY columns. We have special optimizations for multiple column ORDER BY: <a href="https://github.com/ClickHouse/ClickHouse/pull/10831" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/10831</a> . It&#x27;s beneficial to also apply to tuple columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/34060" target="_blank" rel="noopener noreferrer">#34060</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Rework and reintroduce the scalar subqueries cache to Materialized Views execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/33958" target="_blank" rel="noopener noreferrer">#33958</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Slightly improve performance of <code>ORDER BY</code> by adding x86-64 AVX-512 support for <code>memcmpSmall</code> functions to accelerate memory comparison. It works only if you compile ClickHouse by yourself. <a href="https://github.com/ClickHouse/ClickHouse/pull/33706" target="_blank" rel="noopener noreferrer">#33706</a> (<a href="https://github.com/hanqf-git" target="_blank" rel="noopener noreferrer">hanqf-git</a>).</li><li>Improve <code>range_hashed</code> dictionary performance if for key there are a lot of intervals. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23821" target="_blank" rel="noopener noreferrer">#23821</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33516" target="_blank" rel="noopener noreferrer">#33516</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>For inserts and merges into S3, write files in parallel whenever possible (TODO: check if it&#x27;s merged). <a href="https://github.com/ClickHouse/ClickHouse/pull/33291" target="_blank" rel="noopener noreferrer">#33291</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Improve <code>clickhouse-keeper</code> performance and fix several memory leaks in NuRaft library. <a href="https://github.com/ClickHouse/ClickHouse/pull/33329" target="_blank" rel="noopener noreferrer">#33329</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-2">Improvement<a class="hash-link" href="#improvement-2" title="Direct link to heading">​</a></h4><ul><li>Support asynchronous inserts in <code>clickhouse-client</code> for queries with inlined data. <a href="https://github.com/ClickHouse/ClickHouse/pull/34267" target="_blank" rel="noopener noreferrer">#34267</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Functions <code>dictGet</code>, <code>dictHas</code> implicitly cast key argument to dictionary key structure, if they are different. <a href="https://github.com/ClickHouse/ClickHouse/pull/33672" target="_blank" rel="noopener noreferrer">#33672</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improvements for <code>range_hashed</code> dictionaries. Improve performance of load time if there are multiple attributes. Allow to create a dictionary without attributes. Added option to specify strategy when intervals <code>start</code> and <code>end</code> have <code>Nullable</code> type <code>convert_null_range_bound_to_open</code> by default is <code>true</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29791" target="_blank" rel="noopener noreferrer">#29791</a>. Allow to specify <code>Float</code>, <code>Decimal</code>, <code>DateTime64</code>, <code>Int128</code>, <code>Int256</code>, <code>UInt128</code>, <code>UInt256</code> as range types. <code>RangeHashedDictionary</code> added support for range values that extend <code>Int64</code> type. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28322" target="_blank" rel="noopener noreferrer">#28322</a>. Added option <code>range_lookup_strategy</code> to specify range lookup type <code>min</code>, <code>max</code> by default is <code>min</code> . Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21647" target="_blank" rel="noopener noreferrer">#21647</a>. Fixed allocated bytes calculations. Fixed type name in <code>system.dictionaries</code> in case of <code>ComplexKeyHashedDictionary</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33927" target="_blank" rel="noopener noreferrer">#33927</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>flat</code>, <code>hashed</code>, <code>hashed_array</code> dictionaries now support creating with empty attributes, with support of reading the keys and using <code>dictHas</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33820" target="_blank" rel="noopener noreferrer">#33820</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33918" target="_blank" rel="noopener noreferrer">#33918</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added support for <code>DateTime64</code> data type in dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/33914" target="_blank" rel="noopener noreferrer">#33914</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Allow to write <code>s3(url, access_key_id, secret_access_key)</code> (autodetect of data format and table structure, but with explicit credentials). <a href="https://github.com/ClickHouse/ClickHouse/pull/34503" target="_blank" rel="noopener noreferrer">#34503</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Added sending of the output format back to client like it&#x27;s done in HTTP protocol as suggested in <a href="https://github.com/ClickHouse/ClickHouse/issues/34362" target="_blank" rel="noopener noreferrer">#34362</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34362" target="_blank" rel="noopener noreferrer">#34362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34499" target="_blank" rel="noopener noreferrer">#34499</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Send ProfileEvents statistics in case of INSERT SELECT query (to display query metrics in <code>clickhouse-client</code> for this type of queries). <a href="https://github.com/ClickHouse/ClickHouse/pull/34498" target="_blank" rel="noopener noreferrer">#34498</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Recognize <code>.jsonl</code> extension for JSONEachRow format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34496" target="_blank" rel="noopener noreferrer">#34496</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Improve schema inference in clickhouse-local. Allow to write just <code>clickhouse-local -q &quot;select * from table&quot; &lt; data.format</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34495" target="_blank" rel="noopener noreferrer">#34495</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Privileges CREATE/ALTER/DROP ROW POLICY now can be granted on a table or on <code>database.*</code> as well as globally <code>*.*</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34489" target="_blank" rel="noopener noreferrer">#34489</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Allow to export arbitrary large files to <code>s3</code>. Add two new settings: <code>s3_upload_part_size_multiply_factor</code> and <code>s3_upload_part_size_multiply_parts_count_threshold</code>. Now each time <code>s3_upload_part_size_multiply_parts_count_threshold</code> uploaded to S3 from a single query <code>s3_min_upload_part_size</code> multiplied by <code>s3_upload_part_size_multiply_factor</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34244" target="_blank" rel="noopener noreferrer">#34244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34422" target="_blank" rel="noopener noreferrer">#34422</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Allow to skip not found (404) URLs for globs when using URL storage / table function. Also closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34359" target="_blank" rel="noopener noreferrer">#34359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34392" target="_blank" rel="noopener noreferrer">#34392</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Default input and output formats for <code>clickhouse-local</code> that can be overriden by --input-format and --output-format. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/30631" target="_blank" rel="noopener noreferrer">#30631</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34352" target="_blank" rel="noopener noreferrer">#34352</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Add options for <code>clickhouse-format</code>. Which close <a href="https://github.com/ClickHouse/ClickHouse/issues/30528" target="_blank" rel="noopener noreferrer">#30528</a> - <code>max_query_size</code> - <code>max_parser_depth</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34349" target="_blank" rel="noopener noreferrer">#34349</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Better handling of pre-inputs before client start. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/34308" target="_blank" rel="noopener noreferrer">#34308</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34336" target="_blank" rel="noopener noreferrer">#34336</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li><code>REGEXP_MATCHES</code> and <code>REGEXP_REPLACE</code> function aliases for compatibility with PostgreSQL. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/30885" target="_blank" rel="noopener noreferrer">#30885</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34334" target="_blank" rel="noopener noreferrer">#34334</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Some servers expect a User-Agent header in their HTTP requests. A <code>User-Agent</code> header entry has been added to HTTP requests of the form: User-Agent: ClickHouse/VERSION_STRING. <a href="https://github.com/ClickHouse/ClickHouse/pull/34330" target="_blank" rel="noopener noreferrer">#34330</a> (<a href="https://github.com/surahman" target="_blank" rel="noopener noreferrer">Saad Ur Rahman</a>).</li><li>Cancel merges before acquiring table lock for <code>TRUNCATE</code> query to avoid <code>DEADLOCK_AVOIDED</code> error in some cases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34302" target="_blank" rel="noopener noreferrer">#34302</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34304" target="_blank" rel="noopener noreferrer">#34304</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Change severity of the &quot;Cancelled merging parts&quot; message in logs, because it&#x27;s not an error. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34148" target="_blank" rel="noopener noreferrer">#34148</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34232" target="_blank" rel="noopener noreferrer">#34232</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add ability to compose PostgreSQL-style cast operator <code>::</code> with expressions using <code>[]</code> and <code>.</code> operators (array and tuple indexing). <a href="https://github.com/ClickHouse/ClickHouse/pull/34229" target="_blank" rel="noopener noreferrer">#34229</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Recognize <code>YYYYMMDD-hhmmss</code> format in <code>parseDateTimeBestEffort</code> function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34206" target="_blank" rel="noopener noreferrer">#34206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34208" target="_blank" rel="noopener noreferrer">#34208</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow carriage return in the middle of the line while parsing by <code>Regexp</code> format. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34200" target="_blank" rel="noopener noreferrer">#34200</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34205" target="_blank" rel="noopener noreferrer">#34205</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to parse dictionary&#x27;s <code>PRIMARY KEY</code> as <code>PRIMARY KEY (id, value)</code>; previously supported only <code>PRIMARY KEY id, value</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34135" target="_blank" rel="noopener noreferrer">#34135</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34141" target="_blank" rel="noopener noreferrer">#34141</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>An optional argument for <code>splitByChar</code> to limit the number of resulting elements. close <a href="https://github.com/ClickHouse/ClickHouse/issues/34081" target="_blank" rel="noopener noreferrer">#34081</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34140" target="_blank" rel="noopener noreferrer">#34140</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Improving the experience of multiple line editing for clickhouse-client. This is a follow-up of <a href="https://github.com/ClickHouse/ClickHouse/pull/31123" target="_blank" rel="noopener noreferrer">#31123</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34114" target="_blank" rel="noopener noreferrer">#34114</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>UUID</code> suport in <code>MsgPack</code> input/output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34065" target="_blank" rel="noopener noreferrer">#34065</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Tracing context (for OpenTelemetry) is now propagated from GRPC client metadata (this change is relevant for GRPC client-server protocol). <a href="https://github.com/ClickHouse/ClickHouse/pull/34064" target="_blank" rel="noopener noreferrer">#34064</a> (<a href="https://github.com/andremarianiello" target="_blank" rel="noopener noreferrer">andremarianiello</a>).</li><li>Supports all types of <code>SYSTEM</code> queries with <code>ON CLUSTER</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/34005" target="_blank" rel="noopener noreferrer">#34005</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Improve memory accounting for queries that are using less than <code>max_untracker_memory</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34001" target="_blank" rel="noopener noreferrer">#34001</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed UTF-8 string case-insensitive search when lowercase and uppercase characters are represented by different number of bytes. Example is <code>ẞ</code> and <code>ß</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7334" target="_blank" rel="noopener noreferrer">#7334</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33992" target="_blank" rel="noopener noreferrer">#33992</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>).</li><li>Detect format and schema from stdin in <code>clickhouse-local</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33960" target="_blank" rel="noopener noreferrer">#33960</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Correctly handle the case of misconfiguration when multiple disks are using the same path on the filesystem. <a href="https://github.com/ClickHouse/ClickHouse/issues/29072" target="_blank" rel="noopener noreferrer">#29072</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33905" target="_blank" rel="noopener noreferrer">#33905</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">zhongyuankai</a>).</li><li>Try every resolved IP address while getting S3 proxy. S3 proxies are rarely used, mostly in Yandex Cloud. <a href="https://github.com/ClickHouse/ClickHouse/pull/33862" target="_blank" rel="noopener noreferrer">#33862</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Support EXPLAIN AST CREATE FUNCTION query <code>EXPLAIN AST CREATE FUNCTION mycast AS (n) -&gt; cast(n as String)</code> will return <code>EXPLAIN AST CREATE FUNCTION mycast AS n -&gt; CAST(n, &#x27;String&#x27;)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33819" target="_blank" rel="noopener noreferrer">#33819</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Added support for cast from <code>Map(Key, Value)</code> to <code>Array(Tuple(Key, Value))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33794" target="_blank" rel="noopener noreferrer">#33794</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add some improvements and fixes for <code>Bool</code> data type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33244" target="_blank" rel="noopener noreferrer">#33244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33737" target="_blank" rel="noopener noreferrer">#33737</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Parse and store OpenTelemetry trace-id in big-endian order. <a href="https://github.com/ClickHouse/ClickHouse/pull/33723" target="_blank" rel="noopener noreferrer">#33723</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Improvement for <code>fromUnixTimestamp64</code> family functions.. They now accept any integer value that can be converted to <code>Int64</code>. This closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/14648" target="_blank" rel="noopener noreferrer">#14648</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33505" target="_blank" rel="noopener noreferrer">#33505</a> (<a href="https://github.com/zvonand" target="_blank" rel="noopener noreferrer">Andrey Zvonov</a>).</li><li>Reimplement <code>_shard_num</code> from constants (see <a href="https://github.com/ClickHouse/ClickHouse/issues/7624" target="_blank" rel="noopener noreferrer">#7624</a>) with <code>shardNum()</code> function (seee <a href="https://github.com/ClickHouse/ClickHouse/issues/27020" target="_blank" rel="noopener noreferrer">#27020</a>), to avoid possible issues (like those that had been found in <a href="https://github.com/ClickHouse/ClickHouse/issues/16947" target="_blank" rel="noopener noreferrer">#16947</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33392" target="_blank" rel="noopener noreferrer">#33392</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Enable binary arithmetic (plus, minus, multiply, division, least, greatest) between Decimal and Float. <a href="https://github.com/ClickHouse/ClickHouse/pull/33355" target="_blank" rel="noopener noreferrer">#33355</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Respect cgroups limits in max_threads autodetection. <a href="https://github.com/ClickHouse/ClickHouse/pull/33342" target="_blank" rel="noopener noreferrer">#33342</a> (<a href="https://github.com/JaySon-Huang" target="_blank" rel="noopener noreferrer">JaySon</a>).</li><li>Add new clickhouse-keeper setting <code>min_session_timeout_ms</code>. Now clickhouse-keeper will determine client session timeout according to <code>min_session_timeout_ms</code> and <code>session_timeout_ms</code> settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/33288" target="_blank" rel="noopener noreferrer">#33288</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Added <code>UUID</code> data type support for functions <code>hex</code> and <code>bin</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32170" target="_blank" rel="noopener noreferrer">#32170</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Fix reading of subcolumns with dots in their names. In particular fixed reading of <code>Nested</code> columns, if their element names contain dots (e.g <code>Nested(`keys.name` String, `keys.id` UInt64, values UInt64)</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/34228" target="_blank" rel="noopener noreferrer">#34228</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixes <code>parallel_view_processing = 0</code> not working when inserting into a table using <code>VALUES</code>. - Fixes <code>view_duration_ms</code> in the <code>query_views_log</code> not being set correctly for materialized views. <a href="https://github.com/ClickHouse/ClickHouse/pull/34067" target="_blank" rel="noopener noreferrer">#34067</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix parsing tables structure from ZooKeeper: now metadata from ZooKeeper compared with local metadata in canonical form. It helps when canonical function names can change between ClickHouse versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/33933" target="_blank" rel="noopener noreferrer">#33933</a> (<a href="https://github.com/sunny19930321" target="_blank" rel="noopener noreferrer">sunny</a>).</li><li>Properly escape some characters for interaction with LDAP. <a href="https://github.com/ClickHouse/ClickHouse/pull/33401" target="_blank" rel="noopener noreferrer">#33401</a> (<a href="https://github.com/IlyaTsoi" target="_blank" rel="noopener noreferrer">IlyaTsoi</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-2">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-2" title="Direct link to heading">​</a></h4><ul><li>Remove unbundled build support. <a href="https://github.com/ClickHouse/ClickHouse/pull/33690" target="_blank" rel="noopener noreferrer">#33690</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Ensure that tests don&#x27;t depend on the result of non-stable sorting of equal elements. Added equal items ranges randomization in debug after sort to prevent issues when we rely on equal items sort order. <a href="https://github.com/ClickHouse/ClickHouse/pull/34393" target="_blank" rel="noopener noreferrer">#34393</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add verbosity to a style check. <a href="https://github.com/ClickHouse/ClickHouse/pull/34289" target="_blank" rel="noopener noreferrer">#34289</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Remove <code>clickhouse-test</code> debian package because it&#x27;s obsolete. <a href="https://github.com/ClickHouse/ClickHouse/pull/33948" target="_blank" rel="noopener noreferrer">#33948</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Multiple improvements for build system to remove the possibility of occasionally using packages from the OS and to enforce hermetic builds. <a href="https://github.com/ClickHouse/ClickHouse/pull/33695" target="_blank" rel="noopener noreferrer">#33695</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release-1">Bug Fix (user-visible misbehaviour in official stable or prestable release)<a class="hash-link" href="#bug-fix-user-visible-misbehaviour-in-official-stable-or-prestable-release-1" title="Direct link to heading">​</a></h4><ul><li>Fixed the assertion in case of using <code>allow_experimental_parallel_reading_from_replicas</code> with <code>max_parallel_replicas</code> equals to 1. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34525" target="_blank" rel="noopener noreferrer">#34525</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34613" target="_blank" rel="noopener noreferrer">#34613</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix rare bug while reading of empty arrays, which could lead to <code>Data compressed with different methods</code> error. It can reproduce if you have mostly empty arrays, but not always. And reading is performed in backward direction with ORDER BY ... DESC. This error is extremely unlikely to happen. <a href="https://github.com/ClickHouse/ClickHouse/pull/34327" target="_blank" rel="noopener noreferrer">#34327</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix wrong result of <code>round</code>/<code>roundBankers</code> if integer values of small types are rounded. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33267" target="_blank" rel="noopener noreferrer">#33267</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34562" target="_blank" rel="noopener noreferrer">#34562</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Sometimes query cancellation did not work immediately when we were reading multiple files from s3 or HDFS. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34301" target="_blank" rel="noopener noreferrer">#34301</a> Relates to <a href="https://github.com/ClickHouse/ClickHouse/issues/34397" target="_blank" rel="noopener noreferrer">#34397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34539" target="_blank" rel="noopener noreferrer">#34539</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Fix exception <code>Chunk should have AggregatedChunkInfo in MergingAggregatedTransform</code> (in case of <code>optimize_aggregation_in_order = 1</code> and <code>distributed_aggregation_memory_efficient = 0</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34526" target="_blank" rel="noopener noreferrer">#34526</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34532" target="_blank" rel="noopener noreferrer">#34532</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix comparison between integers and floats in index analysis. Previously it could lead to skipping some granules for reading by mistake. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34493" target="_blank" rel="noopener noreferrer">#34493</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34528" target="_blank" rel="noopener noreferrer">#34528</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix compression support in URL engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/34524" target="_blank" rel="noopener noreferrer">#34524</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Fix possible error &#x27;file_size: Operation not supported&#x27; in files&#x27; schema autodetection. <a href="https://github.com/ClickHouse/ClickHouse/pull/34479" target="_blank" rel="noopener noreferrer">#34479</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixes possible race with table deletion. <a href="https://github.com/ClickHouse/ClickHouse/pull/34416" target="_blank" rel="noopener noreferrer">#34416</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible error <code>Cannot convert column Function to mask</code> in short circuit function evaluation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34171" target="_blank" rel="noopener noreferrer">#34171</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34415" target="_blank" rel="noopener noreferrer">#34415</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix potential crash when doing schema inference from url source. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34147" target="_blank" rel="noopener noreferrer">#34147</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34405" target="_blank" rel="noopener noreferrer">#34405</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>For UDFs access permissions were checked for database level instead of global level as it should be. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34281" target="_blank" rel="noopener noreferrer">#34281</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34404" target="_blank" rel="noopener noreferrer">#34404</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix wrong engine syntax in result of <code>SHOW CREATE DATABASE</code> query for databases with engine <code>Memory</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34335" target="_blank" rel="noopener noreferrer">#34335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34345" target="_blank" rel="noopener noreferrer">#34345</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed a couple of extremely rare race conditions that might lead to broken state of replication queue and &quot;intersecting parts&quot; error. <a href="https://github.com/ClickHouse/ClickHouse/pull/34297" target="_blank" rel="noopener noreferrer">#34297</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix progress bar width. It was incorrectly rounded to integer number of characters. <a href="https://github.com/ClickHouse/ClickHouse/pull/34275" target="_blank" rel="noopener noreferrer">#34275</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix current_user/current_address client information fields for inter-server communication (before this patch current_user/current_address will be preserved from the previous query). <a href="https://github.com/ClickHouse/ClickHouse/pull/34263" target="_blank" rel="noopener noreferrer">#34263</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix memory leak in case of some Exception during query processing with <code>optimize_aggregation_in_order=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34234" target="_blank" rel="noopener noreferrer">#34234</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix metric <code>Query</code>, which shows the number of executing queries. In last several releases it was always 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/34224" target="_blank" rel="noopener noreferrer">#34224</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix schema inference for table runction <code>s3</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34186" target="_blank" rel="noopener noreferrer">#34186</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix rare and benign race condition in <code>HDFS</code>, <code>S3</code> and <code>URL</code> storage engines which can lead to additional connections. <a href="https://github.com/ClickHouse/ClickHouse/pull/34172" target="_blank" rel="noopener noreferrer">#34172</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug which can rarely lead to error &quot;Cannot read all data&quot; while reading LowCardinality columns of MergeTree table engines family which stores data on remote file system like S3 (virtual filesystem over s3 is an experimental feature that is not ready for production). <a href="https://github.com/ClickHouse/ClickHouse/pull/34139" target="_blank" rel="noopener noreferrer">#34139</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix inserts to distributed tables in case of a change of native protocol. The last change was in the version 22.1, so there may be some failures of inserts to distributed tables after upgrade to that version. <a href="https://github.com/ClickHouse/ClickHouse/pull/34132" target="_blank" rel="noopener noreferrer">#34132</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible data race in <code>File</code> table engine that was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/33960" target="_blank" rel="noopener noreferrer">#33960</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/34111" target="_blank" rel="noopener noreferrer">#34111</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34113" target="_blank" rel="noopener noreferrer">#34113</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed minor race condition that might cause &quot;intersecting parts&quot; error in extremely rare cases after ZooKeeper connection loss. <a href="https://github.com/ClickHouse/ClickHouse/pull/34096" target="_blank" rel="noopener noreferrer">#34096</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix asynchronous inserts with <code>Native</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/34068" target="_blank" rel="noopener noreferrer">#34068</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix bug which lead to inability for server to start when both replicated access storage and keeper (embedded in clickhouse-server) are used. Introduced two settings for keeper socket timeout instead of settings from default user: <code>keeper_server.socket_receive_timeout_sec</code> and <code>keeper_server.socket_send_timeout_sec</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33973" target="_blank" rel="noopener noreferrer">#33973</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33988" target="_blank" rel="noopener noreferrer">#33988</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix segfault while parsing ORC file with corrupted footer. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33797" target="_blank" rel="noopener noreferrer">#33797</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33984" target="_blank" rel="noopener noreferrer">#33984</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix parsing IPv6 from query parameter (prepared statements) and fix IPv6 to string conversion. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33928" target="_blank" rel="noopener noreferrer">#33928</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33971" target="_blank" rel="noopener noreferrer">#33971</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix crash while reading of nested tuples. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33838" target="_blank" rel="noopener noreferrer">#33838</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33956" target="_blank" rel="noopener noreferrer">#33956</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix usage of functions <code>array</code> and <code>tuple</code> with literal arguments in distributed queries. Previously it could lead to <code>Not found columns</code> exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/33938" target="_blank" rel="noopener noreferrer">#33938</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Aggregate function combinator <code>-If</code> did not correctly process <code>Nullable</code> filter argument. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27073" target="_blank" rel="noopener noreferrer">#27073</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33920" target="_blank" rel="noopener noreferrer">#33920</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential race condition when doing remote disk read (virtual filesystem over s3 is an experimental feature that is not ready for production). <a href="https://github.com/ClickHouse/ClickHouse/pull/33912" target="_blank" rel="noopener noreferrer">#33912</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix crash if SQL UDF is created with lambda with non identifier arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33866" target="_blank" rel="noopener noreferrer">#33866</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33868" target="_blank" rel="noopener noreferrer">#33868</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix usage of sparse columns (which can be enabled by experimental setting <code>ratio_of_defaults_for_sparse_serialization</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33849" target="_blank" rel="noopener noreferrer">#33849</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed <code>replica is not readonly</code> logical error on <code>SYSTEM RESTORE REPLICA</code> query when replica is actually readonly. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33806" target="_blank" rel="noopener noreferrer">#33806</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33847" target="_blank" rel="noopener noreferrer">#33847</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix memory leak in <code>clickhouse-keeper</code> in case of compression is used (default). <a href="https://github.com/ClickHouse/ClickHouse/pull/33840" target="_blank" rel="noopener noreferrer">#33840</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix index analysis with no common types available. <a href="https://github.com/ClickHouse/ClickHouse/pull/33833" target="_blank" rel="noopener noreferrer">#33833</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix schema inference for <code>JSONEachRow</code> and <code>JSONCompactEachRow</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33830" target="_blank" rel="noopener noreferrer">#33830</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix usage of external dictionaries with <code>redis</code> source and large number of keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/33804" target="_blank" rel="noopener noreferrer">#33804</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix bug in client that led to &#x27;Connection reset by peer&#x27; in server. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33309" target="_blank" rel="noopener noreferrer">#33309</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33790" target="_blank" rel="noopener noreferrer">#33790</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix parsing query INSERT INTO ... VALUES SETTINGS ... (...), ... <a href="https://github.com/ClickHouse/ClickHouse/pull/33776" target="_blank" rel="noopener noreferrer">#33776</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix bug of check table when creating data part with wide format and projection. <a href="https://github.com/ClickHouse/ClickHouse/pull/33774" target="_blank" rel="noopener noreferrer">#33774</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Fix tiny race between count() and INSERT/merges/... in MergeTree (it is possible to return incorrect number of rows for SELECT with optimize_trivial_count_query). <a href="https://github.com/ClickHouse/ClickHouse/pull/33753" target="_blank" rel="noopener noreferrer">#33753</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Throw exception when directory listing request has failed in storage HDFS. <a href="https://github.com/ClickHouse/ClickHouse/pull/33724" target="_blank" rel="noopener noreferrer">#33724</a> (<a href="https://github.com/liuneng1994" target="_blank" rel="noopener noreferrer">LiuNeng</a>).</li><li>Fix mutation when table contains projections. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33010" target="_blank" rel="noopener noreferrer">#33010</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33275" target="_blank" rel="noopener noreferrer">#33275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33679" target="_blank" rel="noopener noreferrer">#33679</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Correctly determine current database if <code>CREATE TEMPORARY TABLE AS SELECT</code> is queried inside a named HTTP session. This is a very rare use case. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8340" target="_blank" rel="noopener noreferrer">#8340</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33676" target="_blank" rel="noopener noreferrer">#33676</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow some queries with sorting, LIMIT BY, ARRAY JOIN and lambda functions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7462" target="_blank" rel="noopener noreferrer">#7462</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33675" target="_blank" rel="noopener noreferrer">#33675</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug in &quot;zero copy replication&quot; (a feature that is under development and should not be used in production) which lead to data duplication in case of TTL move. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33643" target="_blank" rel="noopener noreferrer">#33643</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33642" target="_blank" rel="noopener noreferrer">#33642</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>Chunk should have AggregatedChunkInfo in GroupingAggregatedTransform</code> (in case of <code>optimize_aggregation_in_order = 1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33637" target="_blank" rel="noopener noreferrer">#33637</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix error <code>Bad cast from type ... to DB::DataTypeArray</code> which may happen when table has <code>Nested</code> column with dots in name, and default value is generated for it (e.g. during insert, when column is not listed). Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/28762" target="_blank" rel="noopener noreferrer">#28762</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33588" target="_blank" rel="noopener noreferrer">#33588</a> (<a href="https://github.com/alexeypavlenko" target="_blank" rel="noopener noreferrer">Alexey Pavlenko</a>).</li><li>Export into <code>lz4</code> files has been fixed. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31421" target="_blank" rel="noopener noreferrer">#31421</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31862" target="_blank" rel="noopener noreferrer">#31862</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix potential crash if <code>group_by_overflow_mode</code> was set to <code>any</code> (approximate GROUP BY) and aggregation was performed by single column of type <code>LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34506" target="_blank" rel="noopener noreferrer">#34506</a> (<a href="https://github.com/freedomDR" target="_blank" rel="noopener noreferrer">DR</a>).</li><li>Fix inserting to temporary tables via gRPC client-server protocol. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/34347" target="_blank" rel="noopener noreferrer">#34347</a>, issue <code>#2</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34364" target="_blank" rel="noopener noreferrer">#34364</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix issue <a href="https://github.com/ClickHouse/ClickHouse/issues/19429" target="_blank" rel="noopener noreferrer">#19429</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/34225" target="_blank" rel="noopener noreferrer">#34225</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix issue <a href="https://github.com/ClickHouse/ClickHouse/issues/18206" target="_blank" rel="noopener noreferrer">#18206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33977" target="_blank" rel="noopener noreferrer">#33977</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>This PR allows using multiple LDAP storages in the same list of user directories. It worked earlier but was broken because LDAP tests are disabled (they are part of the testflows tests). <a href="https://github.com/ClickHouse/ClickHouse/pull/33574" target="_blank" rel="noopener noreferrer">#33574</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v221-2022-01-18">ClickHouse release v22.1, 2022-01-18<a class="hash-link" href="#clickhouse-release-v221-2022-01-18" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="upgrade-notes-1">Upgrade Notes<a class="hash-link" href="#upgrade-notes-1" title="Direct link to heading">​</a></h4><ul><li>The functions <code>left</code> and <code>right</code> were previously implemented in parser and now full-featured. Distributed queries with <code>left</code> or <code>right</code> functions without aliases may throw exception if cluster contains different versions of clickhouse-server. If you are upgrading your cluster and encounter this error, you should finish upgrading your cluster to ensure all nodes have the same version. Also you can add aliases (<code>AS something</code>) to the columns in your queries to avoid this issue. <a href="https://github.com/ClickHouse/ClickHouse/pull/33407" target="_blank" rel="noopener noreferrer">#33407</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Resource usage by scalar subqueries is fully accounted since this version. With this change, rows read in scalar subqueries are now reported in the query_log. If the scalar subquery is cached (repeated or called for several rows) the rows read are only counted once. This change allows KILLing queries and reporting progress while they are executing scalar subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/32271" target="_blank" rel="noopener noreferrer">#32271</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-3">New Feature<a class="hash-link" href="#new-feature-3" title="Direct link to heading">​</a></h4><ul><li>Implement data schema inference for input formats. Allow to skip structure (or write just <code>auto</code>) in table functions <code>file</code>, <code>url</code>, <code>s3</code>, <code>hdfs</code> and in parameters of <code>clickhouse-local</code> . Allow to skip structure in create query for table engines <code>File</code>, <code>HDFS</code>, <code>S3</code>, <code>URL</code>, <code>Merge</code>, <code>Buffer</code>, <code>Distributed</code> and <code>ReplicatedMergeTree</code> (if we add new replicas). <a href="https://github.com/ClickHouse/ClickHouse/pull/32455" target="_blank" rel="noopener noreferrer">#32455</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Detect format by file extension in <code>file</code>/<code>hdfs</code>/<code>s3</code>/<code>url</code> table functions and <code>HDFS</code>/<code>S3</code>/<code>URL</code> table engines and also for <code>SELECT INTO OUTFILE</code> and <code>INSERT FROM INFILE</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/33565" target="_blank" rel="noopener noreferrer">#33565</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). Close <a href="https://github.com/ClickHouse/ClickHouse/issues/30918" target="_blank" rel="noopener noreferrer">#30918</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33443" target="_blank" rel="noopener noreferrer">#33443</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>A tool for collecting diagnostics data if you need support. <a href="https://github.com/ClickHouse/ClickHouse/pull/33175" target="_blank" rel="noopener noreferrer">#33175</a> (<a href="https://github.com/Alex-Burmak" target="_blank" rel="noopener noreferrer">Alexander Burmak</a>).</li><li>Automatic cluster discovery via Zoo/Keeper. It allows to add replicas to the cluster without changing configuration on every server. <a href="https://github.com/ClickHouse/ClickHouse/pull/31442" target="_blank" rel="noopener noreferrer">#31442</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Implement hive table engine to access apache hive from clickhouse. This implements: <a href="https://github.com/ClickHouse/ClickHouse/issues/29245" target="_blank" rel="noopener noreferrer">#29245</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31104" target="_blank" rel="noopener noreferrer">#31104</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li>Add aggregate functions <code>cramersV</code>, <code>cramersVBiasCorrected</code>, <code>theilsU</code> and <code>contingency</code>. These functions calculate dependency (measure of association) between categorical values. All these functions are using cross-tab (histogram on pairs) for implementation. You can imagine it like a correlation coefficient but for any discrete values (not necessary numbers). <a href="https://github.com/ClickHouse/ClickHouse/pull/33366" target="_blank" rel="noopener noreferrer">#33366</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). Initial implementation by <a href="https://github.com/Vanyok-All-is-OK" target="_blank" rel="noopener noreferrer">Vanyok-All-is-OK</a> and <a href="https://github.com/antikvist" target="_blank" rel="noopener noreferrer">antikvist</a>.</li><li>Added table function <code>hdfsCluster</code> which allows processing files from HDFS in parallel from many nodes in a specified cluster, similarly to <code>s3Cluster</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32400" target="_blank" rel="noopener noreferrer">#32400</a> (<a href="https://github.com/yuzhichang" target="_blank" rel="noopener noreferrer">Zhichang Yu</a>).</li><li>Adding support for disks backed by Azure Blob Storage, in a similar way it has been done for disks backed by AWS S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/31505" target="_blank" rel="noopener noreferrer">#31505</a> (<a href="https://github.com/jkuklis" target="_blank" rel="noopener noreferrer">Jakub Kuklis</a>).</li><li>Allow <code>COMMENT</code> in <code>CREATE VIEW</code> (for all VIEW kinds). <a href="https://github.com/ClickHouse/ClickHouse/pull/31062" target="_blank" rel="noopener noreferrer">#31062</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Dynamically reinitialize listening ports and protocols when configuration changes. <a href="https://github.com/ClickHouse/ClickHouse/pull/30549" target="_blank" rel="noopener noreferrer">#30549</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Added <code>left</code>, <code>right</code>, <code>leftUTF8</code>, <code>rightUTF8</code> functions. Fix error in implementation of <code>substringUTF8</code> function with negative offset (offset from the end of string). <a href="https://github.com/ClickHouse/ClickHouse/pull/33407" target="_blank" rel="noopener noreferrer">#33407</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add new functions for <code>H3</code> coordinate system: <code>h3HexAreaKm2</code>, <code>h3CellAreaM2</code>, <code>h3CellAreaRads2</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33479" target="_blank" rel="noopener noreferrer">#33479</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>MONTHNAME</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33436" target="_blank" rel="noopener noreferrer">#33436</a> (<a href="https://github.com/usurai" target="_blank" rel="noopener noreferrer">usurai</a>).</li><li>Added function <code>arrayLast</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33390" target="_blank" rel="noopener noreferrer">#33390</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33415" target="_blank" rel="noopener noreferrer">#33415</a> Added function <code>arrayLastIndex</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33465" target="_blank" rel="noopener noreferrer">#33465</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add function <code>decodeURLFormComponent</code> slightly different to <code>decodeURLComponent</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/10298" target="_blank" rel="noopener noreferrer">#10298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33451" target="_blank" rel="noopener noreferrer">#33451</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Allow to split <code>GraphiteMergeTree</code> rollup rules for plain/tagged metrics (optional rule_type field). <a href="https://github.com/ClickHouse/ClickHouse/pull/33494" target="_blank" rel="noopener noreferrer">#33494</a> (<a href="https://github.com/msaf1980" target="_blank" rel="noopener noreferrer">Michail Safronov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-3">Performance Improvement<a class="hash-link" href="#performance-improvement-3" title="Direct link to heading">​</a></h4><ul><li>Support moving conditions to <code>PREWHERE</code> (setting <code>optimize_move_to_prewhere</code>) for tables of <code>Merge</code> engine if its all underlying tables supports <code>PREWHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33300" target="_blank" rel="noopener noreferrer">#33300</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>More efficient handling of globs for URL storage. Now you can easily query million URLs in parallel with retries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32866" target="_blank" rel="noopener noreferrer">#32866</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32907" target="_blank" rel="noopener noreferrer">#32907</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Avoid exponential backtracking in parser. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20158" target="_blank" rel="noopener noreferrer">#20158</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33481" target="_blank" rel="noopener noreferrer">#33481</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Abuse of <code>untuple</code> function was leading to exponential complexity of query analysis (found by fuzzer). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33297" target="_blank" rel="noopener noreferrer">#33297</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33445" target="_blank" rel="noopener noreferrer">#33445</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Reduce allocated memory for dictionaries with string attributes. <a href="https://github.com/ClickHouse/ClickHouse/pull/33466" target="_blank" rel="noopener noreferrer">#33466</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Slight performance improvement of <code>reinterpret</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/32587" target="_blank" rel="noopener noreferrer">#32587</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Non significant change. In extremely rare cases when data part is lost on every replica, after merging of some data parts, the subsequent queries may skip less amount of partitions during partition pruning. This hardly affects anything. <a href="https://github.com/ClickHouse/ClickHouse/pull/32220" target="_blank" rel="noopener noreferrer">#32220</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve <code>clickhouse-keeper</code> writing performance by optimization the size calculation logic. <a href="https://github.com/ClickHouse/ClickHouse/pull/32366" target="_blank" rel="noopener noreferrer">#32366</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li>Optimize single part projection materialization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31669" target="_blank" rel="noopener noreferrer">#31669</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31885" target="_blank" rel="noopener noreferrer">#31885</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Improve query performance of system tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/33312" target="_blank" rel="noopener noreferrer">#33312</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>Optimize selecting of MergeTree parts that can be moved between volumes. <a href="https://github.com/ClickHouse/ClickHouse/pull/33225" target="_blank" rel="noopener noreferrer">#33225</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>Fix <code>sparse_hashed</code> dict performance with sequential keys (wrong hash function). <a href="https://github.com/ClickHouse/ClickHouse/pull/32536" target="_blank" rel="noopener noreferrer">#32536</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-3">Experimental Feature<a class="hash-link" href="#experimental-feature-3" title="Direct link to heading">​</a></h4><ul><li>Parallel reading from multiple replicas within a shard during distributed query without using sample key. To enable this, set <code>allow_experimental_parallel_reading_from_replicas = 1</code> and <code>max_parallel_replicas</code> to any number. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26748" target="_blank" rel="noopener noreferrer">#26748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29279" target="_blank" rel="noopener noreferrer">#29279</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Implemented sparse serialization. It can reduce usage of disk space and improve performance of some queries for columns, which contain a lot of default (zero) values. It can be enabled by setting <code>ratio_for_sparse_serialization</code>. Sparse serialization will be chosen dynamically for column, if it has ratio of number of default values to number of all values above that threshold. Serialization (default or sparse) will be fixed for every column in part, but may varies between parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/22535" target="_blank" rel="noopener noreferrer">#22535</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add &quot;TABLE OVERRIDE&quot; feature for customizing MaterializedMySQL table schemas. <a href="https://github.com/ClickHouse/ClickHouse/pull/32325" target="_blank" rel="noopener noreferrer">#32325</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Add <code>EXPLAIN TABLE OVERRIDE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/32836" target="_blank" rel="noopener noreferrer">#32836</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Support TABLE OVERRIDE clause for MaterializedPostgreSQL. RFC: <a href="https://github.com/ClickHouse/ClickHouse/issues/31480" target="_blank" rel="noopener noreferrer">#31480</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32749" target="_blank" rel="noopener noreferrer">#32749</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Change ZooKeeper path for zero-copy marks for shared data. Note that &quot;zero-copy replication&quot; is non-production feature (in early stages of development) that you shouldn&#x27;t use anyway. But in case if you have used it, let you keep in mind this change. <a href="https://github.com/ClickHouse/ClickHouse/pull/32061" target="_blank" rel="noopener noreferrer">#32061</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Events clause support for WINDOW VIEW watch query. <a href="https://github.com/ClickHouse/ClickHouse/pull/32607" target="_blank" rel="noopener noreferrer">#32607</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Fix ACL with explicit digit hash in <code>clickhouse-keeper</code>: now the behavior consistent with ZooKeeper and generated digest is always accepted. <a href="https://github.com/ClickHouse/ClickHouse/pull/33249" target="_blank" rel="noopener noreferrer">#33249</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33246" target="_blank" rel="noopener noreferrer">#33246</a>.</li><li>Fix unexpected projection removal when detaching parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/32067" target="_blank" rel="noopener noreferrer">#32067</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-3">Improvement<a class="hash-link" href="#improvement-3" title="Direct link to heading">​</a></h4><ul><li>Now date time conversion functions that generates time before <code>1970-01-01 00:00:00</code> will be saturated to zero instead of overflow. <a href="https://github.com/ClickHouse/ClickHouse/pull/29953" target="_blank" rel="noopener noreferrer">#29953</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>). It also fixes a bug in index analysis if date truncation function would yield result before the Unix epoch.</li><li>Always display resource usage (total CPU usage, total RAM usage and max RAM usage per host) in client. <a href="https://github.com/ClickHouse/ClickHouse/pull/33271" target="_blank" rel="noopener noreferrer">#33271</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve <code>Bool</code> type serialization and deserialization, check the range of values. <a href="https://github.com/ClickHouse/ClickHouse/pull/32984" target="_blank" rel="noopener noreferrer">#32984</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>If an invalid setting is defined using the <code>SET</code> query or using the query parameters in the HTTP request, error message will contain suggestions that are similar to the invalid setting string (if any exists). <a href="https://github.com/ClickHouse/ClickHouse/pull/32946" target="_blank" rel="noopener noreferrer">#32946</a> (<a href="https://github.com/antonio2368" target="_blank" rel="noopener noreferrer">Antonio Andelic</a>).</li><li>Support hints for mistyped setting names for clickhouse-client and clickhouse-local. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32237" target="_blank" rel="noopener noreferrer">#32237</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32841" target="_blank" rel="noopener noreferrer">#32841</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>Allow to use virtual columns in Materialized Views. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/11210" target="_blank" rel="noopener noreferrer">#11210</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33482" target="_blank" rel="noopener noreferrer">#33482</a> (<a href="https://github.com/zhongyuankai" target="_blank" rel="noopener noreferrer">OnePiece</a>).</li><li>Add config to disable IPv6 in clickhouse-keeper if needed. This close <a href="https://github.com/ClickHouse/ClickHouse/issues/33381" target="_blank" rel="noopener noreferrer">#33381</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33450" target="_blank" rel="noopener noreferrer">#33450</a> (<a href="https://github.com/wuxueyang96" target="_blank" rel="noopener noreferrer">Wu Xueyang</a>).</li><li>Add more info to <code>system.build_options</code> about current git revision. <a href="https://github.com/ClickHouse/ClickHouse/pull/33431" target="_blank" rel="noopener noreferrer">#33431</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li><code>clickhouse-local</code>: track memory under <code>--max_memory_usage_in_client</code> option. <a href="https://github.com/ClickHouse/ClickHouse/pull/33341" target="_blank" rel="noopener noreferrer">#33341</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow negative intervals in function <code>intervalLengthSum</code>. Their length will be added as well. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33323" target="_blank" rel="noopener noreferrer">#33323</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33335" target="_blank" rel="noopener noreferrer">#33335</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><code>LineAsString</code> can be used as output format. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30919" target="_blank" rel="noopener noreferrer">#30919</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33331" target="_blank" rel="noopener noreferrer">#33331</a> (<a href="https://github.com/serxa" target="_blank" rel="noopener noreferrer">Sergei Trifonov</a>).</li><li>Support <code>&lt;secure/&gt;</code> in cluster configuration, as an alternative form of <code>&lt;secure&gt;1&lt;/secure&gt;</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/33270" target="_blank" rel="noopener noreferrer">#33270</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33330" target="_blank" rel="noopener noreferrer">#33330</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Pressing Ctrl+C twice will terminate <code>clickhouse-benchmark</code> immediately without waiting for in-flight queries. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32586" target="_blank" rel="noopener noreferrer">#32586</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33303" target="_blank" rel="noopener noreferrer">#33303</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support Unix timestamp with milliseconds in <code>parseDateTimeBestEffort</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/33276" target="_blank" rel="noopener noreferrer">#33276</a> (<a href="https://github.com/benbiti" target="_blank" rel="noopener noreferrer">Ben</a>).</li><li>Allow to cancel query while reading data from external table in the formats: <code>Arrow</code> / <code>Parquet</code> / <code>ORC</code> - it failed to be cancelled it case of big files and setting input_format_allow_seeks as false. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29678" target="_blank" rel="noopener noreferrer">#29678</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33238" target="_blank" rel="noopener noreferrer">#33238</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>If table engine supports <code>SETTINGS</code> clause, allow to pass the settings as key-value or via config. Add this support for MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/33231" target="_blank" rel="noopener noreferrer">#33231</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Correctly prevent Nullable primary keys if necessary. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/32780" target="_blank" rel="noopener noreferrer">#32780</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33218" target="_blank" rel="noopener noreferrer">#33218</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add retry for <code>PostgreSQL</code> connections in case nothing has been fetched yet. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33199" target="_blank" rel="noopener noreferrer">#33199</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33209" target="_blank" rel="noopener noreferrer">#33209</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Validate config keys for external dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/issues/33095#issuecomment-1000577517" target="_blank" rel="noopener noreferrer">#33095</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33130" target="_blank" rel="noopener noreferrer">#33130</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Send profile info inside <code>clickhouse-local</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33093" target="_blank" rel="noopener noreferrer">#33093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33097" target="_blank" rel="noopener noreferrer">#33097</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Short circuit evaluation: support for function <code>throwIf</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32969" target="_blank" rel="noopener noreferrer">#32969</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32973" target="_blank" rel="noopener noreferrer">#32973</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>(This only happens in unofficial builds). Fixed segfault when inserting data into compressed Decimal, String, FixedString and Array columns. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32939" target="_blank" rel="noopener noreferrer">#32939</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32940" target="_blank" rel="noopener noreferrer">#32940</a> (<a href="https://github.com/nkolotov" target="_blank" rel="noopener noreferrer">N. Kolotov</a>).</li><li>Added support for specifying subquery as SQL user defined function. Example: <code>CREATE FUNCTION test AS () -&gt; (SELECT 1)</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30755" target="_blank" rel="noopener noreferrer">#30755</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32758" target="_blank" rel="noopener noreferrer">#32758</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve gRPC compression support for <a href="https://github.com/ClickHouse/ClickHouse/issues/28671" target="_blank" rel="noopener noreferrer">#28671</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32747" target="_blank" rel="noopener noreferrer">#32747</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Flush all In-Memory data parts when WAL is not enabled while shutdown server or detaching table. <a href="https://github.com/ClickHouse/ClickHouse/pull/32742" target="_blank" rel="noopener noreferrer">#32742</a> (<a href="https://github.com/nautaa" target="_blank" rel="noopener noreferrer">nauta</a>).</li><li>Allow to control connection timeouts for MySQL (previously was supported only for dictionary source). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16669" target="_blank" rel="noopener noreferrer">#16669</a>. Previously default connect_timeout was rather small, now it is configurable. <a href="https://github.com/ClickHouse/ClickHouse/pull/32734" target="_blank" rel="noopener noreferrer">#32734</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support <code>authSource</code> option for storage <code>MongoDB</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32594" target="_blank" rel="noopener noreferrer">#32594</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32702" target="_blank" rel="noopener noreferrer">#32702</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support <code>Date32</code> type in <code>genarateRandom</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/32643" target="_blank" rel="noopener noreferrer">#32643</a> (<a href="https://github.com/nautaa" target="_blank" rel="noopener noreferrer">nauta</a>).</li><li>Add settings <code>max_concurrent_select_queries</code> and <code>max_concurrent_insert_queries</code> for control concurrent queries by query kind. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/3575" target="_blank" rel="noopener noreferrer">#3575</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32609" target="_blank" rel="noopener noreferrer">#32609</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Improve handling nested structures with missing columns while reading data in <code>Protobuf</code> format. Follow-up to <a href="https://github.com/ClickHouse/ClickHouse/pull/31988" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/31988</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32531" target="_blank" rel="noopener noreferrer">#32531</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Allow empty credentials for <code>MongoDB</code> engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26267" target="_blank" rel="noopener noreferrer">#26267</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32460" target="_blank" rel="noopener noreferrer">#32460</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Disable some optimizations for window functions that may lead to exceptions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31535" target="_blank" rel="noopener noreferrer">#31535</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31620" target="_blank" rel="noopener noreferrer">#31620</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32453" target="_blank" rel="noopener noreferrer">#32453</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Allows to connect to MongoDB 5.0. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31483" target="_blank" rel="noopener noreferrer">#31483</a>,. <a href="https://github.com/ClickHouse/ClickHouse/pull/32416" target="_blank" rel="noopener noreferrer">#32416</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Enable comparison between <code>Decimal</code> and <code>Float</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22626" target="_blank" rel="noopener noreferrer">#22626</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31966" target="_blank" rel="noopener noreferrer">#31966</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Added settings <code>command_read_timeout</code>, <code>command_write_timeout</code> for <code>StorageExecutable</code>, <code>StorageExecutablePool</code>, <code>ExecutableDictionary</code>, <code>ExecutablePoolDictionary</code>, <code>ExecutableUserDefinedFunctions</code>. Setting <code>command_read_timeout</code> controls timeout for reading data from command stdout in milliseconds. Setting <code>command_write_timeout</code> timeout for writing data to command stdin in milliseconds. Added settings <code>command_termination_timeout</code> for <code>ExecutableUserDefinedFunction</code>, <code>ExecutableDictionary</code>, <code>StorageExecutable</code>. Added setting <code>execute_direct</code> for <code>ExecutableUserDefinedFunction</code>, by default true. Added setting <code>execute_direct</code> for <code>ExecutableDictionary</code>, <code>ExecutablePoolDictionary</code>, by default false. <a href="https://github.com/ClickHouse/ClickHouse/pull/30957" target="_blank" rel="noopener noreferrer">#30957</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Bitmap aggregate functions will give correct result for out of range argument instead of wraparound. <a href="https://github.com/ClickHouse/ClickHouse/pull/33127" target="_blank" rel="noopener noreferrer">#33127</a> (<a href="https://github.com/freedomDR" target="_blank" rel="noopener noreferrer">DR</a>).</li><li>Fix parsing incorrect queries with <code>FROM INFILE</code> statement. <a href="https://github.com/ClickHouse/ClickHouse/pull/33521" target="_blank" rel="noopener noreferrer">#33521</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Don&#x27;t allow to write into <code>S3</code> if path contains globs. <a href="https://github.com/ClickHouse/ClickHouse/pull/33142" target="_blank" rel="noopener noreferrer">#33142</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li><code>--echo</code> option was not used by <code>clickhouse-client</code> in batch mode with single query. <a href="https://github.com/ClickHouse/ClickHouse/pull/32843" target="_blank" rel="noopener noreferrer">#32843</a> (<a href="https://github.com/nkolotov" target="_blank" rel="noopener noreferrer">N. Kolotov</a>).</li><li>Use <code>--database</code> option for clickhouse-local. <a href="https://github.com/ClickHouse/ClickHouse/pull/32797" target="_blank" rel="noopener noreferrer">#32797</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix surprisingly bad code in SQL ordinary function <code>file</code>. Now it supports symlinks. <a href="https://github.com/ClickHouse/ClickHouse/pull/32640" target="_blank" rel="noopener noreferrer">#32640</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Updating <code>modification_time</code> for data part in <code>system.parts</code> after part movement <a href="https://github.com/ClickHouse/ClickHouse/issues/32964" target="_blank" rel="noopener noreferrer">#32964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32965" target="_blank" rel="noopener noreferrer">#32965</a> (<a href="https://github.com/save-my-heart" target="_blank" rel="noopener noreferrer">save-my-heart</a>).</li><li>Potential issue, cannot be exploited: integer overflow may happen in array resize. <a href="https://github.com/ClickHouse/ClickHouse/pull/33024" target="_blank" rel="noopener noreferrer">#33024</a> (<a href="https://github.com/varadarajkumar" target="_blank" rel="noopener noreferrer">varadarajkumar</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-3">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-3" title="Direct link to heading">​</a></h4><ul><li>Add packages, functional tests and Docker builds for AArch64 (ARM) version of ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/32911" target="_blank" rel="noopener noreferrer">#32911</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/32415" target="_blank" rel="noopener noreferrer">#32415</a></li><li>Prepare ClickHouse to be built with musl-libc. It is not enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/33134" target="_blank" rel="noopener noreferrer">#33134</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make installation script working on FreeBSD. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33384" target="_blank" rel="noopener noreferrer">#33384</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33418" target="_blank" rel="noopener noreferrer">#33418</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add <code>actionlint</code> for GitHub Actions workflows and verify workflow files via <code>act --list</code> to check the correct workflow syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/33612" target="_blank" rel="noopener noreferrer">#33612</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Add more tests for the nullable primary key feature. Add more tests with different types and merge tree kinds, plus randomly generated data. <a href="https://github.com/ClickHouse/ClickHouse/pull/33228" target="_blank" rel="noopener noreferrer">#33228</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add a simple tool to visualize flaky tests in web browser. <a href="https://github.com/ClickHouse/ClickHouse/pull/33185" target="_blank" rel="noopener noreferrer">#33185</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Enable hermetic build for shared builds. This is mainly for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/32968" target="_blank" rel="noopener noreferrer">#32968</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Update <code>libc++</code> and <code>libc++abi</code> to the latest. <a href="https://github.com/ClickHouse/ClickHouse/pull/32484" target="_blank" rel="noopener noreferrer">#32484</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Added integration test for external .NET client (<a href="https://github.com/DarkWanderer/ClickHouse.Client" target="_blank" rel="noopener noreferrer">ClickHouse.Client</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/23230" target="_blank" rel="noopener noreferrer">#23230</a> (<a href="https://github.com/DarkWanderer" target="_blank" rel="noopener noreferrer">Oleg V. Kozlyuk</a>).</li><li>Inject git information into clickhouse binary file. So we can get source code revision easily from clickhouse binary file. <a href="https://github.com/ClickHouse/ClickHouse/pull/33124" target="_blank" rel="noopener noreferrer">#33124</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li>Remove obsolete code from ConfigProcessor. Yandex specific code is not used anymore. The code contained one minor defect. This defect was reported by <a href="https://github.com/SadiHassan" target="_blank" rel="noopener noreferrer">Mallik Hassan</a> in <a href="https://github.com/ClickHouse/ClickHouse/issues/33032" target="_blank" rel="noopener noreferrer">#33032</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33032" target="_blank" rel="noopener noreferrer">#33032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33026" target="_blank" rel="noopener noreferrer">#33026</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release">Bug Fix (user-visible misbehavior in official stable or prestable release)<a class="hash-link" href="#bug-fix-user-visible-misbehavior-in-official-stable-or-prestable-release" title="Direct link to heading">​</a></h4><ul><li>Several fixes for format parsing. This is relevant if <code>clickhouse-server</code> is open for write access to adversary. Specifically crafted input data for <code>Native</code> format may lead to reading uninitialized memory or crash. This is relevant if <code>clickhouse-server</code> is open for write access to adversary. <a href="https://github.com/ClickHouse/ClickHouse/pull/33050" target="_blank" rel="noopener noreferrer">#33050</a> (<a href="https://github.com/HeenaBansal2009" target="_blank" rel="noopener noreferrer">Heena Bansal</a>). Fixed Apache Avro Union type index out of boundary issue in Apache Avro binary format. <a href="https://github.com/ClickHouse/ClickHouse/pull/33022" target="_blank" rel="noopener noreferrer">#33022</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>). Fix null pointer dereference in <code>LowCardinality</code> data when deserializing <code>LowCardinality</code> data in the Native format. <a href="https://github.com/ClickHouse/ClickHouse/pull/33021" target="_blank" rel="noopener noreferrer">#33021</a> (<a href="https://github.com/HarryLeeIBM" target="_blank" rel="noopener noreferrer">Harry Lee</a>).</li><li>ClickHouse Keeper handler will correctly remove operation when response sent. <a href="https://github.com/ClickHouse/ClickHouse/pull/32988" target="_blank" rel="noopener noreferrer">#32988</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Potential off-by-one miscalculation of quotas: quota limit was not reached, but the limit was exceeded. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31174" target="_blank" rel="noopener noreferrer">#31174</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31656" target="_blank" rel="noopener noreferrer">#31656</a> (<a href="https://github.com/sunny19930321" target="_blank" rel="noopener noreferrer">sunny</a>).</li><li>Fixed CASTing from String to IPv4 or IPv6 and back. Fixed error message in case of failed conversion. <a href="https://github.com/ClickHouse/ClickHouse/pull/29224" target="_blank" rel="noopener noreferrer">#29224</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/27914" target="_blank" rel="noopener noreferrer">#27914</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fixed an exception like <code>Unknown aggregate function nothing</code> during an execution on a remote server. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16689" target="_blank" rel="noopener noreferrer">#16689</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26074" target="_blank" rel="noopener noreferrer">#26074</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix wrong database for JOIN without explicit database in distributed queries (Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10471" target="_blank" rel="noopener noreferrer">#10471</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/33611" target="_blank" rel="noopener noreferrer">#33611</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix segfault in Apache <code>Avro</code> format that appears after the second insert into file. <a href="https://github.com/ClickHouse/ClickHouse/pull/33566" target="_blank" rel="noopener noreferrer">#33566</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix segfault in Apache <code>Arrow</code> format if schema contains <code>Dictionary</code> type. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33507" target="_blank" rel="noopener noreferrer">#33507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33529" target="_blank" rel="noopener noreferrer">#33529</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Out of band <code>offset</code> and <code>limit</code> settings may be applied incorrectly for views. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/33289" target="_blank" rel="noopener noreferrer">#33289</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/33518" target="_blank" rel="noopener noreferrer">#33518</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix an exception <code>Block structure mismatch</code> which may happen during insertion into table with default nested <code>LowCardinality</code> column. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/33028" target="_blank" rel="noopener noreferrer">#33028</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33504" target="_blank" rel="noopener noreferrer">#33504</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix dictionary expressions for <code>range_hashed</code> range min and range max attributes when created using DDL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30809" target="_blank" rel="noopener noreferrer">#30809</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33478" target="_blank" rel="noopener noreferrer">#33478</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix possible use-after-free for INSERT into Materialized View with concurrent DROP (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not try to read pass EOF (to workaround for a bug in the Linux kernel), this bug can be reproduced on kernels (3.14..5.9), and requires <code>index_granularity_bytes=0</code> (i.e. turn off adaptive index granularity). <a href="https://github.com/ClickHouse/ClickHouse/pull/33372" target="_blank" rel="noopener noreferrer">#33372</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>The commands <code>SYSTEM SUSPEND</code> and <code>SYSTEM ... THREAD FUZZER</code> missed access control. It is fixed. Author: Kevin Michel. <a href="https://github.com/ClickHouse/ClickHouse/pull/33333" target="_blank" rel="noopener noreferrer">#33333</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix when <code>COMMENT</code> for dictionaries does not appear in <code>system.tables</code>, <code>system.dictionaries</code>. Allow to modify the comment for <code>Dictionary</code> engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33251" target="_blank" rel="noopener noreferrer">#33251</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33261" target="_blank" rel="noopener noreferrer">#33261</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add asynchronous inserts (with enabled setting <code>async_insert</code>) to query log. Previously such queries didn&#x27;t appear in the query log. <a href="https://github.com/ClickHouse/ClickHouse/pull/33239" target="_blank" rel="noopener noreferrer">#33239</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix sending <code>WHERE 1 = 0</code> expressions for external databases query. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33152" target="_blank" rel="noopener noreferrer">#33152</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33214" target="_blank" rel="noopener noreferrer">#33214</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix DDL validation for MaterializedPostgreSQL. Fix setting <code>materialized_postgresql_allow_automatic_update</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29535" target="_blank" rel="noopener noreferrer">#29535</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33200" target="_blank" rel="noopener noreferrer">#33200</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Make sure unused replication slots are always removed. Found in <a href="https://github.com/ClickHouse/ClickHouse/issues/26952" target="_blank" rel="noopener noreferrer">#26952</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33187" target="_blank" rel="noopener noreferrer">#33187</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Fix MaterializedPostreSQL detach/attach (removing / adding to replication) tables with non-default schema. Found in <a href="https://github.com/ClickHouse/ClickHouse/issues/29535" target="_blank" rel="noopener noreferrer">#29535</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33179" target="_blank" rel="noopener noreferrer">#33179</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). Fix DROP MaterializedPostgreSQL database. <a href="https://github.com/ClickHouse/ClickHouse/pull/33468" target="_blank" rel="noopener noreferrer">#33468</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>The metric <code>StorageBufferBytes</code> sometimes was miscalculated. <a href="https://github.com/ClickHouse/ClickHouse/pull/33159" target="_blank" rel="noopener noreferrer">#33159</a> (<a href="https://github.com/xuyatian" target="_blank" rel="noopener noreferrer">xuyatian</a>).</li><li>Fix error <code>Invalid version for SerializationLowCardinality key column</code> in case of reading from <code>LowCardinality</code> column with <code>local_filesystem_read_prefetch</code> or <code>remote_filesystem_read_prefetch</code> enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/33046" target="_blank" rel="noopener noreferrer">#33046</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>s3</code> table function reading empty file. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/33008" target="_blank" rel="noopener noreferrer">#33008</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33037" target="_blank" rel="noopener noreferrer">#33037</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix Context leak in case of cancel_http_readonly_queries_on_client_close (i.e. leaking of external tables that had been uploaded the the server and other resources). <a href="https://github.com/ClickHouse/ClickHouse/pull/32982" target="_blank" rel="noopener noreferrer">#32982</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix wrong tuple output in <code>CSV</code> format in case of custom csv delimiter. <a href="https://github.com/ClickHouse/ClickHouse/pull/32981" target="_blank" rel="noopener noreferrer">#32981</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix HDFS URL check that didn&#x27;t allow using HA namenode address. Bug was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/31042" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/31042</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32976" target="_blank" rel="noopener noreferrer">#32976</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix throwing exception like positional argument out of bounds for non-positional arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31173" target="_blank" rel="noopener noreferrer">#31173</a>#event-5789668239. <a href="https://github.com/ClickHouse/ClickHouse/pull/32961" target="_blank" rel="noopener noreferrer">#32961</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix UB in case of unexpected EOF during filling a set from HTTP query (i.e. if the client interrupted in the middle, i.e. <code>timeout 0.15s curl -Ss -F &#x27;s=@t.csv;&#x27; &#x27;http://127.0.0.1:8123/?s_structure=key+Int&amp;query=SELECT+dummy+IN+s&#x27;</code> and with large enough <code>t.csv</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/32955" target="_blank" rel="noopener noreferrer">#32955</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix a regression in <code>replaceRegexpAll</code> function. The function worked incorrectly when matched substring was empty. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32777" target="_blank" rel="noopener noreferrer">#32777</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30245" target="_blank" rel="noopener noreferrer">#30245</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32945" target="_blank" rel="noopener noreferrer">#32945</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>ORC</code> format stripe reading. <a href="https://github.com/ClickHouse/ClickHouse/pull/32929" target="_blank" rel="noopener noreferrer">#32929</a> (<a href="https://github.com/kreuzerkrieg" target="_blank" rel="noopener noreferrer">kreuzerkrieg</a>).</li><li><code>topKWeightedState</code> failed for some input types. <a href="https://github.com/ClickHouse/ClickHouse/issues/32487" target="_blank" rel="noopener noreferrer">#32487</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32914" target="_blank" rel="noopener noreferrer">#32914</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix exception <code>Single chunk is expected from view inner query (LOGICAL_ERROR)</code> in materialized view. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31419" target="_blank" rel="noopener noreferrer">#31419</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32862" target="_blank" rel="noopener noreferrer">#32862</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix optimization with lazy seek for async reads from remote filesystems. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32803" target="_blank" rel="noopener noreferrer">#32803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32835" target="_blank" rel="noopener noreferrer">#32835</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li><code>MergeTree</code> table engine might silently skip some mutations if there are too many running mutations or in case of high memory consumption, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17882" target="_blank" rel="noopener noreferrer">#17882</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32814" target="_blank" rel="noopener noreferrer">#32814</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Avoid reusing the scalar subquery cache when processing MV blocks. This fixes a bug when the scalar query reference the source table but it means that all subscalar queries in the MV definition will be calculated for each block. <a href="https://github.com/ClickHouse/ClickHouse/pull/32811" target="_blank" rel="noopener noreferrer">#32811</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Server might fail to start if database with <code>MySQL</code> engine cannot connect to MySQL server, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14441" target="_blank" rel="noopener noreferrer">#14441</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32802" target="_blank" rel="noopener noreferrer">#32802</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix crash when used <code>fuzzBits</code> function, close <a href="https://github.com/ClickHouse/ClickHouse/issues/32737" target="_blank" rel="noopener noreferrer">#32737</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32755" target="_blank" rel="noopener noreferrer">#32755</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Fix error <code>Column is not under aggregate function</code> in case of MV with <code>GROUP BY (list of columns)</code> (which is pared as <code>GROUP BY tuple(...)</code>) over <code>Kafka</code>/<code>RabbitMQ</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/32668" target="_blank" rel="noopener noreferrer">#32668</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/32744" target="_blank" rel="noopener noreferrer">#32744</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32751" target="_blank" rel="noopener noreferrer">#32751</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>ALTER TABLE ... MATERIALIZE TTL</code> query with <code>TTL ... DELETE WHERE ...</code> and <code>TTL ... GROUP BY ...</code> modes. <a href="https://github.com/ClickHouse/ClickHouse/pull/32695" target="_blank" rel="noopener noreferrer">#32695</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix <code>optimize_read_in_order</code> optimization in case when table engine is <code>Distributed</code> or <code>Merge</code> and its underlying <code>MergeTree</code> tables have monotonous function in prefix of sorting key. <a href="https://github.com/ClickHouse/ClickHouse/pull/32670" target="_blank" rel="noopener noreferrer">#32670</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix LOGICAL_ERROR exception when the target of a materialized view is a JOIN or a SET table. <a href="https://github.com/ClickHouse/ClickHouse/pull/32669" target="_blank" rel="noopener noreferrer">#32669</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Inserting into S3 with multipart upload to Google Cloud Storage may trigger abort. <a href="https://github.com/ClickHouse/ClickHouse/issues/32504" target="_blank" rel="noopener noreferrer">#32504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32649" target="_blank" rel="noopener noreferrer">#32649</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix possible exception at <code>RabbitMQ</code> storage startup by delaying channel creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/32584" target="_blank" rel="noopener noreferrer">#32584</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix table lifetime (i.e. possible use-after-free) in case of parallel DROP TABLE and INSERT. <a href="https://github.com/ClickHouse/ClickHouse/pull/32572" target="_blank" rel="noopener noreferrer">#32572</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix async inserts with formats <code>CustomSeparated</code>, <code>Template</code>, <code>Regexp</code>, <code>MsgPack</code> and <code>JSONAsString</code>. Previousely the async inserts with these formats didn&#x27;t read any data. <a href="https://github.com/ClickHouse/ClickHouse/pull/32530" target="_blank" rel="noopener noreferrer">#32530</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>groupBitmapAnd</code> function on distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/32529" target="_blank" rel="noopener noreferrer">#32529</a> (<a href="https://github.com/dmthuc" target="_blank" rel="noopener noreferrer">minhthucdao</a>).</li><li>Fix crash in JOIN found by fuzzer, close <a href="https://github.com/ClickHouse/ClickHouse/issues/32458" target="_blank" rel="noopener noreferrer">#32458</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32508" target="_blank" rel="noopener noreferrer">#32508</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Proper handling of the case with Apache Arrow column duplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/32507" target="_blank" rel="noopener noreferrer">#32507</a> (<a href="https://github.com/DMokhnatkin" target="_blank" rel="noopener noreferrer">Dmitriy Mokhnatkin</a>).</li><li>Fix issue with ambiguous query formatting in distributed queries that led to errors when some table columns were named <code>ALL</code> or <code>DISTINCT</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32391" target="_blank" rel="noopener noreferrer">#32391</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32490" target="_blank" rel="noopener noreferrer">#32490</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix failures in queries that are trying to use skipping indices, which are not materialized yet. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/32292" target="_blank" rel="noopener noreferrer">#32292</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/30343" target="_blank" rel="noopener noreferrer">#30343</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32359" target="_blank" rel="noopener noreferrer">#32359</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix broken select query when there are more than 2 row policies on same column, begin at second queries on the same session. <a href="https://github.com/ClickHouse/ClickHouse/issues/31606" target="_blank" rel="noopener noreferrer">#31606</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32291" target="_blank" rel="noopener noreferrer">#32291</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Fix fractional unix timestamp conversion to <code>DateTime64</code>, fractional part was reversed for negative unix timestamps (before 1970-01-01). <a href="https://github.com/ClickHouse/ClickHouse/pull/32240" target="_blank" rel="noopener noreferrer">#32240</a> (<a href="https://github.com/benbiti" target="_blank" rel="noopener noreferrer">Ben</a>).</li><li>Some entries of replication queue might hang for <code>temporary_directories_lifetime</code> (1 day by default) with <code>Directory tmp_merge_&lt;part_name&gt;</code> or <code>Part ... (state Deleting) already exists, but it will be deleted soon</code> or similar error. It&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29616" target="_blank" rel="noopener noreferrer">#29616</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32201" target="_blank" rel="noopener noreferrer">#32201</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix parsing of <code>APPLY lambda</code> column transformer which could lead to client/server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/32138" target="_blank" rel="noopener noreferrer">#32138</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix <code>base64Encode</code> adding trailing bytes on small strings. <a href="https://github.com/ClickHouse/ClickHouse/pull/31797" target="_blank" rel="noopener noreferrer">#31797</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Fix possible crash (or incorrect result) in case of <code>LowCardinality</code> arguments of window function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31114" target="_blank" rel="noopener noreferrer">#31114</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31888" target="_blank" rel="noopener noreferrer">#31888</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix hang up with command <code>DROP TABLE system.query_log sync</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/33293" target="_blank" rel="noopener noreferrer">#33293</a> (<a href="https://github.com/zhanghuajieHIT" target="_blank" rel="noopener noreferrer">zhanghuajie</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="changelog-for-2021"><a href="/docs/en/whats-new/changelog/2021">Changelog for 2021</a><a class="hash-link" href="#changelog-for-2021" title="Direct link to heading">​</a></h3></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/whats-new/changelog/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/en/whats-new/roadmap"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Roadmap</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/en/whats-new/changelog/2021"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2021</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#clickhouse-release-v224-2022-040-20" class="table-of-contents__link toc-highlight">ClickHouse release v22.4, 2022-040-20</a></li><li><a href="#clickhouse-release-v223-lts-2022-03-17" class="table-of-contents__link toc-highlight">ClickHouse release v22.3-lts, 2022-03-17</a></li><li><a href="#clickhouse-release-v222-2022-02-17" class="table-of-contents__link toc-highlight">ClickHouse release v22.2, 2022-02-17</a></li><li><a href="#clickhouse-release-v221-2022-01-18" class="table-of-contents__link toc-highlight">ClickHouse release v22.1, 2022-01-18</a></li><li><a href="#changelog-for-2021" class="table-of-contents__link toc-highlight">Changelog for 2021</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ClickHouse</div><ul class="footer__items"><li class="footer__item"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company</a></li><li class="footer__item"><a href="https://clickhouse.com/cloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">ClickHouse as a Service</a></li><li class="footer__item"><a href="https://clickhouse.com/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers</a></li><li class="footer__item"><a href="https://clickhouse.com/learn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Learn ClickHouse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ClickHouse/ClickHouse" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://clickhouse.com/blog/en/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/clickhousedb/shared_invite/zt-rxm3rdrk-lIUmhLC3V8WTaL0TGxsOmg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Policies</div><ul class="footer__items"><li class="footer__item"><a href="https://clickhouse.com/legal/trademark-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademark Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/privacy-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/docs/img/clickhouse.svg" alt="ClickHouse Documentation" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/docs/img/clickhouse.svg" alt="ClickHouse Documentation" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></div><div class="footer__copyright">Copyright &copy; 2016&ndash;2022 ClickHouse, Inc. ClickHouse Docs provided under the Creative Commons CC BY-NC-SA 4.0 license. ClickHouse&reg; is a registered trademark of ClickHouse, Inc.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.832195c1.js"></script>
<script src="/docs/assets/js/main.0e6c66ce.js"></script>
</body>
</html>