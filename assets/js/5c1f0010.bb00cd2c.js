"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[53437],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return c}});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var u=a.createContext({}),o=function(e){var n=a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},m=function(e){var n=o(e.components);return a.createElement(u.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},k=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,u=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),k=o(t),c=r,d=k["".concat(u,".").concat(c)]||k[c]||s[c]||l;return t?a.createElement(d,p(p({ref:n},m),{},{components:t})):a.createElement(d,p({ref:n},m))}));function c(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,p=new Array(l);p[0]=k;var i={};for(var u in n)hasOwnProperty.call(n,u)&&(i[u]=n[u]);i.originalType=e,i.mdxType="string"==typeof e?e:r,p[1]=i;for(var o=2;o<l;o++)p[o]=t[o];return a.createElement.apply(null,p)}return a.createElement.apply(null,t)}k.displayName="MDXCreateElement"},99461:function(e,n,t){t.r(n),t.d(n,{assets:function(){return m},contentTitle:function(){return u},default:function(){return c},frontMatter:function(){return i},metadata:function(){return o},toc:function(){return s}});var a=t(87462),r=t(63366),l=(t(67294),t(3905)),p=["components"],i={sidebar_position:38,sidebar_label:"\u53c2\u6570\u805a\u5408\u51fd\u6570"},u="\u53c2\u6570\u805a\u5408\u51fd\u6570",o={unversionedId:"zh/sql-reference/aggregate-functions/parametric-functions",id:"zh/sql-reference/aggregate-functions/parametric-functions",title:"\u53c2\u6570\u805a\u5408\u51fd\u6570",description:"aggregatefunctionsparametric}",source:"@site/docs/zh/sql-reference/aggregate-functions/parametric-functions.md",sourceDirName:"zh/sql-reference/aggregate-functions",slug:"/zh/sql-reference/aggregate-functions/parametric-functions",permalink:"/docs/zh/sql-reference/aggregate-functions/parametric-functions",editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/zh/sql-reference/aggregate-functions/parametric-functions.md",tags:[],version:"current",sidebarPosition:38,frontMatter:{sidebar_position:38,sidebar_label:"\u53c2\u6570\u805a\u5408\u51fd\u6570"},sidebar:"chinese",previous:{title:"\u805a\u5408\u51fd\u6570\u7ec4\u5408\u5668",permalink:"/docs/zh/sql-reference/aggregate-functions/combinators"},next:{title:"\u8868\u51fd\u6570",permalink:"/docs/zh/sql-reference/table-functions/"}},m={},s=[{value:"histogram",id:"histogram",level:2},{value:"sequenceMatch(pattern)(timestamp, cond1, cond2, \u2026)",id:"function-sequencematch",level:2},{value:"sequenceCount(pattern)(time, cond1, cond2, \u2026)",id:"function-sequencecount",level:2},{value:"windowFunnel",id:"windowfunnel",level:2},{value:"Retention",id:"retention",level:2},{value:"uniqUpTo(N)(x)",id:"uniquptonx",level:2},{value:"sumMapFiltered(keys_to_keep)(keys, values)",id:"summapfilteredkeys-to-keepkeys-values",level:2}],k={toc:s};function c(e){var n=e.components,t=(0,r.Z)(e,p);return(0,l.kt)("wrapper",(0,a.Z)({},k,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"aggregate_functions_parametric"},"\u53c2\u6570\u805a\u5408\u51fd\u6570"),(0,l.kt)("p",null,"\u4e00\u4e9b\u805a\u5408\u51fd\u6570\u4e0d\u4ec5\u53ef\u4ee5\u63a5\u53d7\u53c2\u6570\u5217\uff08\u7528\u4e8e\u538b\u7f29\uff09\uff0c\u4e5f\u53ef\u4ee5\u63a5\u6536\u5e38\u91cf\u7684\u521d\u59cb\u5316\u53c2\u6570\u3002\u8fd9\u79cd\u8bed\u6cd5\u662f\u63a5\u53d7\u4e24\u4e2a\u62ec\u53f7\u7684\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u6570\u521d\u59cb\u5316\u53c2\u6570\uff0c\u7b2c\u4e8c\u4e2a\u662f\u5165\u53c2\u3002"),(0,l.kt)("h2",{id:"histogram"},"histogram"),(0,l.kt)("p",null,"\u8ba1\u7b97\u81ea\u9002\u5e94\u76f4\u65b9\u56fe\u3002 \u5b83\u4e0d\u80fd\u4fdd\u8bc1\u7cbe\u786e\u7684\u7ed3\u679c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"histogram(number_of_bins)(values)\n")),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u4f7f\u7528 ",(0,l.kt)("a",{parentName:"p",href:"http://jmlr.org/papers/volume11/ben-haim10a/ben-haim10a.pdf"},"\u6d41\u5f0f\u5e76\u884c\u51b3\u7b56\u6811\u7b97\u6cd5"),". \u5f53\u65b0\u6570\u636e\u8f93\u5165\u51fd\u6570\u65f6\uff0chist\u56fe\u5206\u533a\u7684\u8fb9\u754c\u5c06\u88ab\u8c03\u6574\u3002 \u5728\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u7bb1\u7684\u5bbd\u5ea6\u4e0d\u76f8\u7b49\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53c2\u6570")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"number_of_bins")," \u2014 \u76f4\u65b9\u56febin\u4e2a\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u4f1a\u81ea\u52a8\u8ba1\u7b97bin\u7684\u6570\u91cf\uff0c\u800c\u4e14\u4f1a\u5c3d\u91cf\u4f7f\u7528\u6307\u5b9a\u503c\uff0c\u5982\u679c\u65e0\u6cd5\u505a\u5230\uff0c\u90a3\u5c31\u4f7f\u7528\u66f4\u5c0f\u7684bin\u4e2a\u6570\u3002"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"values")," \u2014 ",(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/syntax#syntax-expressions"},"\u8868\u8fbe\u5f0f")," \u8f93\u5165\u503c\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/data-types/array"},"Array")," \u7684 ",(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/data-types/tuple"},"Tuples")," \u5982\u4e0b\uff1a"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre"},"```\n[(lower_1, upper_1, height_1), ... (lower_N, upper_N, height_N)]\n```\n\n- `lower` \u2014 bin\u7684\u4e0b\u8fb9\u754c\u3002\n- `upper` \u2014 bin\u7684\u4e0a\u8fb9\u754c\u3002\n- `height` \u2014 bin\u7684\u8ba1\u7b97\u6743\u91cd\u3002\n")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u793a\u4f8b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT histogram(5)(number + 1)\nFROM (\n    SELECT *\n    FROM system.numbers\n    LIMIT 20\n)\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500histogram(5)(plus(number, 1))\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 [(1,4.5,4),(4.5,8.5,4),(8.5,12.75,4.125),(12.75,17,4.625),(17,20,3.25)] \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/functions/other-functions#function-bar"},"bar")," \u529f\u80fd\uff0c\u4f8b\u5982:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"WITH histogram(5)(rand() % 100) AS hist\nSELECT\n    arrayJoin(hist).3 AS height,\n    bar(height, 0, 6, 5) AS bar\nFROM\n(\n    SELECT *\n    FROM system.numbers\n    LIMIT 20\n)\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500height\u2500\u252c\u2500bar\u2500\u2500\u2500\u2510\n\u2502  2.125 \u2502 \u2588\u258b    \u2502\n\u2502   3.25 \u2502 \u2588\u2588\u258c   \u2502\n\u2502  5.625 \u2502 \u2588\u2588\u2588\u2588\u258f \u2502\n\u2502  5.625 \u2502 \u2588\u2588\u2588\u2588\u258f \u2502\n\u2502  3.375 \u2502 \u2588\u2588\u258c   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u5e94\u8be5\u8bb0\u4f4f\u60a8\u4e0d\u77e5\u9053\u76f4\u65b9\u56febin\u8fb9\u754c\u3002"),(0,l.kt)("h2",{id:"function-sequencematch"},"sequenceMatch(pattern)(timestamp, cond1, cond2, \u2026)"),(0,l.kt)("p",null,"\u68c0\u67e5\u5e8f\u5217\u662f\u5426\u5305\u542b\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u4e8b\u4ef6\u94fe\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"sequenceMatch(pattern)(timestamp, cond1, cond2, ...)\n")),(0,l.kt)("p",null,'!!! warning "\u8b66\u544a"\n\u5728\u540c\u4e00\u79d2\u949f\u53d1\u751f\u7684\u4e8b\u4ef6\u53ef\u80fd\u4ee5\u672a\u5b9a\u4e49\u7684\u987a\u5e8f\u6392\u5217\u5728\u5e8f\u5217\u4e2d\uff0c\u5f71\u54cd\u7ed3\u679c\u3002'),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53c2\u6570")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"pattern")," \u2014 \u6a21\u5f0f\u5b57\u7b26\u4e32\u3002 \u53c2\u8003 ",(0,l.kt)("a",{parentName:"p",href:"#sequence-function-pattern-syntax"},"\u6a21\u5f0f\u8bed\u6cd5"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"timestamp")," \u2014 \u5305\u542b\u65f6\u95f4\u7684\u5217\u3002\u5178\u578b\u7684\u65f6\u95f4\u7c7b\u578b\u662f\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"Date")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"DateTime"),"\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u652f\u6301\u7684 ",(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/data-types/int-uint"},"UInt")," \u6570\u636e\u7c7b\u578b\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"cond1"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"cond2")," \u2014 \u4e8b\u4ef6\u94fe\u7684\u7ea6\u675f\u6761\u4ef6\u3002 \u6570\u636e\u7c7b\u578b\u662f\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"UInt8"),"\u3002 \u6700\u591a\u53ef\u4ee5\u4f20\u901232\u4e2a\u6761\u4ef6\u53c2\u6570\u3002 \u8be5\u51fd\u6570\u53ea\u8003\u8651\u8fd9\u4e9b\u6761\u4ef6\u4e2d\u63cf\u8ff0\u7684\u4e8b\u4ef6\u3002 \u5982\u679c\u5e8f\u5217\u5305\u542b\u672a\u5728\u6761\u4ef6\u4e2d\u63cf\u8ff0\u7684\u6570\u636e\uff0c\u5219\u51fd\u6570\u5c06\u8df3\u8fc7\u8fd9\u4e9b\u6570\u636e\u3002"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"1\uff0c\u5982\u679c\u6a21\u5f0f\u5339\u914d\u3002"),(0,l.kt)("li",{parentName:"ul"},"0\uff0c\u5982\u679c\u6a21\u5f0f\u4e0d\u5339\u914d\u3002")),(0,l.kt)("p",null,"\u7c7b\u578b: ",(0,l.kt)("inlineCode",{parentName:"p"},"UInt8"),"."),(0,l.kt)("a",{name:"sequence-function-pattern-syntax"}),"**\u6a21\u5f0f\u8bed\u6cd5**",(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"(?N)")," \u2014 \u5728\u4f4d\u7f6e",(0,l.kt)("inlineCode",{parentName:"p"},"N"),"\u5339\u914d\u6761\u4ef6\u53c2\u6570\u3002 \u6761\u4ef6\u5728\u7f16\u53f7 ",(0,l.kt)("inlineCode",{parentName:"p"},"[1, 32]")," \u8303\u56f4\u3002 \u4f8b\u5982, ",(0,l.kt)("inlineCode",{parentName:"p"},"(?1)")," \u5339\u914d\u4f20\u9012\u7ed9 ",(0,l.kt)("inlineCode",{parentName:"p"},"cond1")," \u53c2\u6570\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},".*")," \u2014 \u5339\u914d\u4efb\u4f55\u4e8b\u4ef6\u7684\u6570\u5b57\u3002 \u4e0d\u9700\u8981\u6761\u4ef6\u53c2\u6570\u6765\u5339\u914d\u8fd9\u4e2a\u6a21\u5f0f\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"(?t operator value)")," \u2014 \u5206\u5f00\u4e24\u4e2a\u4e8b\u4ef6\u7684\u65f6\u95f4\u3002 \u4f8b\u5982\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"(?1)(?t>1800)(?2)")," \u5339\u914d\u5f7c\u6b64\u53d1\u751f\u8d85\u8fc71800\u79d2\u7684\u4e8b\u4ef6\u3002 \u8fd9\u4e9b\u4e8b\u4ef6\u4e4b\u95f4\u53ef\u4ee5\u5b58\u5728\u4efb\u610f\u6570\u91cf\u7684\u4efb\u4f55\u4e8b\u4ef6\u3002 \u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},">="),", ",(0,l.kt)("inlineCode",{parentName:"p"},">"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"<"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"<="),", ",(0,l.kt)("inlineCode",{parentName:"p"},"=="),"  \u8fd0\u7b97\u7b26\u3002"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4f8b")),(0,l.kt)("p",null,"\u8003\u8651\u5728\u6570\u636e ",(0,l.kt)("inlineCode",{parentName:"p"},"t")," \u8868:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500time\u2500\u252c\u2500number\u2500\u2510\n\u2502    1 \u2502      1 \u2502\n\u2502    2 \u2502      3 \u2502\n\u2502    3 \u2502      2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u6267\u884c\u67e5\u8be2:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT sequenceMatch('(?1)(?2)')(time, number = 1, number = 2) FROM t\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500sequenceMatch('(?1)(?2)')(time, equals(number, 1), equals(number, 2))\u2500\u2510\n\u2502                                                                     1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u627e\u5230\u4e86\u6570\u5b572\u8ddf\u968f\u6570\u5b571\u7684\u4e8b\u4ef6\u94fe\u3002 \u5b83\u8df3\u8fc7\u4e86\u5b83\u4eec\u4e4b\u95f4\u7684\u6570\u5b573\uff0c\u56e0\u4e3a\u8be5\u6570\u5b57\u6ca1\u6709\u88ab\u63cf\u8ff0\u4e3a\u4e8b\u4ef6\u3002 \u5982\u679c\u6211\u4eec\u60f3\u5728\u641c\u7d22\u793a\u4f8b\u4e2d\u7ed9\u51fa\u7684\u4e8b\u4ef6\u94fe\u65f6\u8003\u8651\u8fd9\u4e2a\u6570\u5b57\uff0c\u6211\u4eec\u5e94\u8be5\u4e3a\u5b83\u521b\u5efa\u4e00\u4e2a\u6761\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT sequenceMatch('(?1)(?2)')(time, number = 1, number = 2, number = 3) FROM t\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500sequenceMatch('(?1)(?2)')(time, equals(number, 1), equals(number, 2), equals(number, 3))\u2500\u2510\n\u2502                                                                                        0 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u627e\u4e0d\u5230\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u4e8b\u4ef6\u94fe\uff0c\u56e0\u4e3a\u6570\u5b573\u7684\u4e8b\u4ef6\u53d1\u751f\u57281\u548c2\u4e4b\u95f4\u3002 \u5982\u679c\u5728\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u68c0\u67e5\u4e86\u6570\u5b574\u7684\u6761\u4ef6\uff0c\u5219\u5e8f\u5217\u5c06\u4e0e\u6a21\u5f0f\u5339\u914d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT sequenceMatch('(?1)(?2)')(time, number = 1, number = 2, number = 4) FROM t\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500sequenceMatch('(?1)(?2)')(time, equals(number, 1), equals(number, 2), equals(number, 4))\u2500\u2510\n\u2502                                                                                        1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53e6\u8bf7\u53c2\u9605")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#function-sequencecount"},"sequenceCount"))),(0,l.kt)("h2",{id:"function-sequencecount"},"sequenceCount(pattern)(time, cond1, cond2, \u2026)"),(0,l.kt)("p",null,"\u8ba1\u7b97\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u4e8b\u4ef6\u94fe\u7684\u6570\u91cf\u3002\u8be5\u51fd\u6570\u641c\u7d22\u4e0d\u91cd\u53e0\u7684\u4e8b\u4ef6\u94fe\u3002\u5f53\u524d\u94fe\u5339\u914d\u540e\uff0c\u5b83\u5f00\u59cb\u641c\u7d22\u4e0b\u4e00\u4e2a\u94fe\u3002"),(0,l.kt)("p",null,'!!! warning "\u8b66\u544a"\n\u5728\u540c\u4e00\u79d2\u949f\u53d1\u751f\u7684\u4e8b\u4ef6\u53ef\u80fd\u4ee5\u672a\u5b9a\u4e49\u7684\u987a\u5e8f\u6392\u5217\u5728\u5e8f\u5217\u4e2d\uff0c\u5f71\u54cd\u7ed3\u679c\u3002'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"sequenceCount(pattern)(timestamp, cond1, cond2, ...)\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53c2\u6570")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"pattern")," \u2014 \u6a21\u5f0f\u5b57\u7b26\u4e32\u3002 \u53c2\u8003\uff1a",(0,l.kt)("a",{parentName:"p",href:"#sequence-function-pattern-syntax"},"\u6a21\u5f0f\u8bed\u6cd5"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"timestamp")," \u2014 \u5305\u542b\u65f6\u95f4\u7684\u5217\u3002\u5178\u578b\u7684\u65f6\u95f4\u7c7b\u578b\u662f\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"Date")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"DateTime"),"\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u652f\u6301\u7684 ",(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/data-types/int-uint"},"UInt")," \u6570\u636e\u7c7b\u578b\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"cond1"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"cond2")," \u2014 \u4e8b\u4ef6\u94fe\u7684\u7ea6\u675f\u6761\u4ef6\u3002 \u6570\u636e\u7c7b\u578b\u662f\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"UInt8"),"\u3002 \u6700\u591a\u53ef\u4ee5\u4f20\u901232\u4e2a\u6761\u4ef6\u53c2\u6570\u3002\u8be5\u51fd\u6570\u53ea\u8003\u8651\u8fd9\u4e9b\u6761\u4ef6\u4e2d\u63cf\u8ff0\u7684\u4e8b\u4ef6\u3002 \u5982\u679c\u5e8f\u5217\u5305\u542b\u672a\u5728\u6761\u4ef6\u4e2d\u63cf\u8ff0\u7684\u6570\u636e\uff0c\u5219\u51fd\u6570\u5c06\u8df3\u8fc7\u8fd9\u4e9b\u6570\u636e\u3002"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5339\u914d\u7684\u975e\u91cd\u53e0\u4e8b\u4ef6\u94fe\u6570\u3002")),(0,l.kt)("p",null,"\u7c7b\u578b: ",(0,l.kt)("inlineCode",{parentName:"p"},"UInt64"),"."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u793a\u4f8b")),(0,l.kt)("p",null,"\u8003\u8651\u5728\u6570\u636e ",(0,l.kt)("inlineCode",{parentName:"p"},"t")," \u8868:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500time\u2500\u252c\u2500number\u2500\u2510\n\u2502    1 \u2502      1 \u2502\n\u2502    2 \u2502      3 \u2502\n\u2502    3 \u2502      2 \u2502\n\u2502    4 \u2502      1 \u2502\n\u2502    5 \u2502      3 \u2502\n\u2502    6 \u2502      2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u8ba1\u7b97\u6570\u5b572\u5728\u6570\u5b571\u4e4b\u540e\u51fa\u73b0\u7684\u6b21\u6570\u4ee5\u53ca\u5b83\u4eec\u4e4b\u95f4\u7684\u4efb\u4f55\u5176\u4ed6\u6570\u5b57:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT sequenceCount('(?1).*(?2)')(time, number = 1, number = 2) FROM t\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500sequenceCount('(?1).*(?2)')(time, equals(number, 1), equals(number, 2))\u2500\u2510\n\u2502                                                                       2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53e6\u8bf7\u53c2\u9605")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#function-sequencematch"},"sequenceMatch"))),(0,l.kt)("h2",{id:"windowfunnel"},"windowFunnel"),(0,l.kt)("p",null,"\u641c\u7d22\u6ed1\u52a8\u65f6\u95f4\u7a97\u4e2d\u7684\u4e8b\u4ef6\u94fe\uff0c\u5e76\u8ba1\u7b97\u4ece\u94fe\u4e2d\u53d1\u751f\u7684\u6700\u5927\u4e8b\u4ef6\u6570\u3002"),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u91c7\u7528\u5982\u4e0b\u7b97\u6cd5\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8be5\u51fd\u6570\u641c\u7d22\u89e6\u53d1\u94fe\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6761\u4ef6\u5e76\u5c06\u4e8b\u4ef6\u8ba1\u6570\u5668\u8bbe\u7f6e\u4e3a1\u3002 \u8fd9\u662f\u6ed1\u52a8\u7a97\u53e3\u542f\u52a8\u7684\u65f6\u523b\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u6765\u81ea\u94fe\u7684\u4e8b\u4ef6\u5728\u7a97\u53e3\u5185\u987a\u5e8f\u53d1\u751f\uff0c\u5219\u8ba1\u6570\u5668\u5c06\u9012\u589e\u3002 \u5982\u679c\u4e8b\u4ef6\u5e8f\u5217\u4e2d\u65ad\uff0c\u5219\u8ba1\u6570\u5668\u4e0d\u518d\u589e\u52a0\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u6570\u636e\u5728\u4e0d\u540c\u7684\u5b8c\u6210\u70b9\u5177\u6709\u591a\u4e2a\u4e8b\u4ef6\u94fe\uff0c\u5219\u8be5\u51fd\u6570\u5c06\u4ec5\u8f93\u51fa\u6700\u957f\u94fe\u7684\u5927\u5c0f\u3002"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8bed\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"windowFunnel(window, [mode, [mode, ... ]])(timestamp, cond1, cond2, ..., condN)\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53c2\u6570")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"window")," \u2014 \u6ed1\u52a8\u7a97\u6237\u7684\u5927\u5c0f\uff0c\u8868\u793a\u4e8b\u4ef6\u94fe\u4e2d\u7b2c\u4e00\u4e2a\u4e8b\u4ef6\u548c\u6700\u540e\u4e00\u4e2a\u4e8b\u4ef6\u7684\u6700\u5927\u95f4\u9694\u3002 \u5355\u4f4d\u53d6\u51b3\u4e8e",(0,l.kt)("inlineCode",{parentName:"li"},"timestamp "),"\u3002\u7528\u8868\u8fbe\u5f0f\u6765\u8868\u793a\u5219\u662f\uff1a",(0,l.kt)("inlineCode",{parentName:"li"},"timestamp of cond1 <= timestamp of cond2 <= ... <= timestamp of condN <= timestamp of cond1 + window"),"\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"mode")," - \u8fd9\u662f\u4e00\u4e2a\u53ef\u9009\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a\u53c2\u6570\u3002",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"'strict_deduplication'")," - \u5982\u679c\u4e8b\u4ef6\u94fe\u4e2d\u51fa\u73b0\u76f8\u540c\u7684\u6761\u4ef6\uff0c\u5219\u4f1a\u505c\u6b62\u8fdb\u4e00\u6b65\u641c\u7d22\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"'strict_order'")," - \u4e0d\u5141\u8bb8\u5176\u4ed6\u4e8b\u4ef6\u7684\u4ecb\u5165\u3002 \u4f8b\u5982\uff1a\u5728",(0,l.kt)("inlineCode",{parentName:"li"},"A->B->D->C"),"\u7684\u60c5\u51b5\u4e0b\uff0c\u5b83\u5728",(0,l.kt)("inlineCode",{parentName:"li"},"D"),"\u505c\u6b62\u7ee7\u7eed\u641c\u7d22",(0,l.kt)("inlineCode",{parentName:"li"},"A->B->C"),"\uff0c\u6700\u5927\u4e8b\u4ef6\u6570\u4e3a2\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"'strict_increase'")," - \u4e8b\u4ef6\u94fe\u4e2d\u7684\u65f6\u95f4\u6233\u5fc5\u987b\u4e25\u683c\u4e0a\u5347\u3002"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"timestamp")," \u2014 \u5305\u542b\u65f6\u95f4\u6233\u7684\u5217\u3002 \u6570\u636e\u7c7b\u578b\u652f\u6301\uff1a ",(0,l.kt)("a",{parentName:"li",href:"/docs/zh/sql-reference/data-types/date"},"\u65e5\u671f"),", ",(0,l.kt)("a",{parentName:"li",href:"/docs/zh/sql-reference/data-types/datetime#data_type-datetime"},"\u65e5\u671f\u65f6\u95f4")," \u548c\u5176\u4ed6\u65e0\u7b26\u53f7\u6574\u6570\u7c7b\u578b\uff08\u8bf7\u6ce8\u610f\uff0c\u5373\u4f7f\u65f6\u95f4\u6233\u652f\u6301 ",(0,l.kt)("inlineCode",{parentName:"li"},"UInt64")," \u7c7b\u578b\uff0c\u5b83\u7684\u503c\u4e5f\u4e0d\u80fd\u8d85\u8fc7Int64\u6700\u5927\u503c\uff0c\u53732^63-1\uff09\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"cond")," \u2014 \u4e8b\u4ef6\u94fe\u7684\u7ea6\u675f\u6761\u4ef6\u3002 ",(0,l.kt)("a",{parentName:"li",href:"/docs/zh/sql-reference/data-types/int-uint"},"UInt8")," \u7c7b\u578b\u3002")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c")),(0,l.kt)("p",null,"\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u5185\u8fde\u7eed\u89e6\u53d1\u6761\u4ef6\u94fe\u7684\u6700\u5927\u6570\u76ee\u3002\n\u5bf9\u9009\u62e9\u4e2d\u7684\u6240\u6709\u94fe\u8fdb\u884c\u4e86\u5206\u6790\u3002"),(0,l.kt)("p",null,"\u7c7b\u578b: ",(0,l.kt)("inlineCode",{parentName:"p"},"Integer"),"."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u793a\u4f8b")),(0,l.kt)("p",null,"\u786e\u5b9a\u8bbe\u5b9a\u7684\u65f6\u95f4\u6bb5\u662f\u5426\u8db3\u4ee5\u8ba9\u7528\u6237\u9009\u62e9\u624b\u673a\u5e76\u5728\u5728\u7ebf\u5546\u5e97\u4e2d\u8d2d\u4e70\u4e24\u6b21\u3002"),(0,l.kt)("p",null,"\u8bbe\u7f6e\u4ee5\u4e0b\u4e8b\u4ef6\u94fe:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7528\u6237\u767b\u5f55\u5230\u5176\u5728\u5e94\u7528\u5546\u5e97\u4e2d\u7684\u5e10\u6237 (",(0,l.kt)("inlineCode",{parentName:"li"},"eventID = 1003"),")."),(0,l.kt)("li",{parentName:"ol"},"\u7528\u6237\u641c\u7d22\u624b\u673a (",(0,l.kt)("inlineCode",{parentName:"li"},"eventID = 1007, product = 'phone'"),")."),(0,l.kt)("li",{parentName:"ol"},"\u7528\u6237\u4e0b\u4e86\u8ba2\u5355 (",(0,l.kt)("inlineCode",{parentName:"li"},"eventID = 1009"),")."),(0,l.kt)("li",{parentName:"ol"},"\u7528\u6237\u518d\u6b21\u4e0b\u8ba2\u5355 (",(0,l.kt)("inlineCode",{parentName:"li"},"eventID = 1010"),").")),(0,l.kt)("p",null,"\u8f93\u5165\u8868:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500event_date\u2500\u252c\u2500user_id\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500timestamp\u2500\u252c\u2500eventID\u2500\u252c\u2500product\u2500\u2510\n\u2502 2019-01-28 \u2502       1 \u2502 2019-01-29 10:00:00 \u2502    1003 \u2502 phone   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500event_date\u2500\u252c\u2500user_id\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500timestamp\u2500\u252c\u2500eventID\u2500\u252c\u2500product\u2500\u2510\n\u2502 2019-01-31 \u2502       1 \u2502 2019-01-31 09:00:00 \u2502    1007 \u2502 phone   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500event_date\u2500\u252c\u2500user_id\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500timestamp\u2500\u252c\u2500eventID\u2500\u252c\u2500product\u2500\u2510\n\u2502 2019-01-30 \u2502       1 \u2502 2019-01-30 08:00:00 \u2502    1009 \u2502 phone   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500event_date\u2500\u252c\u2500user_id\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500timestamp\u2500\u252c\u2500eventID\u2500\u252c\u2500product\u2500\u2510\n\u2502 2019-02-01 \u2502       1 \u2502 2019-02-01 08:00:00 \u2502    1010 \u2502 phone   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u4e86\u89e3\u7528\u6237",(0,l.kt)("inlineCode",{parentName:"p"},"user_id")," \u53ef\u4ee5\u57282019\u76841-2\u6708\u671f\u95f4\u901a\u8fc7\u94fe\u6761\u591a\u8fdc\u3002"),(0,l.kt)("p",null,"\u67e5\u8be2:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    level,\n    count() AS c\nFROM\n(\n    SELECT\n        user_id,\n        windowFunnel(6048000000000000)(timestamp, eventID = 1003, eventID = 1009, eventID = 1007, eventID = 1010) AS level\n    FROM trend\n    WHERE (event_date >= '2019-01-01') AND (event_date <= '2019-02-02')\n    GROUP BY user_id\n)\nGROUP BY level\nORDER BY level ASC\n")),(0,l.kt)("p",null,"\u7ed3\u679c:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500level\u2500\u252c\u2500c\u2500\u2510\n\u2502     4 \u2502 1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2518\n")),(0,l.kt)("h2",{id:"retention"},"Retention"),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u5c06\u4e00\u7ec4\u6761\u4ef6\u4f5c\u4e3a\u53c2\u6570\uff0c\u7c7b\u578b\u4e3a1\u523032\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"UInt8")," \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u7528\u6765\u8868\u793a\u4e8b\u4ef6\u662f\u5426\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u3002\n\u4efb\u4f55\u6761\u4ef6\u90fd\u53ef\u4ee5\u6307\u5b9a\u4e3a\u53c2\u6570\uff08\u5982 ",(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/statements/select/where#select-where"},"WHERE"),")."),(0,l.kt)("p",null,"\u9664\u4e86\u7b2c\u4e00\u4e2a\u4ee5\u5916\uff0c\u6761\u4ef6\u6210\u5bf9\u9002\u7528\uff1a\u5982\u679c\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e8c\u4e2a\u662f\u771f\u7684\uff0c\u7b2c\u4e8c\u4e2a\u7ed3\u679c\u5c06\u662f\u771f\u7684\uff0c\u5982\u679c\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e09\u4e2a\u662f\u771f\u7684\uff0c\u7b2c\u4e09\u4e2a\u7ed3\u679c\u5c06\u662f\u771f\u7684\uff0c\u7b49\u7b49\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8bed\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"retention(cond1, cond2, ..., cond32);\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53c2\u6570")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"cond")," \u2014 \u8fd4\u56de ",(0,l.kt)("inlineCode",{parentName:"li"},"UInt8")," \u7ed3\u679c\uff081\u62160\uff09\u7684\u8868\u8fbe\u5f0f\u3002")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c")),(0,l.kt)("p",null,"\u6570\u7ec4\u4e3a1\u62160\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"1 \u2014 \u6761\u4ef6\u6ee1\u8db3\u3002"),(0,l.kt)("li",{parentName:"ul"},"0 \u2014 \u6761\u4ef6\u4e0d\u6ee1\u8db3\u3002")),(0,l.kt)("p",null,"\u7c7b\u578b: ",(0,l.kt)("inlineCode",{parentName:"p"},"UInt8"),"."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u793a\u4f8b")),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u8003\u8651\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"retention")," \u529f\u80fd\u7684\u4e00\u4e2a\u4f8b\u5b50 \uff0c\u4ee5\u786e\u5b9a\u7f51\u7ad9\u6d41\u91cf\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1.")," \u4e3e\u4f8b\u8bf4\u660e\uff0c\u5148\u521b\u5efa\u4e00\u5f20\u8868\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE retention_test(date Date, uid Int32) ENGINE = Memory;\n\nINSERT INTO retention_test SELECT '2020-01-01', number FROM numbers(5);\nINSERT INTO retention_test SELECT '2020-01-02', number FROM numbers(10);\nINSERT INTO retention_test SELECT '2020-01-03', number FROM numbers(15);\n")),(0,l.kt)("p",null,"\u8f93\u5165\u8868:"),(0,l.kt)("p",null,"\u67e5\u8be2:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM retention_test\n")),(0,l.kt)("p",null,"\u7ed3\u679c:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500date\u2500\u252c\u2500uid\u2500\u2510\n\u2502 2020-01-01 \u2502   0 \u2502\n\u2502 2020-01-01 \u2502   1 \u2502\n\u2502 2020-01-01 \u2502   2 \u2502\n\u2502 2020-01-01 \u2502   3 \u2502\n\u2502 2020-01-01 \u2502   4 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500date\u2500\u252c\u2500uid\u2500\u2510\n\u2502 2020-01-02 \u2502   0 \u2502\n\u2502 2020-01-02 \u2502   1 \u2502\n\u2502 2020-01-02 \u2502   2 \u2502\n\u2502 2020-01-02 \u2502   3 \u2502\n\u2502 2020-01-02 \u2502   4 \u2502\n\u2502 2020-01-02 \u2502   5 \u2502\n\u2502 2020-01-02 \u2502   6 \u2502\n\u2502 2020-01-02 \u2502   7 \u2502\n\u2502 2020-01-02 \u2502   8 \u2502\n\u2502 2020-01-02 \u2502   9 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500date\u2500\u252c\u2500uid\u2500\u2510\n\u2502 2020-01-03 \u2502   0 \u2502\n\u2502 2020-01-03 \u2502   1 \u2502\n\u2502 2020-01-03 \u2502   2 \u2502\n\u2502 2020-01-03 \u2502   3 \u2502\n\u2502 2020-01-03 \u2502   4 \u2502\n\u2502 2020-01-03 \u2502   5 \u2502\n\u2502 2020-01-03 \u2502   6 \u2502\n\u2502 2020-01-03 \u2502   7 \u2502\n\u2502 2020-01-03 \u2502   8 \u2502\n\u2502 2020-01-03 \u2502   9 \u2502\n\u2502 2020-01-03 \u2502  10 \u2502\n\u2502 2020-01-03 \u2502  11 \u2502\n\u2502 2020-01-03 \u2502  12 \u2502\n\u2502 2020-01-03 \u2502  13 \u2502\n\u2502 2020-01-03 \u2502  14 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2.")," \u6309\u552f\u4e00ID ",(0,l.kt)("inlineCode",{parentName:"p"},"uid")," \u5bf9\u7528\u6237\u8fdb\u884c\u5206\u7ec4\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"retention")," \u529f\u80fd\u3002"),(0,l.kt)("p",null,"\u67e5\u8be2:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    uid,\n    retention(date = '2020-01-01', date = '2020-01-02', date = '2020-01-03') AS r\nFROM retention_test\nWHERE date IN ('2020-01-01', '2020-01-02', '2020-01-03')\nGROUP BY uid\nORDER BY uid ASC\n")),(0,l.kt)("p",null,"\u7ed3\u679c:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500uid\u2500\u252c\u2500r\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   0 \u2502 [1,1,1] \u2502\n\u2502   1 \u2502 [1,1,1] \u2502\n\u2502   2 \u2502 [1,1,1] \u2502\n\u2502   3 \u2502 [1,1,1] \u2502\n\u2502   4 \u2502 [1,1,1] \u2502\n\u2502   5 \u2502 [0,0,0] \u2502\n\u2502   6 \u2502 [0,0,0] \u2502\n\u2502   7 \u2502 [0,0,0] \u2502\n\u2502   8 \u2502 [0,0,0] \u2502\n\u2502   9 \u2502 [0,0,0] \u2502\n\u2502  10 \u2502 [0,0,0] \u2502\n\u2502  11 \u2502 [0,0,0] \u2502\n\u2502  12 \u2502 [0,0,0] \u2502\n\u2502  13 \u2502 [0,0,0] \u2502\n\u2502  14 \u2502 [0,0,0] \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"3.")," \u8ba1\u7b97\u6bcf\u5929\u7684\u73b0\u573a\u8bbf\u95ee\u603b\u6570\u3002"),(0,l.kt)("p",null,"\u67e5\u8be2:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    sum(r[1]) AS r1,\n    sum(r[2]) AS r2,\n    sum(r[3]) AS r3\nFROM\n(\n    SELECT\n        uid,\n        retention(date = '2020-01-01', date = '2020-01-02', date = '2020-01-03') AS r\n    FROM retention_test\n    WHERE date IN ('2020-01-01', '2020-01-02', '2020-01-03')\n    GROUP BY uid\n)\n")),(0,l.kt)("p",null,"\u7ed3\u679c:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u250c\u2500r1\u2500\u252c\u2500r2\u2500\u252c\u2500r3\u2500\u2510\n\u2502  5 \u2502  5 \u2502  5 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2518\n")),(0,l.kt)("p",null,"\u6761\u4ef6:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"r1"),"-2020-01-01\u671f\u95f4\u8bbf\u95ee\u8be5\u7f51\u7ad9\u7684\u72ec\u7acb\u8bbf\u95ee\u8005\u6570\u91cf\uff08 ",(0,l.kt)("inlineCode",{parentName:"li"},"cond1")," \u6761\u4ef6\uff09\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"r2"),"-\u57282020-01-01\u548c2020-01-02\u4e4b\u95f4\u7684\u7279\u5b9a\u65f6\u95f4\u6bb5\u5185\u8bbf\u95ee\u8be5\u7f51\u7ad9\u7684\u552f\u4e00\u8bbf\u95ee\u8005\u7684\u6570\u91cf (",(0,l.kt)("inlineCode",{parentName:"li"},"cond1")," \u548c ",(0,l.kt)("inlineCode",{parentName:"li"},"cond2")," \u6761\u4ef6\uff09\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"r3"),"-\u57282020-01-01\u548c2020-01-03\u4e4b\u95f4\u7684\u7279\u5b9a\u65f6\u95f4\u6bb5\u5185\u8bbf\u95ee\u8be5\u7f51\u7ad9\u7684\u552f\u4e00\u8bbf\u95ee\u8005\u7684\u6570\u91cf (",(0,l.kt)("inlineCode",{parentName:"li"},"cond1")," \u548c ",(0,l.kt)("inlineCode",{parentName:"li"},"cond3")," \u6761\u4ef6\uff09\u3002")),(0,l.kt)("h2",{id:"uniquptonx"},"uniqUpTo(N)(x)"),(0,l.kt)("p",null,"\u8ba1\u7b97\u5c0f\u4e8e\u6216\u8005\u7b49\u4e8eN\u7684\u4e0d\u540c\u53c2\u6570\u7684\u4e2a\u6570\u3002\u5982\u679c\u7ed3\u679c\u5927\u4e8eN\uff0c\u90a3\u8fd4\u56deN+1\u3002"),(0,l.kt)("p",null,"\u5efa\u8bae\u4f7f\u7528\u8f83\u5c0f\u7684Ns\uff0c\u6bd4\u5982\uff1a10\u3002N\u7684\u6700\u5927\u503c\u4e3a100\u3002"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u805a\u5408\u51fd\u6570\u7684\u72b6\u6001\uff0c\u5b83\u4f7f\u7528\u7684\u5185\u5b58\u91cf\u7b49\u4e8e1+N","*","\u4e00\u4e2a\u5b57\u8282\u503c\u7684\u5927\u5c0f\u3002\n\u5bf9\u4e8e\u5b57\u7b26\u4e32\uff0c\u5b83\u5b58\u50a88\u4e2a\u5b57\u8282\u7684\u975e\u52a0\u5bc6\u54c8\u5e0c\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u8ba1\u7b97\u662f\u8fd1\u4f3c\u7684\u5b57\u7b26\u4e32\u3002"),(0,l.kt)("p",null,"\u8be5\u51fd\u6570\u4e5f\u9002\u7528\u4e8e\u591a\u4e2a\u53c2\u6570\u3002"),(0,l.kt)("p",null,"\u5b83\u7684\u5de5\u4f5c\u901f\u5ea6\u5c3d\u53ef\u80fd\u5feb\uff0c\u9664\u4e86\u4f7f\u7528\u8f83\u5927\u7684N\u503c\u5e76\u4e14\u552f\u4e00\u503c\u7684\u6570\u91cf\u7565\u5c0f\u4e8eN\u7684\u60c5\u51b5\u3002"),(0,l.kt)("p",null,"\u7528\u6cd5\u793a\u4f8b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u95ee\u9898\uff1a\u4ea7\u51fa\u4e00\u4e2a\u4e0d\u5c11\u4e8e\u4e94\u4e2a\u552f\u4e00\u7528\u6237\u7684\u5173\u952e\u5b57\u62a5\u544a\n\u89e3\u51b3\u65b9\u6848\uff1a \u5199group by\u67e5\u8be2\u8bed\u53e5 HAVING uniqUpTo(4)(UserID) >= 5\n")),(0,l.kt)("h2",{id:"summapfilteredkeys-to-keepkeys-values"},"sumMapFiltered(keys_to_keep)(keys, values)"),(0,l.kt)("p",null,"\u548c ",(0,l.kt)("a",{parentName:"p",href:"/docs/zh/sql-reference/aggregate-functions/reference/summap#agg_functions-summap"},"sumMap")," \u57fa\u672c\u4e00\u81f4\uff0c \u9664\u4e86\u4e00\u4e2a\u952e\u6570\u7ec4\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\u8fd9\u5728\u4f7f\u7528\u9ad8\u57fa\u6570key\u65f6\u5c24\u5176\u6709\u7528\u3002"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/query_language/agg_functions/parametric_functions/"},"\u539f\u59cb\u6587\u7ae0")," "))}c.isMDXComponent=!0}}]);