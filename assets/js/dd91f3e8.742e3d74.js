"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[48712],{3905:function(t,e,r){r.d(e,{Zo:function(){return u},kt:function(){return g}});var a=r(67294);function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function i(t,e){if(null==t)return{};var r,a,n=function(t,e){if(null==t)return{};var r,a,n={},o=Object.keys(t);for(a=0;a<o.length;a++)r=o[a],e.indexOf(r)>=0||(n[r]=t[r]);return n}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)r=o[a],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}var p=a.createContext({}),s=function(t){var e=a.useContext(p),r=e;return t&&(r="function"==typeof t?t(e):l(l({},e),t)),r},u=function(t){var e=s(t.components);return a.createElement(p.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},c=a.forwardRef((function(t,e){var r=t.components,n=t.mdxType,o=t.originalType,p=t.parentName,u=i(t,["components","mdxType","originalType","parentName"]),c=s(r),g=n,m=c["".concat(p,".").concat(g)]||c[g]||d[g]||o;return r?a.createElement(m,l(l({ref:e},u),{},{components:r})):a.createElement(m,l({ref:e},u))}));function g(t,e){var r=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var o=r.length,l=new Array(o);l[0]=c;var i={};for(var p in e)hasOwnProperty.call(e,p)&&(i[p]=e[p]);i.originalType=t,i.mdxType="string"==typeof t?t:n,l[1]=i;for(var s=2;s<o;s++)l[s]=r[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},96965:function(t,e,r){r.r(e),r.d(e,{assets:function(){return u},contentTitle:function(){return p},default:function(){return g},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return d}});var a=r(87462),n=r(63366),o=(r(67294),r(3905)),l=["components"],i={sidebar_label:"Relying on Structure",sidebar_position:2,description:"Using a structured approach"},p="Structured Approach",s={unversionedId:"en/guides/developer/working-with-json/json-structured",id:"en/guides/developer/working-with-json/json-structured",title:"Structured Approach",description:"Using a structured approach",source:"@site/docs/en/guides/developer/working-with-json/json-structured.md",sourceDirName:"en/guides/developer/working-with-json",slug:"/en/guides/developer/working-with-json/json-structured",permalink:"/docs/en/guides/developer/working-with-json/json-structured",editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/guides/developer/working-with-json/json-structured.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_label:"Relying on Structure",sidebar_position:2,description:"Using a structured approach"},sidebar:"english",previous:{title:"Introduction",permalink:"/docs/en/guides/developer/working-with-json/json-intro"},next:{title:"Semi-Structured Approach",permalink:"/docs/en/guides/developer/working-with-json/json-semi-structured"}},u={},d=[],c={toc:d};function g(t){var e=t.components,r=(0,n.Z)(t,l);return(0,o.kt)("wrapper",(0,a.Z)({},c,r,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"structured-approach"},"Structured Approach"),(0,o.kt)("p",null,"First, we confirm we can read the JSON dataset and highlight the challenges of handling semi-structured data using more traditional types used in other databases. We don\u2019t rely on Schema inference to map the JSON fields to columns in the example below - instead, we specify a format of JSONEachRow and map the fields explicitly to columns in the s3 functions. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT type, `actor.display_login`, `repo.name`, created_at\nFROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/github/github-2022-flat.ndjson.gz',\n        'JSONEachRow',\n        'type String, `actor.avatar_url` String, `actor.display_login` String, ' ||\n        '`actor.id` Float64, `actor.login` String, `actor.url` String, `repo.id` Float64, ' ||\n        '`repo.name` String, `repo.url` String, created_at String, `payload.pull_request.updated_at` String, ' ||\n        '`payload.action` String, `payload.ref` String, `payload.ref_type` String, ' ||\n        '`payload.pull_request.user.login` String, `payload.pull_request.number` Float64, ' ||\n        '`payload.pull_request.title` String, `payload.pull_request.state` String, ' ||\n        '`payload.pull_request.author_association` String, `payload.pull_request.head.ref` String, ' ||\n        '`payload.pull_request.head.sha` String, `payload.pull_request.base.ref` String, ' ||\n        '`payload.pull_request.base.sha` String, `payload.size` Float64, `payload.distinct_size` Float64')\nLIMIT 10;\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"type"),(0,o.kt)("th",{parentName:"tr",align:"left"},"actor.display","_","login"),(0,o.kt)("th",{parentName:"tr",align:"left"},"repo.name"),(0,o.kt)("th",{parentName:"tr",align:"left"},"created","_","at"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PushEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Lakshmipatil2021"),(0,o.kt)("td",{parentName:"tr",align:"left"},"revacprogramming/pps-test1-Lakshmipatil2021"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"MemberEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"KStevenT"),(0,o.kt)("td",{parentName:"tr",align:"left"},"KStevenT/HTML","_","ExternalWorkshop"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PushEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Soumojit28"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Soumojit28/Oxytocin"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PushEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"github-actions"),(0,o.kt)("td",{parentName:"tr",align:"left"},"diogoaraujo017/diogoaraujo017"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PushEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Aman-Sonwani"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Aman-Sonwani/crwn-clothing"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PushEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"huangshanyoumumingwutong"),(0,o.kt)("td",{parentName:"tr",align:"left"},"huangshanyoumumingwutong/picgo"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PullRequestEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"rfprod"),(0,o.kt)("td",{parentName:"tr",align:"left"},"rfprod/nx-ng-starter"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PushEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Helikopter-Bojowy"),(0,o.kt)("td",{parentName:"tr",align:"left"},"Helikopter-Bojowy/Exp-na-helikopterze"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"IssueCommentEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"PRMerger-test-1"),(0,o.kt)("td",{parentName:"tr",align:"left"},"MicrosoftDocs/CSIDev-Public"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"PushEvent"),(0,o.kt)("td",{parentName:"tr",align:"left"},"github-actions"),(0,o.kt)("td",{parentName:"tr",align:"left"},"pioug/yield-data"),(0,o.kt)("td",{parentName:"tr",align:"left"},"2022-01-04T07:00:00Z")))),(0,o.kt)("p",null,"Note this dataset is a subset of the example used later, with no nested objects within the JSON itself - the fields have been flattened using a period separator. Although nested objects can be handled through an explicit mapping, it requires either the use of the new JSON object field or (for older ClickHouse versions) Tuples, Map and Nested structures (see ",(0,o.kt)("a",{parentName:"p",href:"./json-other-approaches"},"Other Approaches"),") further complicate usage. "),(0,o.kt)("p",null,"This approach requires mapping all fields and has obvious limitations when the JSON is potentially dynamic or unknown. We could use an INSERT INTO SELECT statement to persist the results into a local Merge Tree table. Defining such a table would require the user to know all fields and express the verbose definition below. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE table github_flat\n(\n   type                                      String,\n   `actor.avatar_url`                        String,\n   `actor.display_login`                     String,\n   `actor.id`                                Float64,\n   `actor.login`                             String,\n   `actor.url`                               String,\n   `repo.id`                                 Float64,\n   `repo.name`                               String,\n   `repo.url`                                String,\n   created_at                                String,\n   `payload.pull_request.updated_at`         String,\n   `payload.action`                          String,\n   `payload.ref`                             String,\n   `payload.ref_type`                        String,\n   `payload.pull_request.user.login`         String,\n   `payload.pull_request.number`             Float64,\n   `payload.pull_request.title`              String,\n   `payload.pull_request.state`              String,\n   `payload.pull_request.author_association` String,\n   `payload.pull_request.head.ref`           String,\n   `payload.pull_request.head.sha`           String,\n   `payload.pull_request.base.ref`           String,\n   `payload.pull_request.base.sha`           String,\n   `payload.size`                            Float64,\n   `payload.distinct_size`                   Float64\n) ENGINE = MergeTree ORDER BY (type, `repo.name`, created_at);\n\nINSERT INTO github_flat SELECT * FROM s3 ('https://datasets-documentation.s3.eu-west-3.amazonaws.com/github/github-2022-flat.ndjson.gz', 'JSONEachRow');\n\nSELECT count() from github_flat;\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"left"},"count","(",")"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"left"},"1000000")))),(0,o.kt)("p",null,"Furthermore, if new properties are added to the JSON, the table would need to be updated, i.e., via ALTER TABLE. Naturally, this leads us to use ClickHouse\u2019s semi-structured features."))}g.isMDXComponent=!0}}]);