"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[52197],{3905:function(t,e,l){l.d(e,{Zo:function(){return k},kt:function(){return h}});var n=l(67294);function a(t,e,l){return e in t?Object.defineProperty(t,e,{value:l,enumerable:!0,configurable:!0,writable:!0}):t[e]=l,t}function o(t,e){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.push.apply(l,n)}return l}function s(t){for(var e=1;e<arguments.length;e++){var l=null!=arguments[e]?arguments[e]:{};e%2?o(Object(l),!0).forEach((function(e){a(t,e,l[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):o(Object(l)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(l,e))}))}return t}function r(t,e){if(null==t)return{};var l,n,a=function(t,e){if(null==t)return{};var l,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)l=o[n],e.indexOf(l)>=0||(a[l]=t[l]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)l=o[n],e.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(t,l)&&(a[l]=t[l])}return a}var c=n.createContext({}),i=function(t){var e=n.useContext(c),l=e;return t&&(l="function"==typeof t?t(e):s(s({},e),t)),l},k=function(t){var e=i(t.components);return n.createElement(c.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},d=n.forwardRef((function(t,e){var l=t.components,a=t.mdxType,o=t.originalType,c=t.parentName,k=r(t,["components","mdxType","originalType","parentName"]),d=i(l),h=a,p=d["".concat(c,".").concat(h)]||d[h]||u[h]||o;return l?n.createElement(p,s(s({ref:e},k),{},{components:l})):n.createElement(p,s({ref:e},k))}));function h(t,e){var l=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var o=l.length,s=new Array(o);s[0]=d;var r={};for(var c in e)hasOwnProperty.call(e,c)&&(r[c]=e[c]);r.originalType=t,r.mdxType="string"==typeof t?t:a,s[1]=r;for(var i=2;i<o;i++)s[i]=l[i];return n.createElement.apply(null,s)}return n.createElement.apply(null,l)}d.displayName="MDXCreateElement"},37542:function(t,e,l){l.r(e),l.d(e,{assets:function(){return k},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return r},metadata:function(){return i},toc:function(){return u}});var n=l(87462),a=l(63366),o=(l(67294),l(3905)),s=["components"],r={sidebar_position:69,sidebar_label:"CMake in ClickHouse",description:"How to make ClickHouse compile and link faster"},c="CMake in ClickHouse",i={unversionedId:"en/development/cmake-in-clickhouse",id:"en/development/cmake-in-clickhouse",title:"CMake in ClickHouse",description:"How to make ClickHouse compile and link faster",source:"@site/docs/en/development/cmake-in-clickhouse.md",sourceDirName:"en/development",slug:"/en/development/cmake-in-clickhouse",permalink:"/docs/en/development/cmake-in-clickhouse",editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/en/development/cmake-in-clickhouse.md",tags:[],version:"current",sidebarPosition:69,frontMatter:{sidebar_position:69,sidebar_label:"CMake in ClickHouse",description:"How to make ClickHouse compile and link faster"},sidebar:"english",previous:{title:"Build on Linux for RISC-V 64",permalink:"/docs/en/development/build-cross-riscv"},next:{title:"C++ Guide",permalink:"/docs/en/development/style"}},k={},u=[{value:"CMake files types",id:"cmake-files-types",level:2},{value:"List of CMake flags",id:"list-of-cmake-flags",level:2},{value:"ClickHouse modes",id:"clickhouse-modes",level:2},{value:"External libraries",id:"external-libraries",level:2},{value:"Other flags",id:"other-flags",level:2},{value:"Developer&#39;s guide for adding new CMake options",id:"developers-guide-for-adding-new-cmake-options",level:2},{value:"Don&#39;t be obvious. Be informative.",id:"dont-be-obvious-be-informative",level:4},{value:"If the option&#39;s state could produce unwanted (or unusual) result, explicitly warn the user.",id:"if-the-options-state-could-produce-unwanted-or-unusual-result-explicitly-warn-the-user",level:4},{value:"In the option&#39;s description, explain WHAT the option does rather than WHY it does something.",id:"in-the-options-description-explain-what-the-option-does-rather-than-why-it-does-something",level:4},{value:"Don&#39;t assume other developers know as much as you do.",id:"dont-assume-other-developers-know-as-much-as-you-do",level:4},{value:"Prefer consistent default values.",id:"prefer-consistent-default-values",level:4}],d={toc:u};function h(t){var e=t.components,l=(0,a.Z)(t,s);return(0,o.kt)("wrapper",(0,n.Z)({},d,l,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"cmake-in-clickhouse"},"CMake in ClickHouse"),(0,o.kt)("p",null,"How to make ClickHouse compile and link faster. Minimal ClickHouse build example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cmake .. \\\n    -DCMAKE_C_COMPILER=$(which clang-13) \\\n    -DCMAKE_CXX_COMPILER=$(which clang++-13) \\\n    -DCMAKE_BUILD_TYPE=Debug \\\n    -DENABLE_CLICKHOUSE_ALL=OFF \\\n    -DENABLE_CLICKHOUSE_SERVER=ON \\\n    -DENABLE_CLICKHOUSE_CLIENT=ON \\\n    -DENABLE_LIBRARIES=OFF \\\n    -DUSE_UNWIND=ON \\\n    -DENABLE_UTILS=OFF \\\n    -DENABLE_TESTS=OFF\n")),(0,o.kt)("h2",{id:"cmake-files-types"},"CMake files types"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"ClickHouse's source CMake files (located in the root directory and in /src)."),(0,o.kt)("li",{parentName:"ol"},"Arch-dependent CMake files (located in /cmake/",(0,o.kt)("em",{parentName:"li"},"os_name"),")."),(0,o.kt)("li",{parentName:"ol"},"Libraries finders (search for contrib libraries, located in /contrib/*/CMakeLists.txt)."),(0,o.kt)("li",{parentName:"ol"},"Contrib build CMake files (used instead of libraries' own CMake files, located in /cmake/modules)")),(0,o.kt)("h2",{id:"list-of-cmake-flags"},"List of CMake flags"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The flag name is a link to its position in the code."),(0,o.kt)("li",{parentName:"ul"},"If an option's default value is itself an option, it's also a link to its position in this list.")),(0,o.kt)("h2",{id:"clickhouse-modes"},"ClickHouse modes"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Name"),(0,o.kt)("th",null,"Default value"),(0,o.kt)("th",null,"Description"),(0,o.kt)("th",null,"Comment"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-all"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L10",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Enable all ClickHouse modes by default"),(0,o.kt)("td",null,"The ",(0,o.kt)("code",{class:"syntax"},"clickhouse")," binary is a multi purpose tool that contains multiple execution modes (client, server, etc.), each of them may be built and linked as a separate library. If you do not know what modes you need, turn this option OFF and enable SERVER and CLIENT only.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-benchmark"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L20",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_BENCHMARK"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Queries benchmarking mode"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://clickhouse.com/docs/en/operations/utilities/clickhouse-benchmark/",target:"_blank"},"https://clickhouse.com/docs/en/operations/utilities/clickhouse-benchmark/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-client"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L13",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_CLIENT"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Client mode (interactive tui/shell that connects to the server)"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-compressor"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L25",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_COMPRESSOR"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Data compressor and decompressor"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://clickhouse.com/docs/en/operations/utilities/clickhouse-compressor/",target:"_blank"},"https://clickhouse.com/docs/en/operations/utilities/clickhouse-compressor/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-copier"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L28",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_COPIER"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Inter-cluster data copying mode"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/",target:"_blank"},"https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-extract-from-config"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L22",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_EXTRACT_FROM_CONFIG"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Configs processor (extract values etc.)"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-format"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L30",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_FORMAT"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Queries pretty-printer and formatter with syntax highlighting"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-git-import"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L50",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_GIT_IMPORT"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"A tool to analyze Git repositories"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://presentations.clickhouse.com/matemarketing_2020/",target:"_blank"},"https://presentations.clickhouse.com/matemarketing_2020/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-install"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L67",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_INSTALL"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Install ClickHouse without .deb/.rpm/.tgz packages (having the binary only)"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-keeper"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L54",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_KEEPER"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"ClickHouse alternative to ZooKeeper"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-keeper-converter"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L56",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_KEEPER_CONVERTER"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Util allows to convert ZooKeeper logs and snapshots into clickhouse-keeper snapshot"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-library-bridge"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L46",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_LIBRARY_BRIDGE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"HTTP-server working like a proxy to Library dictionary source"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-local"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L17",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_LOCAL"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Local files fast processing mode"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://clickhouse.com/docs/en/operations/utilities/clickhouse-local/",target:"_blank"},"https://clickhouse.com/docs/en/operations/utilities/clickhouse-local/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-obfuscator"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L34",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_OBFUSCATOR"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Table data obfuscator (convert real data to benchmark-ready one)"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://clickhouse.com/docs/en/operations/utilities/clickhouse-obfuscator/",target:"_blank"},"https://clickhouse.com/docs/en/operations/utilities/clickhouse-obfuscator/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-odbc-bridge"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L40",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ODBC_BRIDGE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"HTTP-server working like a proxy to ODBC driver"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-server"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L12",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_SERVER"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"Server mode (main mode)"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clickhouse-static-files-disk-uploader"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/programs/CMakeLists.txt#L52",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_STATIC_FILES_DISK_UPLOADER"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CLICKHOUSE_ALL")),(0,o.kt)("td",null,"A tool to export table data files to be later put to a static files web server"),(0,o.kt)("td",null)))),(0,o.kt)("h2",{id:"external-libraries"},"External libraries"),(0,o.kt)("p",null,"Note that ClickHouse uses forks of these libraries, see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse-Extras"},"https://github.com/ClickHouse-Extras"),"."),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Name"),(0,o.kt)("th",null,"Default value"),(0,o.kt)("th",null,"Description"),(0,o.kt)("th",null,"Comment"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-avx"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L19",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_AVX"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"0")),(0,o.kt)("td",null,"Use AVX instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-avx"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L20",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_AVX2"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"0")),(0,o.kt)("td",null,"Use AVX2 instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-avx-for-spec-op"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L23",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_AVX2_FOR_SPEC_OP"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"0")),(0,o.kt)("td",null,"Use avx2 instructions for specific operations on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-avx"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L21",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_AVX512"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"0")),(0,o.kt)("td",null,"Use AVX512 instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-avx-for-spec-op"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L24",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_AVX512_FOR_SPEC_OP"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"0")),(0,o.kt)("td",null,"Use avx512 instructions for specific operations on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-bmi"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L22",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_BMI"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"0")),(0,o.kt)("td",null,"Use BMI instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-ccache"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/ccache.cmake#L22",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CCACHE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_CCACHE_BY_DEFAULT")),(0,o.kt)("td",null,"Speedup re-compilations using ccache (external tool)"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://ccache.dev/",target:"_blank"},"https://ccache.dev/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-clang-tidy"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/clang_tidy.cmake#L2",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CLANG_TIDY"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Use clang-tidy static analyzer"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://clang.llvm.org/extra/clang-tidy/",target:"_blank"},"https://clang.llvm.org/extra/clang-tidy/"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-pclmulqdq"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L17",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_PCLMULQDQ"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"1")),(0,o.kt)("td",null,"Use pclmulqdq instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-popcnt"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L18",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_POPCNT"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"1")),(0,o.kt)("td",null,"Use popcnt instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-sse"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L15",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_SSE41"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"1")),(0,o.kt)("td",null,"Use SSE4.1 instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-sse"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L16",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_SSE42"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"1")),(0,o.kt)("td",null,"Use SSE4.2 instructions on x86_64"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-ssse"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L14",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_SSSE3"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"1")),(0,o.kt)("td",null,"Use SSSE3 instructions on x86_64"),(0,o.kt)("td",null)))),(0,o.kt)("h2",{id:"other-flags"},"Other flags"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Name"),(0,o.kt)("th",null,"Default value"),(0,o.kt)("th",null,"Description"),(0,o.kt)("th",null,"Comment"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"add-gdb-index-for-gold"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L226",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ADD_GDB_INDEX_FOR_GOLD"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Add .gdb-index to resulting binaries for gold linker."),(0,o.kt)("td",null,"Ignored if ",(0,o.kt)("code",{class:"syntax"},"lld")," is used")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"arch-native"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/cpu_features.cmake#L26",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ARCH_NATIVE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"0")),(0,o.kt)("td",null,"Add -march=native compiler flag. This makes your binaries non-portable but more performant code may be generated. This option overrides ENABLE_* options for specific instruction set. Highly not recommended to use."),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"build-standalone-keeper"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L253",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"BUILD_STANDALONE_KEEPER"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Build keeper as small standalone binary"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"clickhouse-split-binary"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L113",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"CLICKHOUSE_SPLIT_BINARY"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Make several binaries (clickhouse-server, clickhouse-client etc.) instead of one bundled"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"compiler-pipe"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L281",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"COMPILER_PIPE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"-pipe compiler option"),(0,o.kt)("td",null,"Less ",(0,o.kt)("code",{class:"syntax"},"/tmp")," usage, more RAM usage.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-build-path-mapping"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L299",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_BUILD_PATH_MAPPING"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Enable remap file source paths in debug info, predefined preprocessor macros and __builtin_FILE(). It's to generate reproducible builds. See ",(0,o.kt)("a",{href:"https://reproducible-builds.org/docs/build-path",target:"_blank"},"https://reproducible-builds.org/docs/build-path")),(0,o.kt)("td",null,"Reproducible builds If turned ",(0,o.kt)("code",{class:"syntax"},"ON"),", remap file source paths in debug info, predefined preprocessor macros and __builtin_FILE().")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-check-heavy-builds"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L81",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_CHECK_HEAVY_BUILDS"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Don't allow C++ translation units to compile too long or to take too much memory while compiling."),(0,o.kt)("td",null,"Take care to add prlimit in command line before ccache, or else ccache thinks that prlimit is compiler, and clang++ is its input file, and refuses to work  with multiple inputs, e.g in ccache log: [2021-03-31T18:06:32.655327 36900] Command line: /usr/bin/ccache prlimit --as=10000000000 --data=5000000000 --cpu=600 /usr/bin/clang++-11 - ...... std=gnu++2a -MD -MT src/CMakeFiles/dbms.dir/Storages/MergeTree/IMergeTreeDataPart.cpp.o -MF src/CMakeFiles/dbms.dir/Storages/MergeTree/IMergeTreeDataPart.cpp.o.d -o src/CMakeFiles/dbms.dir/Storages/MergeTree/IMergeTreeDataPart.cpp.o -c ../src/Storages/MergeTree/IMergeTreeDataPart.cpp  [2021-03-31T18:06:32.656704 36900] Multiple input files: /usr/bin/clang++-11 and ../src/Storages/MergeTree/IMergeTreeDataPart.cpp  Another way would be to use --ccache-skip option before clang++-11 to make ccache ignore it.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-examples"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L201",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_EXAMPLES"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Build all example programs in 'examples' subdirectories"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-fuzzing"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L129",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_FUZZING"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Fuzzy testing using libfuzzer"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-libraries"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L413",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_LIBRARIES"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Enable all external libraries by default"),(0,o.kt)("td",null,"Turns on all external libs like s3, kafka, ODBC, ...")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-multitarget-code"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/src/Functions/CMakeLists.txt#L102",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_MULTITARGET_CODE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Enable platform-dependent code"),(0,o.kt)("td",null,"ClickHouse developers may use platform-dependent code under some macro (e.g. ",(0,o.kt)("code",{class:"syntax"},"ifdef ENABLE_MULTITARGET"),"). If turned ON, this option defines such macro. See ",(0,o.kt)("code",{class:"syntax"},"src/Functions/TargetSpecific.h"))),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-tests"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L200",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_TESTS"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Provide unit_test_dbms target with Google.Test unit tests"),(0,o.kt)("td",null,"If turned ",(0,o.kt)("code",{class:"syntax"},"ON"),", assumes the user has either the system GTest library or the bundled one.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"enable-thinlto"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L386",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"ENABLE_THINLTO"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Clang-specific link time optimization"),(0,o.kt)("td",null,(0,o.kt)("a",{href:"https://clang.llvm.org/docs/ThinLTO.html",target:"_blank"},"https://clang.llvm.org/docs/ThinLTO.html")," Applies to clang only. Disabled when building with tests or sanitizers.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"fail-on-unsupported-options-combination"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L32",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"FAIL_ON_UNSUPPORTED_OPTIONS_COMBINATION"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Stop/Fail CMake configuration if some ENABLE_XXX option is defined (either ON or OFF)   but is not possible to satisfy"),(0,o.kt)("td",null,"If turned off: e.g. when ENABLE_FOO is ON, but FOO tool was not found, the CMake will continue.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"glibc-compatibility"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L205",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"GLIBC_COMPATIBILITY"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Enable compatibility with older glibc libraries."),(0,o.kt)("td",null,"Only for Linux, x86_64 or aarch64.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"install-stripped-binaries"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L270",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"INSTALL_STRIPPED_BINARIES"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Build stripped binaries with debug info in separate directory"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"linker-name"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/tools.cmake#L58",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"LINKER_NAME"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Linker name or full path"),(0,o.kt)("td",null,"Example values: ",(0,o.kt)("code",{class:"syntax"},"lld-10"),", ",(0,o.kt)("code",{class:"syntax"},"gold"),".")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"parallel-compile-jobs"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/limit_jobs.cmake#L10",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"PARALLEL_COMPILE_JOBS"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},'""')),(0,o.kt)("td",null,"Maximum number of concurrent compilation jobs"),(0,o.kt)("td",null,"1 if not set")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"parallel-link-jobs"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/limit_jobs.cmake#L13",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"PARALLEL_LINK_JOBS"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},'""')),(0,o.kt)("td",null,"Maximum number of concurrent link jobs"),(0,o.kt)("td",null,"1 if not set")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"sanitize"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/sanitize.cmake#L7",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"SANITIZE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},'""')),(0,o.kt)("td",null,"Enable one of the code sanitizers"),(0,o.kt)("td",null,"Possible values: - ",(0,o.kt)("code",{class:"syntax"},"address")," (ASan) - ",(0,o.kt)("code",{class:"syntax"},"memory")," (MSan) - ",(0,o.kt)("code",{class:"syntax"},"thread")," (TSan) - ",(0,o.kt)("code",{class:"syntax"},"undefined"),' (UBSan) - "" (no sanitizing)')),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"split-shared-libraries"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L111",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"SPLIT_SHARED_LIBRARIES"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Keep all internal libraries as separate .so files"),(0,o.kt)("td",null,"DEVELOPER ONLY. Faster linking if turned on.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"strip-debug-symbols-functions"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/src/Functions/CMakeLists.txt#L48",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"STRIP_DEBUG_SYMBOLS_FUNCTIONS"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"STRIP_DSF_DEFAULT")),(0,o.kt)("td",null,"Do not generate debugger info for ClickHouse functions"),(0,o.kt)("td",null,'Provides faster linking and lower binary size. Tradeoff is the inability to debug some source files with e.g. gdb (empty stack frames and no local variables)."')),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"use-debug-helpers"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L252",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"USE_DEBUG_HELPERS"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"USE_DEBUG_HELPERS")),(0,o.kt)("td",null,"Enable debug helpers"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"use-static-libraries"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L106",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"USE_STATIC_LIBRARIES"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Disable to use shared libraries"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"use-unwind"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/unwind.cmake#L1",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"USE_UNWIND"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ENABLE_LIBRARIES")),(0,o.kt)("td",null,"Enable libunwind (better stacktraces)"),(0,o.kt)("td",null)),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"werror"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L417",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"WERROR"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Enable -Werror compiler option"),(0,o.kt)("td",null,"Using system libs can cause a lot of warnings in includes (on macro expansion).")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"weverything"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/cmake/warnings.cmake#L15",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"WEVERYTHING"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"ON")),(0,o.kt)("td",null,"Enable -Weverything option with some exceptions."),(0,o.kt)("td",null,"Add some warnings that are not available even with -Wall -Wextra -Wpedantic. Intended for exploration of new compiler warnings that may be found useful. Applies to clang only")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("a",{name:"with-coverage"}),(0,o.kt)("a",{href:"https://github.com/clickhouse/clickhouse/blob/master/CMakeLists.txt#L344",rel:"external nofollow noreferrer",target:"_blank"},(0,o.kt)("code",{class:"syntax"},"WITH_COVERAGE"))),(0,o.kt)("td",null,(0,o.kt)("code",{class:"syntax"},"OFF")),(0,o.kt)("td",null,"Profile the resulting binary/binaries"),(0,o.kt)("td",null,"Compiler-specific coverage flags e.g. -fcoverage-mapping for gcc")))),(0,o.kt)("h2",{id:"developers-guide-for-adding-new-cmake-options"},"Developer's guide for adding new CMake options"),(0,o.kt)("h4",{id:"dont-be-obvious-be-informative"},"Don't be obvious. Be informative."),(0,o.kt)("p",null,"Bad:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'option (ENABLE_TESTS "Enables testing" OFF)\n')),(0,o.kt)("p",null,"This description is quite useless as it neither gives the viewer any additional information nor explains the option purpose."),(0,o.kt)("p",null,"Better:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'option(ENABLE_TESTS "Provide unit_test_dbms target with Google.test unit tests" OFF)\n')),(0,o.kt)("p",null,"If the option's purpose can't be guessed by its name, or the purpose guess may be misleading, or option has some\npre-conditions, leave a comment above the option() line and explain what it does.\nThe best way would be linking the docs page (if it exists).\nThe comment is parsed into a separate column (see below)."),(0,o.kt)("p",null,"Even better:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# implies ${TESTS_ARE_ENABLED}\n# see tests/CMakeLists.txt for implementation detail.\noption(ENABLE_TESTS "Provide unit_test_dbms target with Google.test unit tests" OFF)\n')),(0,o.kt)("h4",{id:"if-the-options-state-could-produce-unwanted-or-unusual-result-explicitly-warn-the-user"},"If the option's state could produce unwanted (or unusual) result, explicitly warn the user."),(0,o.kt)("p",null,"Suppose you have an option that may strip debug symbols from the ClickHouse's part.\nThis can speed up the linking process, but produces a binary that cannot be debugged.\nIn that case, prefer explicitly raising a warning telling the developer that he may be doing something wrong.\nAlso, such options should be disabled if applies."),(0,o.kt)("p",null,"Bad:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'option(STRIP_DEBUG_SYMBOLS_FUNCTIONS\n    "Do not generate debugger info for ClickHouse functions.\n    ${STRIP_DSF_DEFAULT})\n\nif (STRIP_DEBUG_SYMBOLS_FUNCTIONS)\n    target_compile_options(clickhouse_functions PRIVATE "-g0")\nendif()\n')),(0,o.kt)("p",null,"Better:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# Provides faster linking and lower binary size.\n# Tradeoff is the inability to debug some source files with e.g. gdb\n# (empty stack frames and no local variables)."\noption(STRIP_DEBUG_SYMBOLS_FUNCTIONS\n    "Do not generate debugger info for ClickHouse functions."\n    ${STRIP_DSF_DEFAULT})\n\nif (STRIP_DEBUG_SYMBOLS_FUNCTIONS)\n    message(WARNING "Not generating debugger info for ClickHouse functions")\n    target_compile_options(clickhouse_functions PRIVATE "-g0")\nendif()\n')),(0,o.kt)("h4",{id:"in-the-options-description-explain-what-the-option-does-rather-than-why-it-does-something"},"In the option's description, explain WHAT the option does rather than WHY it does something."),(0,o.kt)("p",null,"The WHY explanation should be placed in the comment. You may find that the option's name is self-descriptive."),(0,o.kt)("p",null,"Bad:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'option(ENABLE_THINLTO "Enable Thin LTO. Only applicable for clang. It\'s also suppressed when building with tests or sanitizers." ON)\n')),(0,o.kt)("p",null,"Better:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# Only applicable for clang.\n# Turned off when building with tests or sanitizers.\noption(ENABLE_THINLTO "Clang-specific link time optimisation" ON).\n')),(0,o.kt)("h4",{id:"dont-assume-other-developers-know-as-much-as-you-do"},"Don't assume other developers know as much as you do."),(0,o.kt)("p",null,"In ClickHouse, there are many tools used that an ordinary developer may not know. If you are in doubt, give a link to\nthe tool's docs. It won't take much of your time."),(0,o.kt)("p",null,"Bad:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'option(ENABLE_THINLTO "Enable Thin LTO. Only applicable for clang. It\'s also suppressed when building with tests or sanitizers." ON)\n')),(0,o.kt)("p",null,"Better (combined with the above hint):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# https://clang.llvm.org/docs/ThinLTO.html\n# Only applicable for clang.\n# Turned off when building with tests or sanitizers.\noption(ENABLE_THINLTO "Clang-specific link time optimisation" ON).\n')),(0,o.kt)("p",null,"Other example, bad:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"option (USE_INCLUDE_WHAT_YOU_USE \"Use 'include-what-you-use' tool\" OFF)\n")),(0,o.kt)("p",null,"Better:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# https://github.com/include-what-you-use/include-what-you-use\noption (USE_INCLUDE_WHAT_YOU_USE "Reduce unneeded #include s (external tool)" OFF)\n')),(0,o.kt)("h4",{id:"prefer-consistent-default-values"},"Prefer consistent default values."),(0,o.kt)("p",null,"CMake allows you to pass a plethora of values representing boolean true/false, e.g. 1, ON, YES, ...."),(0,o.kt)("p",null,"Prefer the ON/OFF values, if possible."))}h.isMDXComponent=!0}}]);